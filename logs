commit 01b1b7dc204abdf3849536979205dc9e3a0e3ece
Author: Howard Chu <hyc@openldap.org>
Date:   Mon Jun 7 15:54:32 2021 +0100

    ITS#9574 add mdb_drop to .gitignore

commit 4b6154340c27d03592b8824646a3bc4eb7ab61f5
Author: Howard Chu <hyc@openldap.org>
Date:   Fri Apr 9 14:06:33 2021 +0100

    ITS#9496 fix mdb_env_open bug from #8704
    
    Broken in af2f8cc814fabe2814cacb573be3338292f47c0d

commit 48a7fed59a8aae623deff415dda27097198ca0c1
Author: Howard Chu <hyc@openldap.org>
Date:   Sun Mar 14 14:25:55 2021 +0000

    ITS#9376 simplify

commit 2d06d7aa60ef776c79c754e2f0441a6f76e1ed5a
Author: Howard Chu <hyc@openldap.org>
Date:   Sun Mar 14 14:29:44 2021 +0000

    ITS#9500 fix regression from ITS#8662

commit 3464af65c99ff66a91ad06a841529324a01624e4
Author: Quanah Gibson-Mount <quanah@openldap.org>
Date:   Thu Feb 18 16:25:45 2021 +0000

    ITS#9469 - Typo fixes

commit 52bc29ee2efccf09c650598635cd42a50b6ecffe
Author: Howard Chu <hyc@openldap.org>
Date:   Thu Feb 11 11:34:57 2021 +0000

    ITS#9461 fix typo

commit 917e4f1d142731e67d43e43c957432f3f8f31bf9
Author: Howard Chu <hyc@openldap.org>
Date:   Tue Feb 9 23:38:06 2021 +0000

    ITS#9461 refix ITS#9376
    
    Was setting C_DEL flag gratuitously

commit 5b75edb6337b28669c1370bc33442e272e72f91a
Author: Quanah Gibson-Mount <quanah@openldap.org>
Date:   Tue Jan 12 19:20:01 2021 +0000

    Happy New Year!

commit a99290f253a8df45679c8e2b159e83b835e8eb24
Author: Howard Chu <hyc@openldap.org>
Date:   Wed Oct 21 21:24:53 2020 +0100

    Fixes for repeated deletes with xcursor
    
    On DUPSORT DBs, must initialize xcursor regardless of whether
    caller requested its data.

commit 2fd44e325195ae81664eb5dc36e7d265927c5ebc
Author: Howard Chu <hyc@openldap.org>
Date:   Tue Jun 16 19:49:14 2020 +0100

    ITS#9278 fix robust mutex cleanup for FreeBSD
    
    FreeBSD 11 supports robust process-shared POSIX mutexes,
    but requires them to be explicitly destroyed before munmap

commit 8d0cbbc936091eb85972501a9b31a8f86d4c51a7
Author: Howard Chu <hyc@openldap.org>
Date:   Sat Apr 25 00:46:58 2020 +0100

    ITS#9017 cleanup Windows off_t

commit 1f026685fd5be35a9641c5c59eff51967244cc26
Author: Howard Chu <hyc@openldap.org>
Date:   Fri Apr 24 15:07:33 2020 +0100

    ITS#9017 doxygen comment for MDB_FIXEDSIZE

commit b77c2ba72af8053e221b337995feb4e8f7fbb1e9
Author: Howard Chu <hyc@openldap.org>
Date:   Fri Apr 24 15:03:33 2020 +0100

    ITS#9017 LMDB: fix off_t usage on Windows

commit 147582b5dcd86d1d92bb9a3fda9eb640300ccae3
Author: Kris Zyp <kriszyp@gmail.com>
Date:   Tue Feb 18 22:50:41 2020 -0700

    ITS#9017 LMDB: allow using fixed file size on Windows

commit da0527ac75b811419b7007202799f96b2edb5aef
Author: Kris Zyp <kriszyp@gmail.com>
Date:   Tue Feb 18 22:49:03 2020 -0700

    ITS#9017 LMDB: improve Windows sync commit perf

commit cb256f409bb53efeda4ac69ee8165a0b4fc1a277
Author: Howard Chu <hyc@openldap.org>
Date:   Thu Jan 23 14:50:00 2020 +0000

    ITS#9155 lmdb: free mt_spill_pgs in non-nested txn on end

commit b1afa1f2c743b79962a73d21f5e2f77cff80b353
Author: Quanah Gibson-Mount <quanah@openldap.org>
Date:   Thu Jan 9 16:32:20 2020 +0000

    Happy New Year!

commit d7b515ca3bf211f7a7e8326c88b94298b8ebffb4
Author: Howard Chu <hyc@openldap.org>
Date:   Fri Nov 15 16:07:51 2019 +0000

    Silence spurious fallthru warning

commit 522c62035cdf78f3b7ccd5623ed3e175a6ce5259
Author: Howard Chu <hyc@openldap.org>
Date:   Fri Nov 15 16:06:34 2019 +0000

    ITS#9118 add MAP_NOSYNC for FreeBSD

commit c3e6b4209eed13af4a3670e5f04f42169c08e5c6
Author: Howard Chu <hyc@openldap.org>
Date:   Sun Nov 10 05:20:37 2019 +0000

    Revert "ITS#9116 LMDB: fix bogus error check in read-only txns"
    
    This reverts commit 0e895ffe4391fd9a8a484395887a9f7d156b86ae.
    Was not an LMDB bug.

commit a2121bb0781c259c41f94cbad9a64a4ed51bc26c
Author: Howard Chu <hyc@openldap.org>
Date:   Sun Nov 10 05:00:47 2019 +0000

    ITS#8704 add missing opt flags in prev commit

commit 0e895ffe4391fd9a8a484395887a9f7d156b86ae
Author: Howard Chu <hyc@openldap.org>
Date:   Sun Nov 10 04:58:35 2019 +0000

    ITS#9116 LMDB: fix bogus error check in read-only txns

commit 5c012bbe033f9bbb273078b07dded59f080d348d
Author: Howard Chu <hyc@openldap.org>
Date:   Mon Aug 26 17:51:53 2019 +0100

    ITS#9068 fix backslash escaping
    
    mdb_load wasn't properly inserting escaped backslashes into the data.
    mdb_dump wasn't escaping backslashes when generating printable output.

commit 332718f1487d5a08324b522716e2cc3915b5ffea
Author: Kris Zyp <kriszyp@gmail.com>
Date:   Mon Apr 15 20:07:56 2019 -0600

    ITS#9007 don't free loose writemap pages
    
    Broken in ITS#8756

commit 22af3288c7a5e7130d8031d6c63162018484f8ec
Author: Ka Ho Ng <khng300@gmail.com>
Date:   Sun Feb 17 23:59:56 2019 +0800

    ITS#8978 Fix mdb_env_open2() failing when getting handle for NTDLL.dll
    
    Always call GetModuleHandleW() with Unicode string, as mdb_fopen() is
    calling CreateFileW() already.

commit 4f9fe9fcead4ce3c49d80d39526472b5c274b188
Author: Howard Chu <hyc@openldap.org>
Date:   Wed Jan 30 23:43:34 2019 +0000

    ITS#8969 tweak mdb_page_split
    
    Bump up number of keys for which we use fine-grained splitpoint search

commit ef8364575f43e5e7e48e39b16503b6cfaf976b53
Author: Howard Chu <hyc@openldap.org>
Date:   Thu Jan 17 19:50:03 2019 +0000

    Fix merge error

commit 0a954f1a67410dceb0fafe202bd6c2f2f409cb4a
Author: Howard Chu <hyc@openldap.org>
Date:   Wed Apr 12 23:55:29 2017 +0100

    Fix Android recognition
    
    The official macro is __ANDROID__; ANDROID may or may not be defined.

commit aa77c832b8e6fc696078017f550d119cdfc0f232
Author: Howard Chu <hyc@openldap.org>
Date:   Wed Sep 20 18:38:47 2017 +0100

    Add -a append option to mdb_load
    
    To allow reloading of custom-sorted DBs from mdb_dump

commit af2f8cc814fabe2814cacb573be3338292f47c0d
Author: Howard Chu <hyc@openldap.org>
Date:   Sat Aug 12 11:16:45 2017 +0100

    ITS#8704 Fix PREVMETA, rename to PREVSNAPSHOT
    
    and enforce exclusive access to environment. Also fix txn_begin/pick_meta
    to use correct meta page, and reset the flag after successful commit.

commit ce834559041747a8ae29884d2b82e144adc7600f
Author: Howard Chu <hyc@openldap.org>
Date:   Mon Jul 31 19:15:21 2017 +0100

    ITS#8704 Add MDB_PREVMETA support to tools

commit 7edf504106c61639a89b9a4e5987242598196932
Author: Howard Chu <hyc@openldap.org>
Date:   Thu Jan 17 18:46:10 2019 +0000

    IDLs for VL32 must be same size as for 64bit

commit 1de70b21306006331fc4bf20b403c8dd17b7c425
Author: Howard Chu <hyc@openldap.org>
Date:   Mon Jan 14 19:06:20 2019 +0000

    Happy New Year

commit 11308dfe26ff4daf53b61e06f6fb35248e2ced7f
Author: Quanah Gibson-Mount <quanah@openldap.org>
Date:   Mon Jan 14 18:39:38 2019 +0000

    Happy New Year!

commit 561ba50158f45d85894667e41050b5d0f29fc132
Author: moneromooo-monero <moneromooo-monero@users.noreply.github.com>
Date:   Tue May 15 10:53:13 2018 +0100

    ITS#8857 document mdb_cursor_del does not invalidate the cursor

commit eab90d5389c309761df1731df282b396dc0999f4
Author: Howard Chu <hyc@openldap.org>
Date:   Wed Aug 29 01:25:01 2018 +0100

    ITS#8908 DOC: GET_MULTIPLE etc don't return the key
    
    Unnecessary since these are DUPs, the key will always be the same

commit 26c7df88e44e31623d0802a564f24781acdefde3
Author: Howard Chu <hyc@openldap.org>
Date:   Mon Aug 6 13:10:59 2018 +0100

    ITS#8891 fix M$ WINAPI typedefs

commit 1ffe472a080fcd3c7dab6e352848703ad7adbe14
Author: Howard Chu <hyc@openldap.org>
Date:   Fri Jun 22 16:30:13 2018 +0100

    ITS#8756 remove loose pg from dirty list in freelist_save

commit 86a90cad721cbdc0bb0a9c3bf15396f5c946ae95
Author: Howard Chu <hyc@openldap.org>
Date:   Wed May 2 17:05:29 2018 +0100

    ITS#8844 use getpid() in mdb_env_close0()

commit 7aa7fadc5b6a0660cb004ffdbb7f80575add4b9b
Author: Howard Chu <hyc@openldap.org>
Date:   Mon Apr 2 18:01:19 2018 +0100

    ITS#8831 move flag init into readhdr
    
    Avoid stomping on flags from 1st readhr invocation

commit 0a2622317f189c7062d03d050be6766586a548b2
Author: Quanah Gibson-Mount <quanah@openldap.org>
Date:   Thu Mar 22 15:20:57 2018 +0000

    Happy New Year

commit 3b0f68a462355c5d565abff20d1515dce2afe697
Author: Howard Chu <hyc@openldap.org>
Date:   Tue Mar 20 18:34:56 2018 +0000

    ITS#8819 can't use fakepage mp_ptrs directly

commit e85ae1fe883b4847f07cfebc2630636d06e429c3
Author: Howard Chu <hyc@openldap.org>
Date:   Sun Feb 18 21:00:54 2018 +0000

    ITS#8324 More for Win32 NTDLL junk
    
    Use GetProcAddress at runtime, avoid buildtime NTDLL link issues

commit 55fcd0cfee1cb4bbe1033a3efbad9795f79d4014
Author: Howard Chu <hyc@openldap.org>
Date:   Sun Nov 19 19:44:53 2017 +0000

    Add mdb_drop tool

commit 4d5e2d2a2ac38b9d56b6ba73187c325024718167
Author: Howard Chu <hyc@openldap.org>
Date:   Thu Oct 26 19:04:37 2017 +0100

    ITS#8760 fix regression in 0.9.19

commit bb8502f08800a44a6b91a94d6478aa7101c4cc77
Author: Quanah Gibson-Mount <quanah@symas.com>
Date:   Wed Jun 7 13:42:51 2017 -0700

    ITS#8612 Fix Solaris builds with liblmdb
    
    This patch fixes liblmdb builds on Solaris and derivatives by defining
    _POSIX_PTHREAD_SEMANTICS

commit 8c2c5e2b4bf2e4504694aa9684922d505af9ba75
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Mon Sep 11 00:00:14 2017 +0200

    Tweak ITS#8722 fix: Use XCURSOR_REFRESH()
    
    This checks XCURSOR_INITED() and fixes the mn_flags check.

commit 7ead4169b6cdf67f72956a2835ff6e6bd6905256
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sun Sep 10 23:59:35 2017 +0200

    XCURSOR_REFRESH() fixups/cleanup
    
    * Check NUMKEYS(), similar to f34b61f9471d1c03fe0517b9d817c50c920e378a
      "ITS#8722 fix FIRST_DUP/LAST_DUP cursor bounds check".
    * Move XCURSOR_INITED() into XCURSOR_REFRESH().  This adds a check in
      mdb_cursor_put, below /* converted, write the original data first */.
    * Factor mc_ki[] out to XCURSOR_REFRESH().
    * Replace an mc_pg[] with mp which is equal (mdb_cursor_del0).

commit fbdd452799b87f40709a48bb316d1df2735f4c9b
Author: Howard Chu <hyc@openldap.org>
Date:   Sat Sep 9 15:08:03 2017 +0100

    ITS#8728 fix MDB_VL32 freeing overflow page

commit f34b61f9471d1c03fe0517b9d817c50c920e378a
Author: Howard Chu <hyc@openldap.org>
Date:   Wed Sep 6 21:15:48 2017 +0100

    ITS#8722 fix FIRST_DUP/LAST_DUP cursor bounds check

commit 3daab3be733b933a3fd2263441da4976206b27a2
Author: moneromooo-monero <moneromooo-monero@users.noreply.github.com>
Date:   Mon Jul 31 00:04:28 2017 +0100

    ITS#8704 add MDB_PREVMETA flag to mdb_env_open
    
    used to open the previous meta page, in case the latest one
    is corrupted
    
    From https://github.com/LMDB/lmdb/pull/12

commit 47ca2f7095f2aa6e395b7a5cfec46bce35a5d623
Author: Howard Chu <hyc@openldap.org>
Date:   Wed Jul 26 21:37:40 2017 +0100

    ITS#8699 more for cursor_del ITS#8622
    
    Set C_DEL flag on reinit'd subcursor

commit 4d2154397afd90ca519bfa102b2aad515159bd50
Author: Howard Chu <hyc@openldap.org>
Date:   Thu Mar 23 20:37:24 2017 +0000

    ITS#8622 fix xcursor after cursor_del
    
    Re-fix 6b1df0e4c7fadd21d1233d7157229b2d89ccaa04 from ITS#8406

commit b5e5fcc31dd6719a618cd825a0a9c4ecef5d045b
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sun Mar 12 20:08:53 2017 +0100

    ITS#8582 Fill in MDB_LOCK_FORMAT
    
    Attempt to stop liblmdb variants compiled with conflicting options
    from using the lockfile at the same time and thus breaking it.

commit 52c0df1d5052296200d1db607ba4f6bd6eb35f4d
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sun Mar 12 16:59:23 2017 +0100

    Clear any struct padding in idbuf

commit 172d825155a7ba595527181277983ba4022c2115
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sun Mar 12 16:58:51 2017 +0100

    Simplify mdb_hash_val() -> mdb_hash()
    
    Simpler usage since it's only called once, rename to match new usage,
    and drop 3 loop pessimizations which were optimizations 20 years ago.

commit 68eda68f0b99bd766d1fd52658e088640b67b39c
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sun Mar 12 16:55:14 2017 +0100

    Store lock ID instead of pathname in lockfile
    
    This limits the namespace which the user can meddle with for
    POSIX semaphores and Windows mutexes.  Their names change a
    bit, they no longer have fixed lengths.

commit 58ba039b8f30733ad9456cb3a31f9c459e6e0ffe
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Mar 4 13:03:15 2017 +0100

    ITS#8582 MDB_LOCK_VERSION = 2 due to format change

commit e36517dbbe157207cde3289776b76ae6d7bd1877
Author: Howard Chu <hyc@openldap.org>
Date:   Mon Feb 6 15:09:26 2017 +0000

    ITS#8582 keep mutex at end of struct
    
    since it's variable size on Linux/glibc

commit 1db9f32ae23330de44e86419991d64202ce9ac92
Author: Howard Chu <hyc@openldap.org>
Date:   Tue Jan 31 10:41:52 2017 +0000

    Workaround VL32 cursor refcounting miscount
    
    Don't try to deref cursor page if txn's pagelist is empty

commit 882e27c1b4f40270e712c251d5454c7e93424f58
Author: Howard Chu <hyc@openldap.org>
Date:   Sat Jan 14 19:22:34 2017 +0000

    Further fix f8ce8a82717ddefdc912fa47c07f1bdee2a3336b
    
    Fully revert the change to GET_MULTIPLE

commit 5eae7aad7e4db9f354fa8a5a52eab9646e07a028
Author: Howard Chu <hyc@openldap.org>
Date:   Thu Jan 12 13:35:31 2017 +0000

    Fix f8ce8a82717ddefdc912fa47c07f1bdee2a3336b
    
    GET_MULTIPLE was broken

commit 6ac9aa666e6754f195a2e988d0c395f4d6364c28
Author: Howard Chu <hyc@openldap.org>
Date:   Wed Jan 11 14:39:08 2017 +0000

    Happy New Year

commit f8ce8a82717ddefdc912fa47c07f1bdee2a3336b
Author: Howard Chu <hyc@openldap.org>
Date:   Wed Jan 11 11:19:18 2017 +0000

    More C_EOF tweaks

commit c44b29eaa84c7d62931252ec0645e24f1e1cff36
Author: Howard Chu <hyc@openldap.org>
Date:   Wed Jan 11 11:18:57 2017 +0000

    ITS#8557 fix prev commit

commit 511f5880e22baddfe9fc1dee54b41a2deafc3b26
Author: Howard Chu <hyc@openldap.org>
Date:   Wed Jan 11 10:33:28 2017 +0000

    Tweak cursor_next C_EOF check
    
    Allow C_EOF flag to be stale

commit d84dee516fa4cca41b5234e95c2105eb4737dfb3
Author: Howard Chu <hyc@openldap.org>
Date:   Wed Jan 11 09:51:43 2017 +0000

    ITS#8557 fix mdb_cursor_last
    
    Optimize mdb_page_search_root(PS_LAST) when cursor is already near
    last position, ignoring C_EOF flag for now.

commit 59ac317d2a4a81613e3e1dbc17fd2d3ec4205ba1
Author: Howard Chu <hyc@openldap.org>
Date:   Fri Jan 6 19:48:58 2017 +0000

    ITS#8558 fix mdb_load with escaped plaintext

commit 2e3eaf2ce26bf643d52c4c98b77b9d9bc71ed2c1
Author: Howard Chu <hyc@openldap.org>
Date:   Wed Dec 28 18:30:19 2016 +0000

    ITS#8554 kFreeBSD is like BSD
    
    Doesn't have POSIX robust mutexes - GNU userland on BSD kernel

commit 4bc270a2cb5d5a4ef1f01c70faa2bdfe5019ef16
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Wed Dec 21 21:40:14 2016 +0100

    More MDB_node doc

commit be94a7565bfb553bb1a0ab71ddd602d48ffcaa0f
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Wed Dec 21 16:33:47 2016 +0100

    Doxygen fixes. Use DISTRIBUTE_GROUP_DOC.
    
    - DISTRIBUTE_GROUP_DOC makes doxygen give several fields the
      same doc: mn_hi + mn_lo in MDB_node.
    - With mdb_mutex_t + mdb_mutexref_t, instead split them up.
    - Don't hide a doxygen #name inside double quotes.

commit 72c893fc82899b4e4d4fb506116ba109ee66032a
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Thu Dec 15 22:12:45 2016 +0100

    Mention MDB_PREV_MULTIPLE along with MDB_NEXT_MULTIPLE

commit e539654051a6300997be7420e67b31d08c87aa90
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Thu Oct 20 09:51:22 2016 +0200

    ITS#8504 Fix prev commit: mc_error, #ifdef SIGPIPE
    
    Never clear mc_error, we could lose a failure in the other thread.

commit 3e7a8e26e6a06ef34fcb460b608c6e65f688b9a6
Author: Lorenz Bauer <lmb@cloudflare.com>
Date:   Thu Oct 20 09:51:22 2016 +0200

    ITS#8504 mdb_env_copyfd2(): Don't abort on SIGPIPE
    
    Return EPIPE instead.

commit 65e95ffccf512dd1514083bd5768f1595560eb53
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Dec 10 22:00:31 2016 +0100

    ITS#7377 Catch mdb_cursor_sibling() error

commit d78c80d902e3b508b6d118c975a6c6a8d9782f40
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Dec 10 21:42:39 2016 +0100

    Clean up and comment C_UNTRACK
    
    Don't use it as a "cursor is tracked" hint in mdb_pages_xkeep().
    It's been harmless so far, but would break after mdb_cursor_copy().
    Checking m0 directly short-circuits better anyway.

commit 1fb0822b408931f7e0d7d0a868b833a89c83b27f
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Dec 10 21:11:12 2016 +0100

    ITS#8355 cleanup
    
    Drop ~C_EOF, pointless after 8c215aa970215a58ee0df458813c0405ad27a6e9

commit c0ff9a267ae2a943c99452fae0159d77deb46562
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Dec 10 17:17:28 2016 +0100

    MDB_VL32 cleanup: MDB_env.mm_mapsize type

commit e1be73c771e3ac8dfc7528c0825c56eb8ed295a6
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Dec 10 09:16:17 2016 +0100

    ITS#8542 mdb_dbi_open(): Protect mainDB cursors

commit ffd13db3f84cef20f486e73c465d674e6e1500bd
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Fri Dec 9 00:03:36 2016 +0100

    Cleanup: Add flag DB_DUPDATA, drop DB_DIRTY hack

commit ef066598b5e4c0eaab29c858451569439cb6b5d6
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Wed Dec 7 19:06:11 2016 +0100

    MDB_CP_COMPACT comments

commit 3dda2bfa4a33e7f22ab92dafc501411c90647e16
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Wed Dec 7 19:04:19 2016 +0100

    doxygen cleanup

commit 72f875b48a0f9c588e4f26828f18c547525a507d
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Wed Dec 7 18:55:21 2016 +0100

    Note functions which must set MDB_TXN_ERROR on failure
    
    Other functions depend on them to do so.
    For mdb_node_read(), instead remove such a dependence.

commit 08e4684d37b45cff97ea0ba17573165a63fb622c
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Fri Dec 2 06:20:29 2016 +0100

    MDB_VL32 mdb_page_get(): Set MDB_TXN_ERROR on failure.

commit a70200f15f06397ef9029ca26fabc925ce396ead
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Fri Dec 2 05:22:11 2016 +0100

    Fix mdb_env_open() with MDB_VL32
    
    Init me_rpmutex independently of MDB_NOLOCK.
    Plug leaks on mdb_env_open() failure.
    Tweak mdb_env_close0() to handle the rearranged mdb_env_open().

commit f3ab0d23a4470c187f971e6da4d63a306e125512
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Thu Dec 1 21:17:42 2016 +0100

    Factor out refreshing sub-page pointers

commit fa83b25ec536ac2642f8e0d3c6bf587008513ef4
Author: Howard Chu <hyc@openldap.org>
Date:   Tue Nov 29 19:19:45 2016 +0000

    More for ITS#8406
    
    xcursor fixup depends on init state

commit e58db7d5568c8ac91c0f1e6c64a58ba6f84b037d
Author: Howard Chu <hyc@openldap.org>
Date:   Sat Nov 12 23:11:20 2016 +0000

    More for ITS#8406
    
    Revert excess cursor fixup

commit f7e85d7804109a429dd6d24b19cc2148a7f43813
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Tue Sep 27 07:03:45 2016 +0200

    Only set me_mfd if needed. Drop unused read access.

commit 77845345ca9bf3854fd9da60a3e3b0527fa9c76a
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Tue Sep 27 07:03:42 2016 +0200

    ITS#8505 Clarify fork() caveat, mdb_env_get_fd(), flock->fcntl.

commit 6355dade31e35af5527e9139a39fc1e3a5da04fd
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Tue Sep 27 07:03:40 2016 +0200

    ITS#8505 Protect parent from fork()-pthread_exit()

commit 04acac634a7b276332e2cc4d389b8d647a0a7fad
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Tue Sep 27 07:03:38 2016 +0200

    ITS#8505 Set FD_CLOEXEC for me_mfd,env_copy as well

commit 15666878afb57439abfaf5c5a1f3a338f4e23104
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Tue Sep 27 07:03:34 2016 +0200

    Move opening files to mdb_fopen()
    
    No change in functionality.

commit cdc3f9cc2d1d440920352b2f4524e28a93445e3a
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Sep 17 21:31:04 2016 +0200

    Factor filename handling out to mdb_fname_*()
    
    No change in functionality, except needs less mallocing.

commit 67fb3c746a43bf2d2ce4834ede5fba940c9286a5
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Tue Sep 6 18:12:01 2016 +0200

    ITS#7992 Tighter utf8_to_utf16(), fix errcodes
    
    The 0xFFFD check seems due to misleading MultiByteToWideChar() doc.
    Bad UTF-8 gives 0xFFFD in the output string, not the return value.

commit d87ee20e0bf7fc751f75412082df307647165d56
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Tue Sep 6 17:56:13 2016 +0200

    Clean up strange fcntl result check
    
    ...and check !MDB_CLOEXEC in an 'if' rather than '#if'
    to match its non-zero usage.

commit 3dd2d207d7e2cdd0fe040b919be56a1e23851aea
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Tue Sep 6 17:48:31 2016 +0200

    Drop spurious Errcode() call

commit cdcf9da600a5ffce71b8dba212c33b3e72bdbb8c
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Tue Sep 6 17:41:02 2016 +0200

    ITS#7682 F_NOCACHE: Allow error, skip any O_DIRECT
    
    We can run without F_NOCACHE if it fails. And we do not know
    what combining it with O_DIRECT means, if a system has both.

commit 26e226b2a8cdba4208eabca394537900c4eda3b3
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Sep 3 09:41:30 2016 +0200

    Silence warning for initializer "mdb_copy my = {0}"
    
    1st struct member was not a scalar.

commit 45a88275d2a410e683bae4ef44881e0f55fa3c4d
Author: Howard Chu <hyc@openldap.org>
Date:   Thu Sep 1 00:41:35 2016 +0100

    ITS#8489 reset cursor EOF flag in cursor_set
    
    It usually gets done anyway, but one of the fastpath shortcuts
    bypassed this step.

commit da4443a9b3f6b3ecf8594a706e0403eaf301727f
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sun Aug 21 23:22:18 2016 +0200

    Clean up MDB_USE_ROBUST #defines
    
    Make explicit and default nonzero equivalent. Parenthesize.

commit 36d374ba9eb75fe9812cf69a29bae69e94f559f9
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sun Aug 21 23:20:22 2016 +0200

    Fix mdb_page_list() message

commit c6510147cee88d182af431c14a61fad6fae18be3
Author: Howard Chu <hyc@openldap.org>
Date:   Fri Aug 19 17:24:25 2016 +0100

    ITS#8481 make shared lib suffix overridable

commit 7e2290c52bb4e8543a84f4e7f6c9a4f4d8ebf5d2
Author: Howard Chu <hyc@openldap.org>
Date:   Thu Aug 11 21:30:56 2016 +0100

    MDB_VL32 plug rpage leak
    
    mdb_cursor_set wasn't unref'ing as intended.

commit 77d522d15158d9fe54c2509b8998227c97cbdcdb
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Tue Aug 2 22:17:54 2016 +0200

    Comment MDB_page

commit 8670805b4fb379d70dea0b94dd437238e8d694f6
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Tue Aug 2 22:16:09 2016 +0200

    Doc fixes: VALID_FLAGS, mm_last_pg, mt_loose_count

commit 58b0ce50b3a4d76dd0f5c1ed780a75db54549558
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Tue Aug 2 21:04:17 2016 +0200

    mdb_size comments

commit 4d47e89f4d4e4bacf2e58a420e3a2e84840fbe8e
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Tue Aug 2 21:02:35 2016 +0200

    MDB_VL32: Switch to mdb_size_t formats PRIu64 & co
    
    Drop macro Y=MDB_FMT_Y, add Yu/Yd=MDB_PRIy(). Replace
    Y"d..." -> Yd"...", Y"u..." -> Yu"..." / MDB_SCNy(u)"...".

commit 65d9791ada4672d2c7fb93a65e0ce7a1e4474658
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Jul 23 12:45:46 2016 +0200

    Refactor mdb_page_get()

commit a43fcad8c65c2f4998a27d5596677dd81a42bd0f
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Jul 23 12:43:16 2016 +0200

    MDB_VL32: Match mdb_size_t type with format modifier.
    
    When using format modifier "ll" or "I64", use the matching
    type unsigned <long long / __int64> rather than uint64_t.

commit f25d716513944b667d430beece3d616d326e0cf2
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Jul 23 12:18:01 2016 +0200

    Fix MDB_INTEGERKEY doc of integer types

commit 0842f998ee49b7891483c601fc4f8ad7d83b30d3
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Jul 23 12:17:04 2016 +0200

    Use mdb_size_t for line numbers in mdb_load
    
    This matches the mdb_size_t entry counts.

commit 12ad38d67f722d22a8ab3793dc2967d1247d3fea
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Jul 23 12:16:20 2016 +0200

    Fix size_t/formats -> mdb_size_t for MDB_VL32

commit dff8bafb36eef019b1b121eb10fbd259197fa01f
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Jul 23 12:11:34 2016 +0200

    Factor some MDB_VL32-related '#if's out to macros
    
    Add MC_OVPG() + MC_SET_OVPG(), NEED_CMP_CLONG(), MDB_CURSOR_UNREF().

commit 32764bcb52e70588982d576cb16f435705c11279
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Jul 23 12:08:12 2016 +0200

    Factor out MDB_SIZE_MAX, MDB_FMT_Y, MDB_FMT_Z

commit 84610e65da85d483f9461b4bdc300a082f004de2
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Thu Jul 14 05:53:21 2016 +0200

    Add error MDB_PROBLEM, replace some MDB_CORRUPTED
    
    When problem is most likely in txn, not on disk.

commit 291c69ddbd593ce86c888718745f6d78f6bd7222
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Wed Jun 29 06:25:37 2016 +0200

    ITS#8209 Tweak previous fixes
    
    Some _aligned_malloc() doc seems to think arg NULL = user error.
    Don't know if posix_memalign() pointer is defined after failure.

commit 5ea12b0be85ffe3be49692af90e24411c5b90655
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Jun 25 07:57:04 2016 +0200

    ITS#8209 MDB_CP_COMPACT: Handle empty or broken DB
    
    Preserve DB flags (use metapage#1) when main DB is empty.
    Fail if metapage root != actual root in output file.

commit eb7bbed967cd2a54d90d997e3470d02262baadb2
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Jun 25 07:55:34 2016 +0200

    ITS#8209 MDB_CP_COMPACT fixes
    
    Handle errors.  Fix cond_wait condition so mc_new
    is the sole control var.  Drop specious cond_waits.
    Do not look at 'mo' while copythr writes it.

commit c4c7833d245fdc4b2ea4a1a459d7069ce3af87f5
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sun Jun 5 23:42:44 2016 +0200

    mdb_env_setup_locks: Plug mutexattr leak on error

commit 53a0fdf1bee795048b3b3a40f8ffec3e3f8473a2
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Fri Jun 3 06:11:54 2016 +0200

    Init "locked" flag for SysV semaphores

commit c367c1f69685a4d307acb8cea6945c1d67e1cc7e
Author: Howard Chu <hyc@openldap.org>
Date:   Thu Jun 2 21:01:27 2016 +0100

    ITS#8339 Solaris 10/11 robust mutex fixes
    
    Check for PTHREAD_MUTEX_ROBUST_NP definition (this doesn't work
    on Linux/glibc because they used an enum). Zero out mutex before
    initing.

commit b045bce26037213f4f591787ac615a0463b031a8
Author: Howard Chu <hyc@openldap.org>
Date:   Sun May 15 00:44:54 2016 +0100

    ITS#8424 init cursor in mdb_env_cwalk

commit e2b8b6448de7de5229a44e18c224e3a670da4bdc
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Tue May 10 07:11:44 2016 +0200

    Comment ovpage code in mdb_cursor_put()

commit a04aad31c248401694d49d4c041db26d8b7ac310
Author: Howard Chu <hyc@openldap.org>
Date:   Tue Apr 26 12:52:21 2016 +0100

    ITS#8412 fix NEXT_DUP after cursor_del

commit 37081325f7356587c5e6ce4c1f36c3b303fa718c
Author: Howard Chu <hyc@openldap.org>
Date:   Mon Apr 18 18:07:56 2016 +0100

    ITS#8406 fix xcursors after cursor_del
    
    Don't leave them uninit'd if they now point at a valid DUP node

commit c8dbd772f751471fd2824bbb27ac9b8b392af465
Author: Howard Chu <hyc@openldap.org>
Date:   Sat Apr 9 20:42:45 2016 +0100

    mdb_drop optimization
    
    If we know there are no sub-DBs and no overflow pages, skip leaf scan.

commit 8fff90db7ed1e650395f39f9e8b22673aa74aa2b
Author: Howard Chu <hyc@openldap.org>
Date:   Mon Mar 28 01:35:56 2016 +0100

    ITS#8393 fix MDB_GET_BOTH on non-dup record

commit e46d78b7b083c3a9983f8a0e77b90bccd64b6ec9
Author: Howard Chu <hyc@symas.com>
Date:   Wed Feb 17 17:27:50 2016 +0000

    MDB_VL32 - increase max write txn size

commit 3f62b727ccf3424daca1cdc24bbf98c869f44699
Author: Howard Chu <hyc@openldap.org>
Date:   Tue Feb 16 23:34:27 2016 +0000

    Tweak MDB_PREV_MULTIPLE for uninit'd cursor

commit d909ab2f36e079087047dd842210b37cec8b6a84
Author: Howard Chu <hyc@openldap.org>
Date:   Mon Feb 15 00:07:04 2016 +0000

    Tweak Win32 errmsg buffer

commit 5ef1908224121c01eb9190b03978d563cc0c22d2
Author: Howard Chu <hyc@openldap.org>
Date:   Sun Feb 14 23:53:05 2016 +0000

    ITS#8324 Map NTAPI result codes to WIN32 codes

commit fcac8d07742891cedcf94b982e5094315132f62a
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Thu Feb 4 03:23:13 2016 +0100

    ITS#7992 Fix memleak in prev change

commit 5f5f4dab9c4f265c46d345cf69da984cd58eba0e
Author: Howard Chu <hyc@symas.com>
Date:   Sat Jan 30 12:54:32 2016 +0000

    Happy New Year

commit e394e023e491ca0338ad1f485fd70a9dd3790ed2
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Thu Jan 28 19:45:01 2016 +0100

    Fix MDB_VL32 mdb_cursor_count()/entrycount types

commit 3f62ddc81c891f10c65b672e268ff2cb2b5fe228
Author: Howard Chu <hyc@openldap.org>
Date:   Thu Jan 28 14:23:02 2016 +0000

    MDB_VL32 change overflow page scan
    
    Just check the requested page, don't worry about any other pages

commit 5bf313e820b8a6e122510e4571d9c6a3ec0136c1
Author: Howard Chu <hyc@openldap.org>
Date:   Thu Jan 28 04:18:14 2016 +0000

    ITS#8363 Fix off-by-one in mdb_midl_shrink

commit 6f653ca205d7358be7c639b8711492560de3de2a
Author: Howard Chu <hyc@openldap.org>
Date:   Wed Jan 27 11:48:22 2016 +0000

    MDB_VL32 more for 1ba5adb2ec262405f9207d6015d4f29eea548d25
    
    fix 32bit overflow in set_mapsize

commit 8f88b1b0ba208c51da70736626aeeb5daac6e3f2
Author: Howard Chu <hyc@openldap.org>
Date:   Tue Jan 26 22:13:01 2016 +0000

    ITS#8324 fix a6ccef73ed288271f9b5871909d14a2e481c81ae
    
    Removing the WRITEMAP test dropped this into the MDB_VL32 code path,
    which was wrong.

commit 8c215aa970215a58ee0df458813c0405ad27a6e9
Author: Howard Chu <hyc@openldap.org>
Date:   Sun Jan 24 11:32:49 2016 +0000

    ITS#8355 fix subcursors
    
    make sure C_DEL gets reset in subcursor after it moves.

commit b5018e26bc155baea94a3552696ea9b8f0dc7046
Author: Howard Chu <hyc@openldap.org>
Date:   Sat Jan 23 16:51:42 2016 +0000

    Update WRITEMAP doc

commit 20dec1f69bf4860202c764ce92b1fbbe3d11a065
Author: Howard Chu <hyc@openldap.org>
Date:   Wed Jan 20 01:30:57 2016 +0000

    WIN64 needs off_t redefined too

commit a6ccef73ed288271f9b5871909d14a2e481c81ae
Author: Howard Chu <hyc@openldap.org>
Date:   Sat Jan 16 17:11:36 2016 +0000

    ITS#8324 fix c4e31434c7773ee54f2ffdeb545e5740f56492a1
    
    Actually, there is no guarantee that Windows will map newly written
    data, so we need VirtualAlloc even for non-WRITEMAP.

commit d6995599b4a984171ec371633ac729f79d73b405
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Tue Jan 12 23:18:06 2016 +0100

    lmdb.h Caveats: Reserved vs. actual mem/disk usage

commit 15880014baaaa892d33d42f4cc466ed8a18e1614
Author: Howard Chu <hyc@openldap.org>
Date:   Tue Jan 12 07:13:48 2016 +0000

    ITS#8346 fix typo in prev commit

commit a5bf1648c69d316a5df0d45b2f43fc61f071d043
Author: Howard Chu <hyc@openldap.org>
Date:   Mon Jan 11 20:25:33 2016 +0000

    ITS#8347 fix off-by-one in VL32 purge

commit 447683a8244dccdd395d33fa9cf45ac23d10cfc3
Author: Howard Chu <hyc@openldap.org>
Date:   Mon Jan 11 20:17:42 2016 +0000

    ITS#8346 free last txn0->mt_rpages in env_close

commit 27b1c5f366dca98cfe6924dec5d7c989fbd91dba
Author: Howard Chu <hyc@openldap.org>
Date:   Thu Jan 7 18:28:29 2016 +0000

    Add MDB_PREV_MULTIPLE
    
    Logical counterpart to GET_MULTIPLE, NEXT_MULTIPLE

commit 5db0b54ca127eda9777771b3a5e3c956491e7660
Author: Howard Chu <hyc@symas.com>
Date:   Sat Jan 2 12:19:42 2016 +0000

    Fixups for env_copy with large files
    
    wsize was being truncated to 32bits on Windows.
    Only try to write 1GB at a time on Windows64;
    larger writes fail with ERROR_WORKING_SET_QUOTA.

commit 53f624bff0d7d08b64b48ab0c6683f4145b9bcac
Author: Howard Chu <hyc@openldap.org>
Date:   Mon Dec 28 20:31:09 2015 +0000

    MDB_VL32 fix cursor_unref - ignore cursor with empty stack

commit 1c2a5888cfffdfb3976145634ee5663e4b621675
Author: Howard Chu <hyc@openldap.org>
Date:   Mon Dec 28 19:33:51 2015 +0000

    ITS#8342 MDB_VL32/WIN32 - close file mapping handle in env_close

commit c3852f29af4c38ba7c91d7d3956577f980885cab
Author: Howard Chu <hyc@openldap.org>
Date:   Mon Dec 28 19:37:42 2015 +0000

    MDB_VL32 tweak prev commit

commit 7b9928ced4022b09cea3369c93f5bcdf4008076c
Author: Howard Chu <hyc@openldap.org>
Date:   Wed Dec 23 23:02:06 2015 +0000

    MDB_VL32 - prevent mixing with non-VL32 builds

commit 90d1ee279fca1b26daf0223377a44a6b17f46ad0
Author: Howard Chu <hyc@openldap.org>
Date:   Tue Dec 22 20:24:26 2015 +0000

    MDB_VL32 - Fix me_rpmutex usage

commit 825ab2ad52ffe5038ccda209aa05d9917915f6ff
Author: Howard Chu <hyc@openldap.org>
Date:   Tue Dec 22 18:30:41 2015 +0000

    MDB_RESERVE doc
    
    Add mdb_put text to mdb_cursor_put description for people who
    fail to draw logical conclusions.

commit 9d75a82ae10fdcee80b8b8e82c6ef9b6ab83dc47
Author: Howard Chu <hyc@openldap.org>
Date:   Tue Dec 22 06:13:25 2015 +0000

    MDB_VL32 - fix prev commit
    
    Only tweak length for read-only envs

commit 5eb25c5cb9122fcc016e770bcc1f033e3a9d2a0f
Author: Howard Chu <hyc@symas.com>
Date:   Tue Dec 22 05:20:33 2015 +0000

    MDB_VL32 - fix for Win32 read-only envs
    
    We can't map with MEM_RESERVE because that requires write access
    to the underlying file/section. Mapping with the default (MEM_COMMIT)
    requires that we don't map past the end of the file.

commit 3a2ac24f5bbdee304e1772ec71f81a4b6f8be87e
Author: Howard Chu <hyc@openldap.org>
Date:   Tue Dec 22 04:22:01 2015 +0000

    MDB_VL32 - track overflow pages too
    
    Otherwise they'll fill up the txn's pageref list when traversing
    a DB with lots of overflow records.

commit 6534b804a57d5f6cfc40ca7f63a64d1c5153748f
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sun Aug 23 22:00:14 2015 +0200

    mdb_page_alloc(): Use original snapshot of freeDB.
    
    I can't help thinking this should be safer, and useful somewhere.

commit 33025182ccfde2c9ac0073bbf3946398267ecc4d
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sun Aug 23 21:10:52 2015 +0200

    Prep for next commit: C_WRITEMAP, C_ORIG_RDONLY.
    
    No change in behavior.

commit 397d85d13c4f0c75cbe32768094090aa90bd0925
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sun Aug 23 20:33:02 2015 +0200

    Pass cursor to mdb_page_get(), mdb_node_read().
    
    No change in behavior.

commit 209b56fead1afe8273db6c714c0a74a9c09b9cf6
Author: Howard Chu <hyc@openldap.org>
Date:   Mon Dec 21 02:36:20 2015 +0000

    ITS#8324 fix for WRITEMAP
    
    We called FlushViewOfFile with (map,mapsize) which worked fine
    when we had allocated the entire map already. Now we have to make
    sure to only flush as much as was actually written. Add a numpgs
    argument to tell how much to flush in env_sync0().

commit 860527f66e461bd34c53e48e8525e11f6652a8b7
Author: Howard Chu <hyc@openldap.org>
Date:   Sun Dec 20 00:22:13 2015 +0000

    Note that we're prepping for 1.0

commit 29ebd02efd72fa0b558b6d87fc32afc1061f97ff
Author: Howard Chu <hyc@openldap.org>
Date:   Sat Dec 19 23:58:39 2015 +0000

    MDB_VL32 support 64 bit DBs on 32 bit processors

commit 1ba5adb2ec262405f9207d6015d4f29eea548d25
Author: Howard Chu <hyc@openldap.org>
Date:   Sat Dec 19 23:51:31 2015 +0000

    MDB_VL32 preparation
    
    Use 64 bit types consistently. This keeps database structures the
    same size for MDB_VL32 and native 64 bit builds.

commit 86ae31ebf51c6f242f8f19c41ff5127ca0fff1fa
Author: Howard Chu <hyc@openldap.org>
Date:   Sat Dec 19 22:57:00 2015 +0000

    Fix typos

commit 2cc88d20ccc33165f658d9678f19df38d08e71d1
Author: Howard Chu <hyc@openldap.org>
Date:   Sat Dec 19 22:53:26 2015 +0000

    Add Getting Started doc

commit c7a786eb00a8af61b16697be17d22eae1e37d102
Author: Howard Chu <hyc@openldap.org>
Date:   Tue Dec 15 18:45:34 2015 +0000

    ITS#7992 cleanup
    
    check for utf8_to_utf16 failures

commit 791badd09680cd9cd4c38b13b2dd829fff0ad32d
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Dec 12 19:25:06 2015 +0100

    mdb_dbi_open(): Catch strdup failure

commit 8b95e7d13e1cc354888a68dc520fd428b859679c
Author: Howard Chu <hyc@openldap.org>
Date:   Tue Dec 8 19:35:59 2015 +0000

    ITS#8324 fix for read-only envs

commit 58d1fd4c73c96ef3097816e975b3d421ead4d86e
Author: Howard Chu <hyc@openldap.org>
Date:   Tue Dec 8 18:17:24 2015 +0000

    ITS#8336 fix page_search_root assert on FreeDB
    
    Let "illegal" branch pages thru on the FreeDB - the condition
    is only temporary and will be fixed by the time rebalance finishes.

commit abb13ba176afd8c5da573a8b4b7808082e25b9b8
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Tue Dec 8 16:43:55 2015 +0100

    ITS#8334 Fix MDB_APPENDDUP vs. rewrite(single item)

commit c4e31434c7773ee54f2ffdeb545e5740f56492a1
Author: Howard Chu <hyc@symas.com>
Date:   Sun Dec 6 20:54:23 2015 +0000

    ITS#8324 additional tweaks
    
    VirtualAlloc is only needed with WRITEMAP. Regular writes
    already extend the mmap implictly.

commit 4198bbde175c65a7af0eafc46da22fc1c96ceeb6
Author: Sebastien Launay <sebastien@slaunay.fr>
Date:   Thu Dec 3 10:42:36 2015 -0800

    ITS#8330 Fix robust mutex detection for glibc 2.10 and 2.11
    
    pthread_mutexattr_setrobust and pthread_mutex_consistent are provided since 2.12 not 2.10:
    https://sourceware.org/git/?p=glibc.git;a=commit;h=402cd98775db1478f64c9b0dbe00664b89eb2773
    https://sourceware.org/git/?p=glibc.git;a=commit;h=78ee21859939ff75ccf8bbe00499b0c462df2e2d

commit 45fe870c2ec421286bcac86b514c326ce10009a2
Author: Howard Chu <hyc@openldap.org>
Date:   Tue Dec 1 14:10:12 2015 +0000

    ITS#8169 more Makefile tweaks
    
    Use all the same vars as main OpenLDAP makefiles

commit 50949b460625e1b0768d8bccb89303999d45a881
Author: Howard Chu <hyc@openldap.org>
Date:   Tue Dec 1 13:48:29 2015 +0000

    ITS#8169 more for prev patch
    
    Missed the mkdir command

commit fb5a768a77ca5330e15a3a34ceb694bc11cb216a
Author: Howard Chu <hyc@openldap.org>
Date:   Mon Nov 30 18:46:19 2015 +0000

    ITS#8324 incremental DB file growth for Windows

commit dbbbfa10be002b8d0bbf04c08f6dbfb359fc00eb
Author: Howard Chu <hyc@openldap.org>
Date:   Tue Nov 24 20:21:51 2015 +0000

    ITS#8321 cleanup unused var
    
    from da67af1a4bf1a6d3f5d173d9daf74bb4ec66175a

commit 6cff716f6024f98ecd743feb50c406a5136ed741
Author: Heiko Becker <heirecka@exherbo.org>
Date:   Thu Jun 11 21:09:59 2015 +0200

    ITS#8169 Allow passing mandir to make install
    
    The motivation for this change is my distribution moving to a multiarch
    layout. While the architecture specific stuff (binaries, libraries,
    etc.) is installed under /usr/${host}/{bin,lib,...} architecture-independent
    data should still be installed to /usr/share/.

commit 3a4fd79cbfe73d049da7e52d36a12ab5d850b5b9
Author: Heiko Becker <heirecka@exherbo.org>
Date:   Thu Jun 11 20:44:06 2015 +0200

    ITS#8168 Allow passing AR to make
    
    This is helpful when the ar executable is named differently, for
    example with an arch specific prefix.

commit da67af1a4bf1a6d3f5d173d9daf74bb4ec66175a
Author: Howard Chu <hyc@openldap.org>
Date:   Tue Nov 24 15:09:49 2015 +0000

    ITS#8321 fix ambiguity in cursor_put fixup
    
    After delete/add of a node, other nodes may no longer be
    pointing at the data they intended. This can confuse subsequent
    fixups.

commit 50d96511f87c8e64f69cfd24d7a2b94e746e442f
Author: Howard Chu <hyc@openldap.org>
Date:   Tue Nov 24 12:14:49 2015 +0000

    Cleanup C_DEL flag usage
    
    Only set it if the cursor's current position was deleted

commit 1424aa06a6fbd580b0ac92cd8ec3a81b5a1d0e12
Author: Howard Chu <hyc@openldap.org>
Date:   Mon Nov 23 16:58:57 2015 +0000

    ITS#8321 More cursor fixup
    
    Based on page_touch fixup from ITS#7594 but expanded:
    make sure sub-cursors agree with main cursors.

commit 69829288dc2c59287de290f6ab57b0c5d10a212b
Author: Howard Chu <hyc@openldap.org>
Date:   Mon Nov 23 13:19:26 2015 +0000

    ITS#8321 page_touch - don't fixup the cursor we just touched

commit db02a71dd80291fd836584b540075acad457cb74
Author: Howard Chu <hyc@openldap.org>
Date:   Tue Nov 24 01:21:05 2015 +0000

    ITS#8321 mdb_put cursor needs tracking too

commit cf8677e1b827c3ba1303433c041840886a9b146e
Author: Howard Chu <hyc@openldap.org>
Date:   Mon Nov 23 18:30:24 2015 +0000

    ITS#8321 Fix mdb_cursor_set
    
    Always reinit mc_pg[0] if cursor is not C_INITIALIZED
    It might have a stale value when using nested txns

commit b5ce8108e8bb92df00b2d27ef0e37bfe756d3752
Author: Howard Chu <hyc@openldap.org>
Date:   Tue Nov 24 12:54:46 2015 +0000

    ITS#8321 deinit empty cursors
    
    Always unset C_INIT flag if the cursor's target DB has been deleted

commit 83258ca81efbfdbccc2b09c4539b9babe5c27726
Author: Howard Chu <hyc@openldap.org>
Date:   Mon Nov 23 13:11:29 2015 +0000

    ITS#8323 Fix nested commit
    
    Must remove our spilled pages from parent's dirty list

commit fae01c8df524b2317954e1b1a2fb14bcdc47e1fa
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Mon Nov 23 13:03:09 2015 +0100

    CURSOR_TMP_[UN]TRACK() -> WITH_CURSOR_TRACKING()

commit 85d2f9804ae76a24702b91724ecbd1bf7479e2e3
Author: Orivej Desh <orivej@gmx.fr>
Date:   Sun Nov 22 01:15:14 2015 +0000

    ITS#8320 mdb_load: fix loading data from simple text files
    
    mdb_load -T was supposed to read escaped text, but 21b51cb7 "Add mdb_load"
    made it read hex.

commit e29cfa0b4992025c15eec1af4a59599c040aa2e9
Author: Orivej Desh <orivej@gmx.fr>
Date:   Sun Nov 22 00:59:55 2015 +0000

    ITS#8319 mdb_load: explain readline and mdb_cursor_put errors

commit 6fdaea4165146b9dc8e0365a0477e41b03c4daaf
Author: Howard Chu <hyc@openldap.org>
Date:   Mon Nov 23 01:34:26 2015 +0000

    ITS#8321 reorganize page_split fixups
    
    DUPFIXED fixups needed to occur after separator update.
    MDB_RESERVE handling moved after split fixup.

commit fd598083a77e03b6b98d609d49f7990b16cc81b3
Author: Howard Chu <hyc@openldap.org>
Date:   Mon Nov 23 01:33:00 2015 +0000

    ITS#8321 simplify page_split fixups

commit 3a31dd5a8a6cad16ab12cbdb27d3a760be3dec81
Author: Howard Chu <hyc@openldap.org>
Date:   Mon Nov 23 01:30:02 2015 +0000

    ITS#8321 track temporary cursors
    
    In rebalance/split operations, temporary cursors need to be visible
    to propagate fixups

commit 828107eb634dbf9ee13f6966e2c78cb27259927f
Author: Howard Chu <hyc@openldap.org>
Date:   Mon Nov 23 01:16:36 2015 +0000

    ITS#8321 fix mdb_cursor_put
    
    Ignore sub-cursors that shouldn't be fixed up

commit 0d5ebc508ecbd1f7d23b985257ec5993a764f17c
Author: Howard Chu <hyc@openldap.org>
Date:   Mon Nov 23 01:13:16 2015 +0000

    ITS#8321 fix mdb_cursor_shadow()
    
    Set a valid txn so that cursor fixup code works on the shadows

commit 88ac6987073a4d87e07b9a88f68c219e2649f0a5
Author: Howard Chu <hyc@openldap.org>
Date:   Mon Nov 23 01:10:05 2015 +0000

    ITS#8321 fix mdb_cursor_chk()
    
    It was reporting spurious errors due to uninit'd cursors

commit 3b9f857d8ba37879141f612d96993e90426a7b0d
Author: Howard Chu <hyc@openldap.org>
Date:   Mon Nov 23 01:07:57 2015 +0000

    ITS#8321 don't skip fixups on splitting cursors
    
    Adjustments can't be skipped, in recursive calls each level must
    fixup their own level.

commit f3eb26c9bb54e94a2ad553a6831433b0e1408e24
Author: Howard Chu <hyc@openldap.org>
Date:   Sun Nov 22 22:11:30 2015 +0000

    ITS#8321 Fix del/dupsort
    
    When deleting a dupsort key, if other cursors pointed at that key,
    set them to uninit'd, not EOF. They no longer have anything to
    point at.

commit f3e38565e4af652b3da60e805ac465b76eb1d84b
Author: Howard Chu <hyc@openldap.org>
Date:   Sat Nov 21 17:58:49 2015 +0000

    ITS#8316 more for 60c34d14ec3ceb0762d620eef77db73dd1e911dc

commit d6ae2553df446b1589299f6edfc6135ac70439b5
Author: Howard Chu <hyc@openldap.org>
Date:   Fri Nov 20 13:34:11 2015 +0000

    ITS#8300 more for prev commit
    
    Just tell explicitly which direction we moved/merged from

commit 946e4d3b21d1a48aa468d41663bbe8180284670a
Author: Howard Chu <hyc@openldap.org>
Date:   Fri Nov 20 09:47:56 2015 +0000

    Silence some valgrind uninit warnings

commit 1bfe7578bdf425657f62557e8fac0ed7f925a0c9
Author: Howard Chu <hyc@openldap.org>
Date:   Fri Nov 20 09:20:16 2015 +0000

    Refix root split check from 5da67968afb599697d7557c13b65fb961ec408dd

commit 58ad1dd757efc9c6854ddf67a3826f6d72ad2130
Author: Oskari Timperi <oskari.timperi@iki.fi>
Date:   Fri Dec 5 12:56:22 2014 +0200

    ITS#7992 assume Windows paths are UTF-8

commit 60c34d14ec3ceb0762d620eef77db73dd1e911dc
Author: Howard Chu <hyc@openldap.org>
Date:   Thu Nov 19 20:04:16 2015 +0000

    ITS#8316 cursor fixup in page_merge
    
    Deleting the merged page requires bumping down other ki's
    of the page's parent.

commit a98b74e6df6fdb9dbc29d44fe2879f96191d8904
Author: Howard Chu <hyc@openldap.org>
Date:   Wed Nov 18 23:38:34 2015 +0000

    ITS#8315 fix ovpage_free
    
    Keep dirty_room sync'd with dirty_list

commit f08b70d0df323ccb33b94a648e9a1b6efd718cae
Author: Howard Chu <hyc@openldap.org>
Date:   Wed Nov 18 21:33:51 2015 +0000

    ITS#8313 more for ITS#8062
    
    dummy flags must be init'd due to 3d46d550

commit 4d140b92ee3b12d293120c04e6b61e395bbec089
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Wed Nov 18 16:30:24 2015 +0100

    ITS#8312 Fix loose pages in commit(nested txn)

commit 355f64ad07537a4f21dc6fe4cef66324316aa84b
Author: Howard Chu <hyc@openldap.org>
Date:   Wed Nov 18 10:24:41 2015 +0000

    ITS#8311 add comment

commit 6d63afb1d9194cf1c0408b865f78e94efbf40990
Author: Howard Chu <hyc@openldap.org>
Date:   Wed Nov 18 00:33:25 2015 +0000

    ITS#8311 fix page_split from update_key
    
    Check for top of stack. Usually the cursor only has height 1 when
    calling page_split, but not always.

commit 3360cbad668f678fb23c064ca4efcc5c9ae95d10
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Tue Nov 17 18:22:25 2015 +0100

    ITS#7209 Default MDB_DSYNC = O_SYNC if no O_DSYNC

commit c46119a545410f282b524c297d43929ccca80361
Author: Howard Chu <hyc@openldap.org>
Date:   Fri Nov 13 09:25:55 2015 +0000

    ITS#8310 fix mdb_rebalance cursor fixup
    
    When collapsing root, must adjust entire cursor stack

commit c6d908075ee5bdd1270fce6ec8d5d8df9b168021
Author: Howard Chu <hyc@openldap.org>
Date:   Wed Nov 11 00:02:06 2015 +0000

    Tweak robust mutex detection for glibc

commit 3c9786b5e8dae8a6e8e49a83c55824eb8e4f2cea
Author: Howard Chu <hyc@openldap.org>
Date:   Mon Nov 9 20:09:10 2015 +0000

    ITS#8304 fix page_merge
    
    Was using the pre-touch dst page pointer instead of the touched page

commit 0fdfdf320c5e043f424ea744e7a162cb932bc480
Author: Howard Chu <hyc@openldap.org>
Date:   Fri Nov 6 10:12:45 2015 +0000

    ITS#8300 more for node_move
    
    When moving a node from one page to another, make sure other cursors'
    parent index gets adjusted too.

commit 3ff8a737044441c4a3553347fe830e470097050c
Author: Howard Chu <hyc@openldap.org>
Date:   Wed Nov 4 22:45:38 2015 +0000

    ITS#8300 simplify

commit b12bdaaade614996c9fcd36400775b40f4fe671c
Author: Howard Chu <hyc@openldap.org>
Date:   Wed Nov 4 22:31:01 2015 +0000

    ITS#8300 more for node_move fixups
    
    When moving a node from the right neighbor, a different
    adjustment is needed.

commit 7a5a78ef0c1f8b8e6dfd9cb1aab97c6f1994c0b0
Author: Howard Chu <hyc@openldap.org>
Date:   Wed Nov 4 21:01:30 2015 +0000

    ITS#8300 fix node_move
    
    Don't adjust other cursors when we added a node on the right.

commit 0c777dfc9949bb97e3897003e070bc61e569a63e
Author: Howard Chu <hyc@openldap.org>
Date:   Wed Nov 4 20:38:30 2015 +0000

    ITS#8300 fix rebalance after node_move
    
    ITS#8258, ITS#7829 fixes checked parent index to see if we were moving
    from a left neighbor. Should have just checked to see if current index
    was 0, meaning we added on the left. (Parent index may not tell us
    anything meaningful after a nested rebalance.)

commit eddd9b753715765e5315b703ad9d3e3357dd00a9
Author: Howard Chu <hyc@openldap.org>
Date:   Wed Nov 4 18:11:12 2015 +0000

    ITS#8238 fix DUPFIXED page_split
    
    Parent mc_ki wasn't adjusted if new_indx was > split point

commit d372a2a199c49082540863eb11173999a98c3f4f
Author: Howard Chu <hyc@openldap.org>
Date:   Wed Nov 4 17:03:48 2015 +0000

    ITS#8299 fix page_merge cursor fixup
    
    The parent's mc_ki has changed. We need to fix that up as well
    in other cursors.

commit b9130d3d6325e0e4cc4fcb11bb266368652d4f80
Author: Howard Chu <hyc@openldap.org>
Date:   Sat Oct 31 02:27:31 2015 +0000

    Use MDB_USE_ROBUST not MDB_NO_ROBUST

commit 2be67975340d0d12b29d23f539a641928e5c3b95
Author: Howard Chu <hyc@openldap.org>
Date:   Sat Oct 31 02:11:47 2015 +0000

    Add MDB_NO_ROBUST to disable Robust Mutexes

commit 2ee9c4a30e4d3ce203efcd3f1726f515f45913cc
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Wed Oct 28 09:37:23 2015 +0100

    Fix MDB_NOSYNC,MDB_NOMETASYNC thinko

commit 619ccdd3da6a7ed2e12dac91e9dd012618e1c99e
Author: Ignacio Casal Quinteiro <ignacio.casal@nice-software.com>
Date:   Thu Oct 15 13:22:25 2015 -0700

    ITS#8270 win32: fix conversion error with MSVC

commit 9411de60d2b4a99e8d68519f3f9083f23b4280c5
Author: Howard Chu <hyc@openldap.org>
Date:   Mon Oct 12 10:29:09 2015 +0100

    ITS#7771 more for prev commit

commit 7c1baed4debbf66d6ec13c4361780631eefe1bd9
Author: Howard Chu <hyc@openldap.org>
Date:   Mon Oct 12 00:08:41 2015 +0100

    ITS#7771 fix cursor tracking on fake pages
    
    node_del shifts nodes around, cursors pointing at fake pages
    need to have their mc_pg[0] corrected.

commit e211b870d0c49629260c2e421b58d7b2d7dfc30f
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sun Oct 11 21:40:49 2015 +0100

    ITS#8263 streamline prev patch

commit c456d219a9919e36605056d21929abb66788d4e7
Author: Howard Chu <hyc@openldap.org>
Date:   Wed Oct 7 06:30:58 2015 +0100

    ITS#8263 fix cursor tracking in cursor_put

commit b42cd65193a85503a47a8afed2476c883d926b05
Author: Howard Chu <hyc@openldap.org>
Date:   Tue Oct 6 07:57:14 2015 +0100

    ITS#8264 fix cursor_del cursor tracking
    
    Some destination fixups need to happen immediately after nodes
    are moved, before rebalancing

commit 8b46dcc26d1e9897ab1da3a4a164cad4a4479a52
Author: Howard Chu <hyc@openldap.org>
Date:   Sun Oct 4 01:56:25 2015 +0100

    ITS#8258 fix rebalance/split
    
    The tree height can also increase during rebalance, not just shrink.
    This can happen if update_key needs to split a parent branch page.

commit 436333b16c54fdfa5dce0aeaa5a81eeb2f5ceb17
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Thu Oct 1 19:43:58 2015 +0200

    Fix typo in mdb_tassert().
    
    No effect on current code.

commit e034bd3d84661dbe4a083c530746f1b137cf2857
Author: Howard Chu <hyc@openldap.org>
Date:   Wed Sep 30 18:11:20 2015 +0100

    ITS#8259 fix usage ordering

commit 3cbbe3a0d8bcd846bdb896a6be997e1b000300aa
Author: Howard Chu <hyc@openldap.org>
Date:   Tue Sep 29 17:31:56 2015 +0100

    ITS#8221 fix typos

commit 2247507bb8f57aea38e24ab236045544649624e0
Author: Howard Chu <hyc@openldap.org>
Date:   Sun Sep 27 22:34:22 2015 +0100

    ITS#8221 cleanup prev commit

commit 7267e0f566ef87a95b22de6da277f3e350359ad0
Author: Howard Chu <hyc@openldap.org>
Date:   Sat Sep 26 16:50:28 2015 +0100

    ITS#8221 don't merge branch pages needlessly

commit 62826b0965c4a2ee2e0d18c58210ae042424b7ce
Author: Luke Yeager <lyeager@nvidia.com>
Date:   Fri Sep 18 18:06:43 2015 -0700

    ITS#8256 Create install directories if needed

commit 7e476e4983cfba45cefe793b8bd6e13c486b3989
Author: Howard Chu <hyc@openldap.org>
Date:   Sun Sep 6 19:18:19 2015 +0100

    ITS#8237 fix ITS#7589 regression

commit e9e3c9fb514a9eaf6f8436e1683dca78c12b15de
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sun Aug 23 11:12:45 2015 +0200

    ITS#7377 mdb_env_init_meta(): Catch calloc error

commit bc4c177b9171947e35c431eded3510c9dba40357
Author: Howard Chu <hyc@openldap.org>
Date:   Sat Aug 22 14:00:12 2015 +0100

    Doc tweak - MDB_RESERVE / DUPSORT incompat
    
    For those people who insist on ignoring the obvious.

commit c77fbc6f35bc0f392f4944a5dbe498069428ddb4
Author: Howard Chu <hyc@openldap.org>
Date:   Fri Aug 21 21:40:33 2015 +0100

    Another MDB_APPEND doc tweak
    
    Missed this in 7ce29b9edbdaf34b7aeb545324008ed4dff62952

commit 10c808e4f9ef0d4049ccd92750f83c15aeff4bb8
Author: Pavel Medvedev <pmedvedev@gmail.com>
Date:   Wed Aug 19 17:19:48 2015 +0100

    ITS#8069 char* strings on Windows are ASCII

commit 8d198fdd5a0090e0158cd942109b0531a481dfc6
Author: Pavel Medvedev <pmedvedev@gmail.com>
Date:   Wed Aug 19 16:39:08 2015 +0100

    ITS#8067 add ssize_t typedef for MSVC

commit 80e997a0ebeed252b8487e6983eb8ef9b76576fd
Author: Howard Chu <hyc@openldap.org>
Date:   Fri Aug 14 01:01:40 2015 +0100

    Bump version to 0.9.16

commit c9d45600cd181c27eb769c878ebe6a6a20fb3139
Author: Howard Chu <hyc@openldap.org>
Date:   Thu Jul 30 00:54:05 2015 +0100

    ITS#8192 fix typo

commit d4f9568249f51c65e7dc1e16e9645d326c57d032
Author: Howard Chu <hyc@openldap.org>
Date:   Wed Jul 29 20:03:43 2015 +0100

    ITS#8192 cleanup unused label on WIN32

commit 572aff7e80809c1020ae92fd0a0d7b28c0b28825
Author: Howard Chu <hyc@openldap.org>
Date:   Wed Jul 29 20:01:34 2015 +0100

    ITS#8192 fix reference to EINTR on WIN32 from ITS#8106

commit 2c6c267a2395a893c884cd61d988dd301e742a1b
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sun Jul 26 07:20:19 2015 +0200

    Simpler mdb_env_write_meta()

commit af29f6a59418f72fb67c308a2785a6f8b07787fa
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sun Jul 26 07:16:41 2015 +0200

    Kill magic numbers for NUM_METAS, databases

commit 4dea7d44fa612c74a3e521aae52228c5f2fc81f9
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sun Jul 19 21:44:02 2015 +0200

    ITS#7377 Catch mdb_put() to blocked/read-only txns
    
    ...early enough that txn state is left unchanged.

commit d7db12ad7796bf34f3b296ad3d6416e55af29a9e
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sun Jul 19 21:43:10 2015 +0200

    ITS#7377 Always notice env error on txn startup.
    
    Move the check to the end of txn startup.  Catches env
    breakage which happens while the new txn waits for a lock.

commit 060b63a58dab60e0e460bb71ae4cc9c9571585ff
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sun Jul 19 21:31:54 2015 +0200

    Cleanup: Drop !mt_dbxs hack, use MDB_TXN_FINISHED

commit 3e301ec40025f17b52a7bcd66620c95ae3efef0f
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sun Jul 19 21:31:25 2015 +0200

    Catch most uses of finished/parent txns.
    
    * Add MDB_TXN_FINISHED, MDB_TXN_HAS_CHILD, MDB_TXN_BLOCKED.
    * Clear mt_numdbs in writers, for TXN_DBI_EXIST() to catch.
      We already do in readers.

commit b6973a3324144c8c5b0dfc3da482aa1cf9ac8ce2
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sun Jul 19 21:30:12 2015 +0200

    Move code into mdb_txn_end(). Was mdb_txn_reset0.
    
    Side effects:
    * Clean txn up a bit even before freeing it.
    * Tweak DEBUG output at txn end. Add DEBUG after commit(writer).

commit 90f6fc4ba7d60f602acd1ef63e4c7d939fb514e1
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sun Jul 19 21:18:31 2015 +0200

    ITS#8200 Fix mdb_midl_shrink() usage, return void

commit 91fc43f17cec8ffa05a5c841831df1cfa0511469
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Jul 11 21:10:33 2015 +0200

    Factor me_metas[toggle] out to mdb_env_pick_meta()

commit 62aabaa4aa8d3abcc345a85ff004baaa663bab57
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Jul 11 21:09:36 2015 +0200

    Simpler mdb_node_add()

commit 45e405528b0dc1dacdabcb6675bfa70432cd6b43
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Jul 11 21:01:40 2015 +0200

    ITS#8181 Verify that records are/aren't DBs.
    
    Except we don't catch the user passing F_SUBDATA to
    mdb_cursor_<put/del>, like an internal LMDB call.

commit 749633e48a80bfa6f5ca297769b6b9ff65ad3365
Author: Howard Chu <hyc@openldap.org>
Date:   Tue Jul 7 13:41:32 2015 +0100

    ITS#8190 fix cursor EOF bug

commit ad87d6a3f45d8ba2c00336bcdea1df5ebd17162a
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Jul 4 13:50:21 2015 +0200

    More ESECT declarations

commit ebb8b671095de788502807ad4074274a90eddecd
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Jul 4 13:49:12 2015 +0200

    Add DB_USRVALID, to avoid 'dbi == FREE_DBI' tests

commit 5cd5e928c1bb140487670fe18a4637e787f2f047
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Jul 4 13:48:07 2015 +0200

    Simpler flag/DBI checks and MDB_DEBUG

commit 4033f31acbed3d136a35103c9c7f514816b19681
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Jul 4 13:48:06 2015 +0200

    Simpler mdb_drop().
    
    MDB_DBI_CHANGED(,MAIN_DBI) is never true.

commit be0cdc1c9dbe9105a8066087e8b3f2249b111a11
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Jul 4 13:48:05 2015 +0200

    Simpler mdb_node_shrink()

commit 084d412f9b6d89806cd8dbbaa0b2d3a59470dc45
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Jul 4 13:48:04 2015 +0200

    Simpler mdb_txn_commit().
    
    mt_env is always set.
    Commit(mt_child) resets mt_child, so parent need not.

commit 530587158528f87d65b097a90885c0811684fdb7
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Jul 4 13:48:03 2015 +0200

    mdb_txn_begin() cleanup

commit b6ac0cd90ac3bdd1c464dc3a1d304772769bb75b
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Jul 4 13:48:02 2015 +0200

    mdb_drop0(): Omit scanning DUPSORT sub-DB leaves

commit f702e33b6cdf750a0affab64144379138bcf997c
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Jul 4 13:48:01 2015 +0200

    Use mdb_cmp_long() for FREE_DBI

commit 11536bea2533db3c1f1fcf9b0864ecaee11da851
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Jul 4 13:42:41 2015 +0200

    mdb_env_get_flags(): Hide internal flags

commit a937740aa0c47dc7a1a5e9be42dcea2dd3c81683
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Fri Jul 3 22:38:50 2015 +0200

    ITS#7969 Wrap unportable __sync_synchronize in #if

commit 943b23f01141ec0e9f85fa166b7867d63afcc5a9
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Thu Jul 2 21:14:56 2015 +0200

    Restore support for Posix semaphores

commit 9574b65648dc20fb2e0f267a63068cc92e56bd2d
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Thu Jul 2 21:06:35 2015 +0200

    Fix mdb_mutex_t, add mdb_mutexref_t, drop MDB_MUTEX().
    
    Fixes the types of Windows HANDLEs, they became HANDLE*.
    MDB_MUTEX() took a magic r/w arg which it's nice to get rid of.

commit 8293b20cfed74b5a24ffef931ffa643663c02cd0
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Thu Jul 2 21:06:27 2015 +0200

    Add MDB_USE_POSIX_MUTEX.
    
    So far just to help aligning mdb.master and mdb.RE.
    We'll make it an option later.

commit 7d162bcf31a293242118a625a426becfb1974626
Author: Howard Chu <hyc@openldap.org>
Date:   Thu Jul 2 18:03:36 2015 +0100

    CHANGES only belongs in mdb.RE

commit bf55ce55451213be69caea225bd3d713ed3aba7e
Author: Howard Chu <hyc@openldap.org>
Date:   Fri Jun 19 14:13:43 2015 +0100

    Bump version to 0.9.15
    
    (not really, since this is the dev/non-release branch)

commit e95d57f39c731e2cd27aa8f604db4ad96e1c3049
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Tue Jun 2 20:51:03 2015 +0200

    Use ftok() for semget(), and only lower mode bits

commit 68f64aa10449dd8b981c0348caec1fe19bcc11ef
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Tue Jun 2 20:49:33 2015 +0200

    Clarify mdb_env_open() doc of 'mode' param

commit 579ad14d7c4521754c9942ac39b39b6110338923
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Thu May 28 20:51:24 2015 +0200

    ITS#8156 Fix MDB_MAXKEYSIZE doc

commit aa16d7bc0a0c65b28726aab562bf3ca3c0ef1e5d
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Wed May 27 22:26:54 2015 +0200

    ITS#8157 mdb_txn_renew0(): init after error checks

commit 8d1f6ca7822930d7e1e94739886b6cd50340b7b4
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Wed May 27 22:23:50 2015 +0200

    mdb_txn_renew(): Drop pointless diff from mdb.RE.
    
    Makes the code friendlier to "git cherry-pick".

commit 02e8de5edbd13a5512352bbc308359d29870607d
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Wed May 20 04:04:38 2015 +0200

    Set/clear mp_pad, md_pad (MDB_DUPFIXED data size).
    
    mdb_xcursor_init1(): md_pad is only used when MDB_DUPFIXED.
    mdb_page_split():    Copy mp_pad too. Used by mdb_page_list().

commit 77bdbdd9de439224261c57bdcaf4d3281885f928
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Wed May 20 03:17:47 2015 +0200

    mtest*.c: Fix MDB_NOOVERWRITE, plug cursor leak

commit 9bb915675afe3acb616b2df2e241adddd6ee432f
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Tue May 19 20:33:35 2015 +0200

    ITS#8117 Fix MDB_INTEGERDUP keysize doc + md_dcmp

commit 329e12e4c5723276d1dd09a283a8149744268baf
Author: Howard Chu <hyc@openldap.org>
Date:   Sun May 3 07:52:47 2015 +0100

    ITS#8117 better fix
    
    Don't change mc_dbx because we would need to undo the change if
    the txn aborts. Make the fix (for get) match existing code for put.

commit 3d2202f31c14c6188093a492a97371069a732557
Author: Howard Chu <hyc@openldap.org>
Date:   Sun May 3 07:43:11 2015 +0100

    Revert "ITS#8117 cleanup prev commit"
    
    This reverts commit ce7ba0ceb69fd2cd56d557c1a877d046ec9f246c.
    
    Revert "ITS#8117 fix INTEGERDUP compare"
    
    This reverts commit ed13d4aa59cf06a1bb6b096fe19af63fc6f8737a.

commit ce7ba0ceb69fd2cd56d557c1a877d046ec9f246c
Author: Howard Chu <hyc@openldap.org>
Date:   Wed Apr 29 17:28:21 2015 +0100

    ITS#8117 cleanup prev commit

commit ed13d4aa59cf06a1bb6b096fe19af63fc6f8737a
Author: Howard Chu <hyc@openldap.org>
Date:   Wed Apr 29 17:12:40 2015 +0100

    ITS#8117 fix INTEGERDUP compare

commit f4cab2994f45b56fd5ffa1f332850b0e3285b665
Author: Howard Chu <hyc@openldap.org>
Date:   Thu Apr 23 05:49:56 2015 +0100

    ITS#8109 fix mdb_cursor_del0 on empty DB

commit 4c62fde880314f23871a68c8eabe8551a2aaf54b
Author: Howard Chu <hyc@openldap.org>
Date:   Fri Apr 17 18:32:54 2015 +0100

    ITS#8106 retry writes on EINTR

commit ccf4d8b385117aab1e30b46bfa0d887f621b9423
Author: Howard Chu <hyc@openldap.org>
Date:   Thu Apr 16 00:19:40 2015 +0100

    ITS#8062 also handle subcursors

commit b0fca5b956daf89ca5c7057ae179f626c1c5e0a0
Author: Howard Chu <hyc@openldap.org>
Date:   Wed Apr 15 23:20:55 2015 +0100

    ITS#8062 fix rebalance
    
    (Probably fixes the ITS, definitely fixes a bug) when collapsing
    the root page, fixups of other cursors was incomplete.

commit 2f6877ff7bccbbd550387cb343687e7dcf72a406
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Tue Apr 14 20:25:51 2015 +0200

    Cleanup mtest* and sample-*.
    
    Fix mdb_txn_begin(&read-only txn) calls. Test mdb_env_set_maxreaders().
    Rename DBI open/close functions. Move mdb_dbi_close() out of txn.

commit 5224774f3ccf44d7428350bb28a4e9eec7e7c7cf
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Tue Apr 14 20:24:30 2015 +0200

    Reformat mdb_dbi_open() doc for clarity

commit 6a86f22b2ac4cf982efd63c22fbe4dccf81adc73
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Wed Apr 8 21:52:05 2015 +0200

    Cleanup MDB_env.me_txn0.
    
    More fallout from 4d02c741b120786df1b87ee9ed49c1d3f9bc7522.

commit 8adee9464f65d1702b81a7c604f1a48baa7a0ad5
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Wed Apr 8 21:51:50 2015 +0200

    Fix per-txn MDB_NOMETASYNC, MDB_NOSYNC.
    
    Fallout from 4d02c741b120786df1b87ee9ed49c1d3f9bc7522. The flags
    were ignored: mdb_txn_renew0/begin cleared and/or did not set them.

commit 54516639acab87aad156230f8a799e9128d266fe
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Wed Apr 8 21:51:16 2015 +0200

    Renumber MDB_TXN_* flags, simplify flag code

commit 49bb9e82e866bd1b7851836b0b1b23934a7939b3
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Wed Apr 8 21:47:24 2015 +0200

    mdb_txn_renew(): Clear error from previous txn

commit d2dab3c9054abed2c41b65a7b0a658e4458d51ef
Author: Howard Chu <hyc@openldap.org>
Date:   Wed Mar 18 19:26:21 2015 +0000

    ITS#8062 fix uninit'd cursor index

commit 04af46b1c1d7c2507aa2a4b9d3f1bc292bc614ee
Author: Howard Chu <hyc@openldap.org>
Date:   Thu Feb 26 21:36:04 2015 +0000

    ITS#8066 fix mdb_load with large values

commit 6fe12f3273f8a28cd7183e176c5d76f214f77c98
Author: Quanah Gibson-Mount <quanah@openldap.org>
Date:   Thu Feb 12 11:17:59 2015 -0600

    Happy New Year

commit f526f1b9a33bf50e5cda858e6130524d4fdfe37a
Author: Quanah Gibson-Mount <quanah@openldap.org>
Date:   Thu Feb 12 10:46:33 2015 -0600

    Happy New Year

commit 8bb541bc408c6f136558a490dacd7abd3c339cec
Author: Howard Chu <hyc@openldap.org>
Date:   Mon Feb 2 10:33:41 2015 +0000

    Also support NOMETASYNC on txn_begin

commit 3368d1f5e243225cba4d730fba19ff600798ebe3
Author: Howard Chu <hyc@openldap.org>
Date:   Fri Jan 30 09:21:05 2015 +0000

    Support MDB_NOSYNC on mdb_txn_begin()

commit 570ba6fb86d2dbf7b1a86d2f01aba4c885ca4b45
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Tue Jan 27 06:10:57 2015 +0100

    Fix EACCES description

commit b2ab9910dd5f13ca2d92eeb4c39a90b922df8dfe
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Jan 17 06:32:12 2015 +0100

    ITS#7971 Fix reader allocation and me_numreaders

commit 404697b369bf6eacab02f68113eeafaaaef85d27
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Wed Jan 14 08:12:50 2015 +0100

    mdb_env_set_flags(): Reject CHANGELESS flags.
    
    Reverts part of a2ac10107e2fb845c4a38a339239063ec4407d84.
    MDB_ROBUST needed to be accepted, but that flag is gone.

commit 71741a6b08b18e5be4e57c211e70541f4e4b4995
Author: Howard Chu <hyc@openldap.org>
Date:   Tue Jan 13 18:47:18 2015 +0000

    Fix potential null deref (coverity)

commit d711e357da8432f4e5d32ea5a90b36a711e8716e
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Mon Jan 12 21:02:29 2015 +0100

    Whitespace (align with mdb.RE)

commit 631970e485a37d8fc270d8de41ecfe76d8521b70
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Mon Jan 12 21:02:29 2015 +0100

    Make SysV semaphores robust. Cleanup MDB_ROBUST.

commit 9441012435e8417a96e11350a4e74186db5a504a
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Mon Jan 12 12:19:51 2015 +0100

    ITS#8021 doc: Don't mix MDB_WRITEMAP + non-WRITEMAP

commit 8b6c4250b108f6f084358ef45cb3a13b7bbd71d2
Author: Howard Chu <hyc@openldap.org>
Date:   Mon Jan 12 10:38:14 2015 +0000

    More cleanup for fdatasync hack

commit ea89e3d269bd68cb3ab494f0dcf0b379574265c5
Author: Howard Chu <hyc@openldap.org>
Date:   Sun Jan 11 11:37:37 2015 +0000

    Tweak conditionals for fdatasync hack

commit f83f62a7aeb3a873564b3fba53132d026d1f8644
Author: Howard Chu <hyc@openldap.org>
Date:   Fri Jan 9 11:25:07 2015 +0000

    ITS#8021 env_sync is invalid in RDONLY env

commit 462dc097451834477b597447af69c5acc93182b7
Author: Howard Chu <hyc@openldap.org>
Date:   Thu Jan 8 12:54:14 2015 +0000

    fdatasync hack, again
    
    Check for ext3/ext4 fs, then check kernel version.

commit e86072a9c79d7fb5fdf63ffbe7b7a36731f0a11a
Author: Howard Chu <hyc@openldap.org>
Date:   Thu Jan 8 12:17:29 2015 +0000

    Revert "Note MDB_SAFE_FDATASYNC"
    
    This reverts commit 293d6bb47f7f0d54a45d57ce2be3a9595e806dc0.
    
    Revert "Simpler fdatasync hack"
    
    This reverts commit 9585c012335b2a28fbfdd267bcdeeeea91dc0f08.

commit 293d6bb47f7f0d54a45d57ce2be3a9595e806dc0
Author: Howard Chu <hyc@openldap.org>
Date:   Thu Jan 8 11:43:57 2015 +0000

    Note MDB_SAFE_FDATASYNC

commit 9585c012335b2a28fbfdd267bcdeeeea91dc0f08
Author: Howard Chu <hyc@openldap.org>
Date:   Thu Jan 8 11:42:08 2015 +0000

    Simpler fdatasync hack

commit 0ef1e0b16d4366d223601d6c7da35dc8c208a9b6
Author: Howard Chu <hyc@openldap.org>
Date:   Thu Jan 8 11:28:33 2015 +0000

    Revert "Fix prev commit for env_sync0"
    
    This reverts commit 985bbbbdd5d64e57f55249ffdeb7c08035b240b2.
    
    Revert "Hack for potential ext3/ext4 corruption issue"
    
    This reverts commit 0018eeb2c3b2239c30def9d47c9d194a4ebf35fe.

commit 985bbbbdd5d64e57f55249ffdeb7c08035b240b2
Author: Howard Chu <hyc@openldap.org>
Date:   Sun Dec 21 00:13:50 2014 +0000

    Fix prev commit for env_sync0

commit 0018eeb2c3b2239c30def9d47c9d194a4ebf35fe
Author: Howard Chu <hyc@openldap.org>
Date:   Thu Dec 18 04:38:53 2014 +0000

    Hack for potential ext3/ext4 corruption issue
    
    Use regular fsync() if we think this commit grew the DB file.

commit 7ce29b9edbdaf34b7aeb545324008ed4dff62952
Author: Howard Chu <hyc@openldap.org>
Date:   Mon Dec 15 20:40:59 2014 +0000

    Fix MDB_APPEND doc
    
    We actually compare the new key against the last key, to prevent
    corruption.

commit 6c7117325892a68e28141660cb9344e2ccef380a
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Dec 13 20:35:08 2014 +0100

    make clean: remove *.lo

commit cccc947b4ab1139d808eee01df2b828e3f0183ee
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Mon Dec 8 09:56:36 2014 +0100

    Try to avoid an invalid datafile after failed init

commit 9cc04f604f80f033d712f5f1faeb4ed97ca74f40
Author: Howard Chu <hyc@openldap.org>
Date:   Mon Dec 8 03:21:09 2014 +0000

    Clarify mdb_dbi_open doc
    
    The concurrency restriction is on threads within a single process.
    Multiple processes can use mdb_dbi_open without affecting each other.

commit 03ddbcf37de9ebdf244d5be4d2213852b0fd6abb
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Fri Dec 5 21:00:21 2014 +0100

    C90-compatible code for SysV semaphores

commit 1a7243b3f41ba1896b0ee69be5498f769cd2cfe5
Author: Leo Yuriev <leo@yuriev.ru>
Date:   Fri Dec 5 19:30:31 2014 +0000

    ITS#7987 fix excessive space for single write txn

commit c36c167cc49a59d4f40ae5fc259c013de601164e
Author: Howard Chu <hyc@openldap.org>
Date:   Fri Dec 5 19:15:41 2014 +0000

    ITS#7994 fix prev commit
    
    Strip docs promising behaviors that we don't promise to hold.
    Strip MDB_txnid_t typedef.

commit b660491d3fa359325cb3615a276bba78f32e2075
Author: David Barbour <dmbarbour@gmail.com>
Date:   Fri Dec 5 11:18:30 2014 -0600

    ITS#7994 Access to current transaction ID.
    
    I, David Barbour, hereby place the following modifications to OpenLDAP
    Software (and only these modifications) into the public domain. Hence,
    these modifications may be freely used and/or redistributed for any
    purpose with or without attribution and/or other notice.

commit 1413de3a0474e316d2128ed420a1ebfe0d2b64d8
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Fri Dec 5 18:18:53 2014 +0100

    Fix SysV semaphores - repair mti_txnid.
    
    Similar to 443a7e40c4280cfd07cbf80c5de62ea072b136e3.

commit 3e6ac6ef6b983a0bf34a73e14d2fd3bdb1cca777
Author: Hallvard Furuseth <h.b.furuseth@usit.uio.no>
Date:   Wed Dec 3 12:37:55 2014 +0100

    For ITS#7789: Ensure mapsize >= pages in use.
    
    Check new mapsizes against mm_last_pg.  Move
    mdb_env_init_meta0() so it can set mm_last_pg earlier.

commit c306423adfdf7c5e5cc1e60323da4fa6b24da49c
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Wed Dec 3 12:27:53 2014 +0100

    Fix WIN32 -> _WIN32

commit 0697869d9229ae002b0d4039718812bf5889c2da
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Mon Dec 1 08:59:29 2014 +0100

    mdb_strerror: Silence warning @ Windows

commit 4376a19c5c8a740dfb5bb4c2fb17ca303e597aaa
Author: Hallvard Furuseth <h.b.furuseth@usit.uio.no>
Date:   Mon Dec 1 08:59:29 2014 +0100

    Fix comments

commit 4bda1d24617a76569c63d76e8b3fdbdd651e9b13
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Mon Dec 1 08:59:29 2014 +0100

    Clean up SysV semaphore code.
    
    Change MDB_LOCK_FORMAT to differ from Posix semaphores/mutexes.
    Do not use array/member length 0 for MDB_txninfo.mt2.

commit 443a7e40c4280cfd07cbf80c5de62ea072b136e3
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Mon Dec 1 08:59:29 2014 +0100

    Fix robust mutexes - repair mti_txnid.
    
    Broken by e3b6c359a935283c21e1fd7d03b790d87d53b933, if
    commit() crashes in write_meta before setting mti_txnid.

commit 42110d83a9aa5d1811a77455dcaab7e19ec033e2
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Mon Dec 1 08:59:29 2014 +0100

    Simplify recent changes a bit.

commit 9a72292ac134f80c1befe8102dee1160e57a92ec
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Nov 22 22:56:31 2014 +0100

    ITS#7961,#7987 Re-fix txn init.
    
    More fallout from 4d02c741b120786df1b87ee9ed49c1d3f9bc7522:
    Don't modify another thread's write txn. Reinit me_txn0 fully.

commit 9a8eb95674c7b500cfe5f44d03493ff76c9fc0c1
Author: leo@yuriev.ru <leo@yuriev.ru>
Date:   Fri Oct 17 22:46:53 2014 +0000

    ITS#7971 LMDB: clarification in mdb_txn_renew0().

commit bd6d2e6f2c157551f1a0b912716ae92f120361f2
Author: leo@yuriev.ru <leo@yuriev.ru>
Date:   Fri Oct 17 22:35:41 2014 +0000

    ITS#7970 LMDB: Critical Heisenbug
    
    Inconsistent reading & SIGSEGV due to the race condition.

commit 9a80a8a8e8feed56fbccd8851b8a789f7fff9c11
Author: leo@yuriev.ru <leo@yuriev.ru>
Date:   Fri Oct 17 22:22:39 2014 +0000

    ITS#7969 LMDB: volatile & __synchronize().
    
    Globally shared fields of meta-data are not 'volatile'.

commit 925e7805a5b2d4bc2d464ea5acd5ff38ff209bde
Author: Howard Chu <hyc@symas.com>
Date:   Wed Oct 8 19:25:27 2014 +0100

    ITS#7959 fix prev commit
    
    fstat returns -1, not an errno. Move code into its own function
    for reuse.

commit d72b2f5d15319cb1424476dd3afc8528630461e4
Author: Howard Chu <hyc@symas.com>
Date:   Sat Oct 4 21:48:49 2014 +0100

    ITS#7961 fix txn init
    
    More fallout from 4d02c741b120786df1b87ee9ed49c1d3f9bc7522

commit d77e3ddb4d210fc01586f4c776286c4b0f7b6611
Author: Jean-Christophe DUBOIS <jcd@tribudubois.net>
Date:   Fri Oct 3 20:24:25 2014 +0200

    ITS#7959 Check fstat return value
    
    Signed-off-by: Jean-Christophe DUBOIS <jcd@tribudubois.net>

commit 461d9c8f34db8a1431257893916dbb7a6711a5a1
Author: Leo Yuriev <leo@yuriev.ru>
Date:   Fri Sep 5 00:19:16 2014 +0400

    ITS#7841 trivial cleanup
    
    TRIVIA - lmdb: clean testdb-dir while "make test".

commit 56c2c160be19c555e4c42e459c8608ffaae7b150
Author: Howard Chu <hyc@symas.com>
Date:   Thu Oct 2 22:11:43 2014 +0100

    ITS#7956 fix compact of empty env

commit bfe297da47beb31debee48f016222b63d94271fd
Author: Howard Chu <hyc@symas.com>
Date:   Thu Oct 2 21:58:20 2014 +0100

    ITS#7955, #7671 fix MDB_PREV_DUP

commit 61dd017808f66ada27e89c58bc9567d5b2ade884
Author: Howard Chu <hyc@symas.com>
Date:   Thu Oct 2 21:35:15 2014 +0100

    ITS#7953 .gitignore *.lo

commit fd0315d6e58d42d945fbc1939faa5e2354bbe9a8
Author: Howard Chu <hyc@symas.com>
Date:   Thu Oct 2 21:33:35 2014 +0100

    ITS#7952 .gitignore mdb_dump/load

commit 8bec53fdfd56528a26ec31f6361160585c91cb53
Author: Howard Chu <hyc@symas.com>
Date:   Wed Oct 1 21:00:03 2014 +0100

    Don't use -fPIC for static lib

commit e3b6c359a935283c21e1fd7d03b790d87d53b933
Author: Howard Chu <hyc@symas.com>
Date:   Wed Oct 1 20:58:15 2014 +0100

    Use robust mutexes by default
    
    Making it optional on pthreads just complicates things;
    they're always robust on other implementations

commit 58ddb5527bd4868bb7017cfe2051bc2e24bcf5a8
Author: Howard Chu <hyc@symas.com>
Date:   Sun Jul 20 11:08:55 2014 -0700

    Use SysV semaphores instead of POSIX
    
    Since they can cleanup after themselves on process exit

commit a53716ed968671a8df5e1fd6ca23cb959cf61e2d
Author: Howard Chu <hyc@symas.com>
Date:   Sun Jul 20 08:10:34 2014 -0700

    Must do dlist_free before releasing Wmutex

commit ec6cf4e40fb6565a3717e6eb2a4febe143e663d0
Author: Hallvard Furuseth <h.b.furuseth@usit.uio.no>
Date:   Sun Jul 20 16:42:04 2014 +0200

    MDB_ROBUST: Use MDB_PID_T. Drop a wmutex variable.

commit f6add293a726aec3de809142e5fdaf836843eed9
Author: Howard Chu <hyc@symas.com>
Date:   Wed Jul 16 09:24:45 2014 -0700

    Free write mutex earlier in txn_reset0

commit a2ac10107e2fb845c4a38a339239063ec4407d84
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Wed Jul 16 07:15:58 2014 -0700

    Add MDB_ROBUST

commit a7639a66a493818dc55f3ed77bebe659b6cdd2fd
Author: Howard Chu <hyc@symas.com>
Date:   Thu Sep 25 19:25:56 2014 +0100

    Android also only has memalign

commit 2f587ae081d076e3707360c5db086520c219d3ea
Author: Howard Chu <hyc@symas.com>
Date:   Sat Sep 20 07:24:32 2014 +0100

    new date

commit 62e4eeb7f7baa2c0ecd03f95aff4cc5037e94557
Author: Howard Chu <hyc@symas.com>
Date:   Fri Sep 19 01:45:43 2014 +0100

    ITS#7943 reinit txn flags
    
    When reusing the main write txn

commit 891e6627548939c60e229e61feb1d3c3322f3bcc
Author: Howard Chu <hyc@symas.com>
Date:   Thu Sep 18 01:22:02 2014 +0100

    Plug leak in 4d02c741b120786df1b87ee9ed49c1d3f9bc7522
    
    Free writer txn on env_close

commit 674f52fdb4ee29df88c8b4e20e0edfb5d5ba3138
Author: Howard Chu <hyc@symas.com>
Date:   Tue Sep 16 21:54:07 2014 +0100

    Silence some clang warnings

commit b9495245b4b96ad6698849e1c1c816c346f27c3c
Author: Howard Chu <hyc@symas.com>
Date:   Mon Sep 15 19:48:32 2014 +0100

    Release 0.9.14

commit 5ee99f1125a775f28ed69b06d991a43c60d894a9
Author: Quanah Gibson-Mount <quanah@openldap.org>
Date:   Sat Sep 13 16:21:17 2014 -0500

    Change retry to num times 60.  Testing shows that on a known dataset, this has the same growth behavior as 2.4.39, while num times 20 resulted in significant growth.

commit 3646ba966c75137b01e38fc5baea6d5864189c8e
Author: Howard Chu <hyc@symas.com>
Date:   Tue Sep 9 19:44:23 2014 +0100

    More for me_pgoldest
    
    Leave it in main env struct, it doesn't need to be rolled back
    with nested txns.

commit 29fd241fadc3dd49b3486f0e3556b029b716bcbf
Author: Howard Chu <hyc@symas.com>
Date:   Tue Sep 9 19:40:05 2014 +0100

    Remember oldest reader txnid
    
    Don't walk the readers table unless we really need to.

commit 4d02c741b120786df1b87ee9ed49c1d3f9bc7522
Author: Howard Chu <hyc@symas.com>
Date:   Thu Sep 4 10:40:11 2014 +0100

    Use a single write txn

commit a054a194e8a0aadfac138fa441c8f67f5d7caa35
Author: Howard Chu <hyc@symas.com>
Date:   Sun Aug 24 21:18:03 2014 +0100

    ITS#7913 cleanup
    
    we already checked for data == NULL, drop unnecessary if

commit 8fbbc71506f5992579fb38398e4654007a1cf4b5
Author: Howard Chu <hyc@symas.com>
Date:   Thu Aug 21 17:40:20 2014 -0700

    More for MIPS
    
    Move CACHEFLUSH, avoid unnecessary if()

commit 4008e5e58337feb8a5ab29b7f939b1831d3f6d75
Author: Howard Chu <hyc@symas.com>
Date:   Sun Aug 17 20:44:53 2014 -0700

    Partially revert ada26306992babeccad0c5443fbd76e28dd24cd6
    
    Of course, MacOSX only has posix_memalign, and only in recent versions.
    (Older versions could use valloc instead. That precludes ever changing
    the LMDB pagesize to be different from the OS pagesize.) Not all that
    crucial since it only affects mdb_env_copyfd1.

commit cf4fe3b1fb24d57eec80c2f7e22f73c568eb0241
Author: Hallvard Furuseth <h.b.furuseth@usit.uio.no>
Date:   Sun Aug 17 01:50:32 2014 +0200

    Microoptimize loose pages

commit 1e7eeed28d952adf81090e9551e7ee1d5a20ac44
Author: Hallvard Furuseth <h.b.furuseth@usit.uio.no>
Date:   Sun Aug 17 00:29:12 2014 +0200

    Fix loose pages in mdb_freelist_save().
    
    Leaving them in dirty_list caused breakage.  Instead merge them
    into me_pghead at the end, when no more pages will be allocated.

commit 983f896aa77027bfc88d9303d2412c58a5a1f2b4
Author: Hallvard Furuseth <h.b.furuseth@usit.uio.no>
Date:   Sat Aug 16 11:34:44 2014 +0200

    Split out mdb_midl_xmerge, add MDB_IDL_ALLOCLEN

commit 992a96e17163d0098f652389a2571f6c31a295c5
Author: Howard Chu <hyc@symas.com>
Date:   Mon Aug 11 11:01:20 2014 -0700

    ITS#7917

commit 322cd26a7bc92fecb92ce92aa49ac5b342ebde50
Author: Howard Chu <hyc@symas.com>
Date:   Mon Aug 11 11:00:11 2014 -0700

    ITS#7917 fix mdb_dbi_open
    
    Don't let dummy go out of scope

commit ada26306992babeccad0c5443fbd76e28dd24cd6
Author: Howard Chu <hyc@symas.com>
Date:   Thu Aug 7 11:06:53 2014 -0700

    Just use memalign, not posix_memalign
    
    Everything has it. Solaris doesn't have posix_memalign.

commit 899b23f89dd9f0eeb795d0772c0a8cd046c84ec3
Author: Howard Chu <hyc@symas.com>
Date:   Mon Aug 4 11:40:24 2014 -0700

    More for MIPS
    
    Do a cacheflush after writing data pages, separate from meta's cacheflush

commit ae0c9f484d4ac8530364b1681a1f1f56fbfea3af
Author: Howard Chu <hyc@symas.com>
Date:   Mon Aug 4 09:26:35 2014 -0700

    ITS#7793 more for branch key update

commit 9cf1749f7329a7c3f53f461aab776685602d7ff6
Author: Howard Chu <hyc@symas.com>
Date:   Mon Aug 4 05:13:29 2014 -0700

    ITS#7793 doc update, again

commit f21f15e5a054546430e6acfa9d639f770184ecbc
Author: Howard Chu <hyc@symas.com>
Date:   Mon Aug 4 04:57:53 2014 -0700

    ITS#7793 update branch key if needed

commit 9febe03eb595d72c1fe933b706559bf66789d1f0
Author: Howard Chu <hyc@symas.com>
Date:   Sat Aug 2 10:33:35 2014 -0700

    More for MIPS
    
    Paranoia for 3630066843b7ca6b2cd12911d3e2fe3314cd4549 do the
    cacheflush before setting mti_txnid.

commit 8498c6cba2d78de420e626245a49db4705e5a6f6
Author: Howard Chu <hyc@symas.com>
Date:   Thu Jul 31 09:59:52 2014 -0700

    ITS#7913 mdb_cursor_get(*_DUP) cleanup
    
    FIRST_DUP/LAST_DUP should succeed even on non-duplicate values
    PREV_DUP should reset cursor's EOF flag.

commit 3630066843b7ca6b2cd12911d3e2fe3314cd4549
Author: Howard Chu <hyc@symas.com>
Date:   Sat Jul 26 18:16:02 2014 -0700

    Fix MIPS cache coherency on Linux
    
    MIPS chips require manual control of on-chip caches. The cacheflush
    syscall being used here only exists on MIPS Linux, other OSs will
    require revisiting.

commit d098184f613791c0712a4c23584ddcb858054e42
Author: Howard Chu <hyc@symas.com>
Date:   Thu Jul 24 04:15:45 2014 -0700

    Update date

commit 082bac1492c1aec8ac0fbe8cc10ac3f46424b836
Author: Howard Chu <hyc@symas.com>
Date:   Thu Jul 24 04:13:55 2014 -0700

    more for mdb_cursor_count
    
    return MDB_NOTFOUND if the cursor is empty

commit 6cb1166635de7812e57aa0a36c68a5c3e85b8284
Author: Hallvard Furuseth <h.b.furuseth@usit.uio.no>
Date:   Wed Jul 9 21:38:45 2014 +0200

    Fix mdb_copy & co when MDB pagesize < OS pagesize

commit 1b08d8e503d3ff7824af990d175a3b966b6b9e33
Author: Howard Chu <hyc@symas.com>
Date:   Wed Jul 23 17:31:34 2014 -0700

    ITS#7789 doc updates

commit 81b502e17e4ed82d73c3c4b88d86b8533dbc4be7
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Wed Jul 23 17:24:31 2014 -0700

    ITS#7789 Fix mdb_env_write_meta().
    
    Always write mapsize = max(other metapage:mapsize, env:mapsize).

commit 7ef970436d83a734f56ddf31f8868eb6032d666a
Author: Howard Chu <hyc@symas.com>
Date:   Wed Jul 23 17:10:41 2014 -0700

    Revert ITS#7789 commits, let's try this again.
    
    Revert "ITS#7789 Fix resize vs MDB_NOMETASYNC, and a comment."
    Revert "ITS#7789 more"
    Revert "Revert "ITS#7789 update RESIZED errmsg text""
    Revert "ITS#7789 update RESIZED errmsg text"
    Revert "ITS#7789 persist mapsize changes"
    
    This reverts commit 02285aca58f5629547263ba09e7dd685dcf6b4b5.
    This reverts commit 38e71c68de2ad61fb0fd72fd40214fd9a94479b9.
    This reverts commit a5e4eecb1e59e9645113bb4c63d06a23a2c4bdf9.
    This reverts commit d8e18551c3f03d5205f4dc8d1711e494d3814b17.
    This reverts commit 5926e54bba7c976e0837221efb20cbff384207b8.

commit 015d6b909ada4b0a7148946ba8159b678d1934ac
Author: Howard Chu <hyc@symas.com>
Date:   Mon Jul 21 18:20:31 2014 -0700

    Fix env_open mode bits

commit 58e9c3add8c3fbe88f930531f237f070a652249b
Author: Howard Chu <hyc@symas.com>
Date:   Mon Jul 21 08:33:59 2014 -0700

    Fix mdb_cursor_count, reject uninit'd cursor

commit fcb0768e7d74e62fcb4158aadaf48ebbe0d73272
Author: Howard Chu <hyc@symas.com>
Date:   Mon Jul 21 08:11:33 2014 -0700

    Silence prototype warnings

commit 204637b18d74e84c100e749ca3e7f2d5fecab01a
Author: Howard Chu <hyc@symas.com>
Date:   Mon Jul 14 09:53:53 2014 -0700

    Typo

commit 9049efe4933b35250a5406f746731ed9f60db60d
Author: Howard Chu <hyc@symas.com>
Date:   Mon Jul 14 09:51:16 2014 -0700

    ITS#7896 fix for mdb_env_map
    
    Don't pass non-NULL map address unless MDB_FIXEDMAP was used.

commit 886ee41d55a410ebadf81cbba3082fdffeed18fd
Author: Howard Chu <hyc@symas.com>
Date:   Wed Jul 9 15:03:54 2014 -0700

    More for cursor EOF
    
    Must also set in sub-cursor if deleting entire subDB

commit 7f038d0f15bec57b4c07aa3f31cd5564c88a1897
Author: Howard Chu <hyc@symas.com>
Date:   Wed Jul 9 12:05:37 2014 -0700

    Zero-init copy2 writebuf

commit 2825ad64c2ee0dbba56b379d227c400be772d88c
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Wed Jul 9 20:18:08 2014 +0200

    MDB_MAXKEYSIZE = 0 (dynamic value) when MDB_DEVEL

commit b3dedde6128041a1c30798555ed94f71bcb803ae
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Wed Jul 9 20:17:13 2014 +0200

    MDB_DEVEL doxygen fix

commit 02285aca58f5629547263ba09e7dd685dcf6b4b5
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Wed Jul 9 20:16:33 2014 +0200

    ITS#7789 Fix resize vs MDB_NOMETASYNC, and a comment.

commit bda6a60ad4ea32eeae6470bd2bcb7ac5e90931b7
Author: Howard Chu <hyc@symas.com>
Date:   Wed Jul 9 10:22:25 2014 -0700

    Windows fixes
    
    Always set the filesize when opening for writes. Otherwise
    can't use backups from mdb_copy.

commit f3573a73831ee05d7d36dd4a5d89df5cbe2e4828
Author: Howard Chu <hyc@symas.com>
Date:   Wed Jul 9 09:31:49 2014 -0700

    Windows compat
    
    We mainly use Win32 functions, so cannot just use C-runtime strerror
    to return error messages. We have to use Win32-specific messages.
    Unfortunately, we document the API to return C-runtime error codes,
    so we can't just switch to all Win32 error codes.

commit c4d0f90fce067aa02c91b975810bcd4391451430
Author: Howard Chu <hyc@symas.com>
Date:   Wed Jul 9 09:16:03 2014 -0700

    Fix loading of printable dump
    
    Off-by-one in end check, would complain on valid input.

commit 38e71c68de2ad61fb0fd72fd40214fd9a94479b9
Author: Howard Chu <hyc@symas.com>
Date:   Wed Jul 9 06:54:32 2014 -0700

    ITS#7789 more
    
    persist size changes from env_open() as well. This was the
    original behavior.

commit a5e4eecb1e59e9645113bb4c63d06a23a2c4bdf9
Author: Howard Chu <hyc@symas.com>
Date:   Wed Jul 9 06:17:54 2014 -0700

    Revert "ITS#7789 update RESIZED errmsg text"
    
    This reverts commit d8e18551c3f03d5205f4dc8d1711e494d3814b17.
    And partially reverts mapsize check. Only mapsize increases are relevant.

commit d5371347e8a4ee5d5861958532007e7467c87a59
Author: Howard Chu <hyc@symas.com>
Date:   Wed Jul 9 05:13:10 2014 -0700

    ITS#7825 more
    
    Set read txn's dbiseqs to env's. Set child txn's dbiseqs to parent's.
    Simplify DBI_CHANGED test, no need to check md_name. No-op dbi_close
    of already closed handle.

commit e0273020bd1a14956fee04094d8380f8b30a13e5
Author: Howard Chu <hyc@symas.com>
Date:   Tue Jul 8 21:40:11 2014 -0700

    Updates #7789, #7825

commit 276aa559698ff3eca42bc855237296c29efad4fd
Author: Howard Chu <hyc@symas.com>
Date:   Tue Jul 8 21:31:48 2014 -0700

    ITS#7825 more
    
    only update dbiseq in dbi_open on write txns

commit 04851e442f8939c38175b9742af5d62a19e1ee30
Author: Howard Chu <hyc@symas.com>
Date:   Tue Jul 8 21:22:07 2014 -0700

    ITS#7825 tweak prev commit
    
    dbiseqs are only checked in write txns so omit from read txns

commit 0401f2deed75a83d2de790b8a1313e1792e5a04f
Author: Howard Chu <hyc@symas.com>
Date:   Tue Jul 8 21:02:40 2014 -0700

    ITS#7825 add MDB_BAD_DBI error code
    
    Use DBI sequence numbers to detect DBIs being closed while in use.

commit d8e18551c3f03d5205f4dc8d1711e494d3814b17
Author: Howard Chu <hyc@symas.com>
Date:   Tue Jul 8 20:05:31 2014 -0700

    ITS#7789 update RESIZED errmsg text

commit 5926e54bba7c976e0837221efb20cbff384207b8
Author: Howard Chu <hyc@symas.com>
Date:   Tue Jul 8 19:06:45 2014 -0700

    ITS#7789 persist mapsize changes
    
    Write decreases too, not just increases. Check for any size change
    that was not requested by this process.

commit 604256ceffa2c3401ea6c15e756b3f0155f2c742
Author: Howard Chu <hyc@symas.com>
Date:   Tue Jul 8 16:27:26 2014 -0700

    Update LMDB version date/info

commit 2f04728471384e8c1ea06d850590002d45deb3ad
Author: Howard Chu <hyc@symas.com>
Date:   Tue Jul 8 16:27:03 2014 -0700

    ITS#7892 Fix MacOSX section name

commit e1a676eb18448d0ea396c9bbe8908d25b38ddb6d
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Tue Jul 8 15:01:18 2014 -0700

    ITS#7713 cleanups
    
    '#ifdef MDB_DEVEL' -> '#if MDB_DEVEL'
    Fix comments, use actual PAGEBASE macro as originally intended.
    Actually enable 64K pages. Set MDB_DATA_VERSION for testing only.

commit 6ed295b2569c916f9ab1a93c76b6081ad2910794
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Tue Jul 8 11:52:53 2014 -0700

    Fixes for loose pages
    
    mdb_txn_commit(child): Give loose pages to parent.
    Use a pointer beyond the page header instead of mp_next, so
    we will not need to save/restore mp_pgno. This avoids a crash
    caused by references to mp_pgno.

commit b3e8c71dc7d629f6311801774d275712bf72631f
Author: Howard Chu <hyc@symas.com>
Date:   Tue Jul 8 11:54:24 2014 -0700

    Re-fix cursor EOF
    
    Fix in 534dcc721287cfe1051191a5cd7d3df6cf1dc409 was in wrong place

commit 68e6faad5c32293a5fdb1b7b7e99734f1cc1d1d1
Author: Howard Chu <hyc@symas.com>
Date:   Mon Jul 7 09:12:22 2014 -0700

    ITS#7713 handle 65536 byte page size
    
    Fix mp_lower/mp_upper to exclude PAGEHDRSZ, which means our
    max mp_upper is now pagesize - PAGEHDRSZ and won't overflow.
    Currently must define MDB_DEVEL to use. Will be default for
    LMDB 1.0/OpenLDAP 2.5

commit 534dcc721287cfe1051191a5cd7d3df6cf1dc409
Author: Howard Chu <hyc@symas.com>
Date:   Mon Jul 7 17:13:51 2014 -0700

    Set xcursor EOF after deleting last entry

commit 1ac5147fc175907f0c657ce8416c70242eb91fd5
Author: Howard Chu <hyc@symas.com>
Date:   Sun Jul 6 17:47:25 2014 -0700

    Compacting copy doesn't need to snapshot metas

commit 61f7ec9bfa772f458d0ef8c25a298d7f4b42d8b3
Author: Howard Chu <hyc@symas.com>
Date:   Sun Jul 6 07:49:38 2014 -0700

    Windows fixes

commit 7d996d7f3d4c14086637c3fd929366c93af7c21e
Author: Howard Chu <hyc@symas.com>
Date:   Sat Jul 5 08:48:47 2014 -0700

    Play games with object file layout
    
    Use gcc section attribute to keep less frequently used functions
    away from main code.

commit 3e98addbe294c69b94545141f466836bf92693ee
Author: Howard Chu <hyc@symas.com>
Date:   Sat Jul 5 07:49:10 2014 -0700

    Rationalize mdb_env_copy2 API

commit 059b357d1addb52bbbbe4fd257ccfd906c3e6445
Author: Howard Chu <hyc@symas.com>
Date:   Thu Jul 3 14:26:14 2014 -0700

    More tweaks to copyfd2
    
    Make sure the writer thread starts and stops when we expect it to.

commit 03f0ecb0018487626bfa31d7b870b7b38517a88a
Author: Howard Chu <hyc@symas.com>
Date:   Thu Jul 3 10:49:05 2014 -0700

    More copyfd2 tweaks

commit 6043103c1311e278b255f5881393cea4704af225
Author: Howard Chu <hyc@symas.com>
Date:   Thu Jul 3 08:31:57 2014 -0700

    Fix envinfo to return fixed map address

commit 64191264b8e8582a9d70239c3ad5dd36464ca7b4
Author: Howard Chu <hyc@symas.com>
Date:   Thu Jul 3 07:49:22 2014 -0700

    Windows compat

commit 8836b78e945d6cabb0e21c04f89a40bd0478359f
Author: Howard Chu <hyc@symas.com>
Date:   Wed Jul 2 11:44:06 2014 -0700

    Fix subDB/ovpage copying

commit af3c3407585fe9a75e750434135645512f58d846
Author: Howard Chu <hyc@symas.com>
Date:   Wed Jul 2 08:06:19 2014 -0700

    Larger WBUF still better on large DB

commit 342cd72f2574a050469a8f37b0bf54786ad9c954
Author: Howard Chu <hyc@symas.com>
Date:   Wed Jul 2 07:45:12 2014 -0700

    Don't check LEAF2 pages for subnodes

commit 4009c9ae65144e3da5879477ba8696908593c26a
Author: Howard Chu <hyc@symas.com>
Date:   Tue Jul 1 21:45:43 2014 -0700

    Add mdb_env_copy2()
    
    And mdb_env_copyfd2(). Perform compaction on the copy. Trims out
    freed pages and renumbers data pages in sequential order. This is
    more CPU-intensive since it copies and modifies data pages.

commit 4d65cf13265e6936ffca9047dbd2e323b1ace7c5
Author: Howard Chu <hyc@symas.com>
Date:   Tue Jul 1 18:53:47 2014 -0700

    dump/load need mapsize etc.

commit c5be1292ac21fed2242ad98f3ae5b491d8b8cdea
Author: Howard Chu <hyc@symas.com>
Date:   Tue Jul 1 05:11:43 2014 -0700

    All diagnostics should go to stderr

commit ee599c525052948b623e8980db67c7032feedb4e
Author: Howard Chu <hyc@symas.com>
Date:   Mon Jun 30 04:42:41 2014 -0700

    More gcov setup tweaks

commit b09e46904c1c059bd5086243e3915b6be510e57d
Author: Howard Chu <hyc@symas.com>
Date:   Mon Jun 30 04:41:50 2014 -0700

    ITS#7886 fix mdb_copy write size
    
    Don't try to write past end of file

commit 91d8ad1d3c3364a667ed91cb8551327ea14ea8e0
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Jun 28 13:38:03 2014 +0200

    Fix mdb_page_loose() vs. mdb_page_flush().
    
    Do not overwrite loose pages' mp_pgno with mp_next.
    mdb_page_flush() will use mp_pgno to rebuild dirty_list.

commit c73f0877500c01d978a4e8b1d50bd64011f70984
Author: Howard Chu <hyc@symas.com>
Date:   Fri Jun 27 10:53:11 2014 -0700

    Trap signals
    
    Try to exit cleanly to avoid leaving stale readers. Not
    a critical issue since mdb_reader_check can take care of
    them, but still cleaner.

commit 277526d0f00489637798f84b5cf4e8d65a1690ca
Author: Howard Chu <hyc@symas.com>
Date:   Thu Jun 26 05:19:47 2014 -0700

    Setup for gcov/coverage testing

commit a3e5539505ce6397b052078deff5ed816fe2ad16
Author: Howard Chu <hyc@symas.com>
Date:   Tue Jun 24 11:43:13 2014 -0700

    More for mdb_page_loose
    
    Require that the page is dirty in the current txn,
    not a parent txn.

commit 7fe85f5c8291f531f93c28b98865367aeca75484
Author: Howard Chu <hyc@symas.com>
Date:   Tue Jun 24 04:42:44 2014 -0700

    More MDB -> LMDB renames

commit 9a4ef8406eac173875e67131421a684c34bf92f3
Author: Howard Chu <hyc@symas.com>
Date:   Tue Jun 24 04:16:19 2014 -0700

    Doc updates
    
    Rename MDB -> LMDB
    Integrate tool manpages

commit ca47c2af1f4d90e1a0ec7e4c6ce4937262c18c74
Author: Howard Chu <hyc@symas.com>
Date:   Mon Jun 23 07:39:06 2014 -0700

    ITS#7879 Windows build compatibility
    
    Just use srand/rand, we don't care about the quality
    of the random numbers, we just want some data.

commit 225bcae3e7bf944d0740609dd331e08900ae4161
Author: Howard Chu <hyc@symas.com>
Date:   Mon Jun 23 07:36:38 2014 -0700

    Flesh out mdb_cmp_cint for BigEndians

commit aa89ca31b3a95f266cd2b354037466a2d950bc1f
Author: Howard Chu <hyc@symas.com>
Date:   Sun Jun 22 16:39:14 2014 -0700

    More for page_loosen
    
    Don't try this when working on the FreeDB. Again,
    too much hassle to unkink the recursions...

commit d9423e13f85bac7c33083a4b872c022d18a41232
Author: Howard Chu <hyc@symas.com>
Date:   Sat Jun 21 15:53:41 2014 -0700

    More cleanup for page_merge, page_loosen
    
    Only loosen src page if it's actually dirty.
    Refactor page refs in page_merge.

commit cf331ccb3dc482769d6ac8d75cc66249b0086d29
Author: Howard Chu <hyc@symas.com>
Date:   Sat Jun 21 08:34:45 2014 -0700

    Silence ptr arithmetic warnings

commit 7cab7b95e240446dd11c7e0951af8b2c3409765b
Author: Howard Chu <hyc@symas.com>
Date:   Sat Jun 21 03:30:34 2014 -0700

    Handle loose pages
    
    Pages that were dirtied and deleted in the same txn should be
    reused, instead of consuming freeDB pages.

commit eebbd22c2ff9d6088e307c960be56baf35e1ab0d
Author: Howard Chu <hyc@symas.com>
Date:   Fri Jun 20 23:40:44 2014 -0700

    Fix mdb_page_merge
    
    Similar to prev commit for mdb_node_move, the call of
    mdb_page_serch_lowest() was leaving csrc unusable.

commit 79e8462d748543f7dc36a3ff3fa8263c62b34c3f
Author: Howard Chu <hyc@symas.com>
Date:   Fri Jun 20 17:56:04 2014 -0700

    Fix mdb_node_move
    
    Was leaving stale info in dst cursor

commit 0d013609fe754dd065faf77297d8d5b1c93bb672
Author: Howard Chu <hyc@symas.com>
Date:   Fri Jun 20 09:03:41 2014 -0700

    Fix lineno count

commit c05f45b7dd83ab582c99a720fd44d6a6ba8ddf32
Author: Howard Chu <hyc@symas.com>
Date:   Fri Jun 20 09:00:33 2014 -0700

    Fix multiple subDBs

commit 1a72b19e26d226eaec26a7f9cd231337f20bf4da
Author: Howard Chu <hyc@symas.com>
Date:   Fri Jun 20 08:56:52 2014 -0700

    Fix unhex

commit 21b51cb746aa455e3c6398f35b56b9117e657d64
Author: Howard Chu <hyc@symas.com>
Date:   Fri Jun 20 08:49:59 2014 -0700

    Add mdb_load

commit 3e83b5b27bcd76a5ae086573516f9b76bdc6e2da
Author: Howard Chu <hyc@symas.com>
Date:   Fri Jun 20 05:33:31 2014 -0700

    Add mdb_dump, update copyrights

commit 59d30a49c3ad403235ba30f65e074eddf1c125f0
Author: Howard Chu <hyc@symas.com>
Date:   Wed Jun 18 14:25:46 2014 -0700

    Bump to 0.9.13

commit 0c041e09779f0775d884304782be921d99fdbef2
Author: Howard Chu <hyc@symas.com>
Date:   Wed Jun 18 14:07:15 2014 -0700

    Bump to 0.9.13

commit b898cb642abc019556104e1977edc8c0518806c6
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Wed Jun 18 23:01:14 2014 +0200

    ITS#7793 Re-fix MDB_CURRENT doc: Match current item

commit 01a75c5ab51ad15c02ce6f256b2f272e1cf7881e
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Wed Jun 18 23:01:14 2014 +0200

    Fix MDB_GET_MULTIPLE/MDB_NEXT_MULTIPLE doc.

commit 39ed8bef0406844fca087d194416748afe8ca27f
Author: Howard Chu <hyc@symas.com>
Date:   Wed Jun 18 13:37:04 2014 -0700

    Tweak ovpage search
    
    Use num*20, chosen from empirical testing

commit b4ecbd78d9d153f653eb338ce34d553c4c96fb65
Author: Howard Chu <hyc@symas.com>
Date:   Wed Jun 18 12:29:13 2014 -0700

    Fix some overwrite quirks
    
    Was skipping the overwrite in some cases, if the cmp function
    said the new and old already matched. We should always perform
    the overwrite anyway, since the cmp function may only be doing
    a prefix compare and the data may actually be different.

commit dc7f2530dd0fca5f9030e1d457306674f6cd6966
Author: Howard Chu <hyc@symas.com>
Date:   Wed Jun 18 09:07:39 2014 -0700

    Tweak prev patch for ovpage search

commit 2db55c7d999bafe488550af10fa722d47b93d1c5
Author: Howard Chu <hyc@symas.com>
Date:   Wed Jun 18 03:02:08 2014 -0700

    Shorten search for ovpage space

commit 52406746bd08639bcbd9fb70c2f56b830655a775
Author: Howard Chu <hyc@symas.com>
Date:   Wed Jun 18 02:53:17 2014 -0700

    Remove bogus file
    
    added by mistake in 17c09fa476a7dbd49aca5e4caf0384cb1c3d244a

commit ecb71ee197e3cc080ec229bbdaa9f0d219f1a77d
Author: Howard Chu <hyc@symas.com>
Date:   Fri Jun 13 10:46:27 2014 -0700

    Bump version to 0.9.12

commit 17c09fa476a7dbd49aca5e4caf0384cb1c3d244a
Author: Howard Chu <hyc@symas.com>
Date:   Wed Jun 11 02:27:30 2014 -0700

    ITS#7875 fix #7681 regression
    
    Due to commit 18a07eb7c2dc33372455a6040984cd6b699b41a5

commit a93810cc3d1a062bf5edbe9c14795d0360cda8a4
Author: Alexey Naumov <alexey.naumov@gmail.com>
Date:   Sun May 25 17:10:21 2014 +0600

    Fix possible crash in DLL_THREAD_DETACH (explodes in .Net Framework)

commit c0d64cf182eac07745965cb14dcc084315fcc0ae
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Fri May 30 10:50:04 2014 +0200

    Comment ~MDB_APPEND, from earlier commit message.

commit cb5656c726551cc22ea149ab177fb5a2db4ac6c6
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Fri May 30 10:47:56 2014 +0200

    Factor out mdb_cmp_clong()

commit 64a02e22799da289314001e16bfc6d2e89f63601
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Fri May 30 10:47:56 2014 +0200

    More for big MDB_MAXKEYSIZE with MDB_DUPSORT.
    
    With mdb_cursor_put(new key, data item big enough to need a sub-DB):
    - Track cursors as when adding other nodes.  The "!do_sub" is now
      unneeded.  Before ITS#7861 it distinguished inserting key from data.
    - Set MDB_TXN_ERROR if an empty sub-DB was created.  I.e. adding
      key:subDB succeeded, but inserting the data item failed.

commit b37b2a651ff2df3824d3f403538627983d5b81d1
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Fri May 30 09:06:08 2014 +0200

    Factor out MDB_TXN_ERROR

commit ba8f59edf42ff700bebf65e7e30e3d1f0101b326
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Fri May 30 09:06:08 2014 +0200

    Simplify MDB_MULTIPLE

commit ac158c7e1e1a86b13eb7c0d2b14169c0e43e6198
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Fri May 30 09:06:08 2014 +0200

    ITS#7834 Fix MDB_MULTIPLE writing multiple keys.
    
    Update the state before looping, so the key is not duplicated.
    Broke in 4c8f57615c5ca7b014c038e59c1045182e74f5ad (mostly).

commit d170df58fbd5ab2e99783f945f0d86d3d3749296
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Fri May 30 09:06:08 2014 +0200

    ITS#7861 Re-fix MDB_db.md_entries.
    
    mdb_cursor_del(): Fix md_entries with MDB_NODUPDATA.
    mdb_cursor_put(): Check in xcursor whether an item got inserted. Count
    data instead of keys after 13d6d59c512065db3741c20c65b4d9928b986968.

commit 92c01ffda80fe2224391b46b9be12eeb449456bf
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Fri May 30 09:06:08 2014 +0200

    ITS#7771 mdb_cursor_put doc: Cursor moves on error

commit 83676dc0f0c77b4de4fd5e942a50038f5c5ba17a
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Fri May 30 09:06:08 2014 +0200

    Document DBI issues, extend MDB_BAD_VALSIZE.

commit 2f33effcdc4f21fec8da9921044de0d124709e80
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Fri May 30 09:06:08 2014 +0200

    More ITS#7793 Check key->mv_size with MDB_CURRENT.
    
    Since non-NULL key must be provided now.

commit 4b9aed26a5b1c0027b10d211c6e7270dbb1ade1c
Author: Howard Chu <hyc@symas.com>
Date:   Tue May 20 08:47:28 2014 -0700

    Fix mdb_rebalance collapsing root
    
    Shift the rest of the cursor stack as needed

commit 4844a72d012ec4340ad62b9d4ed648a1d7a5cd53
Author: Howard Chu <hyc@symas.com>
Date:   Thu Apr 3 12:51:41 2014 -0700

    ITS#7829 more for mdb_rebalance
    
    Make sure to propagate rebalance results all the
    way back to original caller's cursor.

commit 2764360a7b273e579add29830ee0a0419ad37f71
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Wed Apr 2 07:02:14 2014 +0200

    ITS#7829 Simplify last commit

commit fca18d2586259c0e802d0276f86be696863b1905
Author: Howard Chu <hyc@symas.com>
Date:   Mon Mar 31 13:42:19 2014 -0700

    ITS#7829 more for prev commit

commit ac3acc121855e4297d597a4d71e9863e1e1e2450
Author: Howard Chu <hyc@symas.com>
Date:   Fri Mar 28 13:51:59 2014 -0700

    ITS#7829 fix rebalance
    
    Fixup cursor state after node_move/page_merge

commit 13d6d59c512065db3741c20c65b4d9928b986968
Author: Howard Chu <hyc@symas.com>
Date:   Wed Mar 26 08:59:43 2014 -0700

    ITS#7793/7828
    
    Fix md_entries count, test for insert on md_entries increment

commit 6948f9dace36875f797aeee713019740817e6579
Author: Howard Chu <hyc@symas.com>
Date:   Wed Mar 26 02:41:26 2014 -0700

    More for ITS#7793/7828
    
    Note MDB_CURRENT/MDB_DUPSORT requirement

commit f537429b64dc57d669ded6aae8c7e43c7d2ae978
Author: Howard Chu <hyc@symas.com>
Date:   Wed Mar 26 02:33:51 2014 -0700

    ITS#7828, #7793
    
    Clarify MDB_CURRENT key usage, simplify freelist_save

commit 9026894e05a016f4e7cfe675490b7ede3db10e73
Author: Howard Chu <hyc@symas.com>
Date:   Wed Mar 26 02:18:20 2014 -0700

    Revert "ITS#7793 mdb_cursor_put(): Fix MDB_CURRENT."
    
    This reverts commit 4e954f8ae83d5b39736bab2da0eaf2bdf5ee3961.
    Caused ITS#7828.

commit 86d9675543b82856523826c5c16fde0f8dc2b745
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sun Mar 23 13:06:03 2014 +0100

    Revert "Update MDB_PANIC description" (thinko).
    
    This reverts commit 6bd34d0534f1c8bfd73deaf70febd3b58a2f9d5a.

commit 6bd34d0534f1c8bfd73deaf70febd3b58a2f9d5a
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Mar 22 22:27:10 2014 +0100

    Update MDB_PANIC description

commit 1519f4bc3d105a5cbb7f1b624d8fd91e7d90c70e
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Mar 22 22:27:10 2014 +0100

    Tweak mdb_mid2l_insert() call from ITS#7775.
    
    It does not return MDB error codes.

commit 2727e97de35320b0ac433ff2e811b9640bb66996
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sun Mar 16 12:42:43 2014 +0100

    mtest: Accept an MDB_NOTFOUND case

commit 68e97b2184063e91d62eed7d862d133f2e4ca314
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sun Mar 16 12:42:43 2014 +0100

    Handle more errors. Invalidate txn if needed.

commit 937b5eff07e30563a4b55fdde936191eb64f0f3b
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sun Mar 16 12:42:42 2014 +0100

    Don't use non-existent node info in branch/leaf2

commit 86f8b203f5b3f293df28f12836f1d68d28a0c2ee
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sun Mar 16 12:42:42 2014 +0100

    Move code out of mdb_cursor_del0() and mdb_del().
    
    Prepares for the next commits.

commit 012d7b5de7b9942c29d0c849e8153b7b81b59082
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sun Mar 16 12:42:42 2014 +0100

    More checks for closed DBIs and invalidated txns.
    
    Factor txn/DBI-checks out to TXN_DBI_EXIST().
    mdb_audit(): Skip closed DBIs.
    mdb_cursor_renew(), mdb_stat(): Check DBI and txn.
    mdb_cursor_count(): Check txn.
    mdb_dbi_flags(): Check DBI.

commit 3e7c1bd4e22270d1b95fff572a7726983ca68e8d
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sun Mar 16 12:42:42 2014 +0100

    mdb_page_list(): Support & display all page types

commit a22c31115f480eff906d51b53a998d269da83452
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sun Mar 16 12:42:42 2014 +0100

    mdb_txn_renew0(): Fix un-mutexed me_flags update.
    
    Replace env flag MDB_LIVE_READER with field me_live_reader.

commit 684bb867ced9f0ccde0268b6a3e839ebcb00ff6b
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sun Mar 16 12:42:42 2014 +0100

    Doxygen fixes

commit 4ddf2ec83176ef6f1d2db2eb95f1f931de25c81d
Author: Howard Chu <hyc@symas.com>
Date:   Sun Mar 16 03:55:03 2014 -0700

    Rename samples
    
    They're meant to be read and studied, not run.

commit 797ff136a8852d8301a946a2f29b2c34caa084d0
Author: Howard Chu <hyc@symas.com>
Date:   Wed Mar 5 20:40:12 2014 -0800

    ITS#7815 more for page_split
    
    This case didn't come up in testing. Needs finer grained test.

commit 0e7fba73b7e63a39fa62f532a289bef92069ba6e
Author: Howard Chu <hyc@symas.com>
Date:   Wed Mar 5 20:04:42 2014 -0800

    ITS#7815 fix mdb_page_split
    
    Was leaving cursor pointed at wrong page if the newindx was
    in the right sibling page, and the parent was also split.

commit e2bdd44624a525d4847c22d7ebf1ea4d154ed734
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Wed Feb 19 21:25:40 2014 +0100

    mtest*.c, sample-*.c: Add/note error checks.

commit a6049489930dccd7354b8b681fe3e754032edb02
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Wed Feb 19 21:25:40 2014 +0100

    mtest[46]: Use different DBs when different flags.

commit 4e954f8ae83d5b39736bab2da0eaf2bdf5ee3961
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Tue Jan 28 14:27:27 2014 +0100

    ITS#7793 mdb_cursor_put(): Fix MDB_CURRENT.
    
    Ignore key, broken by 5bda3565a9bfaa6cd54053faeafcc06da15bc00c
    and some older code.  Document and clarify MDB_CURRENT usage.
    
    Also affects non-MDB_CURRENT put() with empty data and a key
    which matches by the mdb_set_compare function but not by memcmp.

commit aa3463ec7c5e979420b13c8f37caa377ed2c1cf1
Author: Howard Chu <hyc@symas.com>
Date:   Wed Jan 15 09:09:48 2014 -0800

    Bump version to 0.9.11

commit ec97f49a6552a8ed599472d665ec7c16463b808c
Author: Howard Chu <hyc@symas.com>
Date:   Tue Jan 14 17:12:48 2014 -0800

    Note changes for LMDB 0.9.11

commit 98f3bc88bf4b268f14b9c415aa138dfdd05bfe05
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Mon Jan 13 20:46:08 2014 +0100

    Revert "ITS#7772 Reduce spurious sub-page growth."
    
    This reverts commit 75494c08b49c3ef77dce8a00f2bc44c83658c1a7,
    which must await a fix to ITS#7771 (DUPSORT cursor tracking).

commit 3f241365d5b3c0afdca888248a90a137d0b8b3d5
Author: Howard Chu <hyc@symas.com>
Date:   Sun Jan 12 17:37:04 2014 -0800

    Make sure mapsize changes take effect on Windows.

commit 5bda3565a9bfaa6cd54053faeafcc06da15bc00c
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Mon Jan 6 23:21:54 2014 +0100

    ITS#7775 Drop <assert.h>, drop/replace assert()s.
    
    db_mid2l_insert(): Move assert to mdb.c.
    mdb_cursor_set(): Previous assert cannot fail now.
    mdb_cursor_put(): Check mc/key and return EINVAL.
    mdb_cursor_dbi(): No error return, so just segfault if cursor==NULL.

commit 6fb561d33ed7be4b37437c5c6e52b27ddd984c4b
Author: Howard Chu <hyc@symas.com>
Date:   Mon Jan 6 23:21:44 2014 +0100

    ITS#7775 Cleanup mdb_node_del()

commit 88342f96613f0bac47c63351832f84c58843da92
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Mon Jan 6 23:17:38 2014 +0100

    ITS#7775 Add mdb_env_set_assert()

commit e40dae106424d6b7d6e9fa10f5fd0ee08df76f6d
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Mon Jan 6 23:17:38 2014 +0100

    Add mdb_env_<set,get>_userctx()

commit c99525f42ac1fe39ba6aba50ef66bb3c73ff577c
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Mon Jan 6 23:17:37 2014 +0100

    ITS#7377 Invalidate txn on page-allocation errors
    
    This should likely be reverted when all callers handle these errors.

commit 123b6e3c3e8718be878f36f8137bf558a3ca6e9f
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sun Jan 5 16:37:26 2014 +0100

    Wrap __func__ in mdb_func_

commit 21621cc7415886e12f73dc9d9349cedc25ee309b
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sun Jan 5 16:26:21 2014 +0100

    Invalidate the txn on corruption/internal errors

commit c48cdd7a1669b37bab550712c3c2099fcc1621be
Author: Howard Chu <hyc@symas.com>
Date:   Fri Jan 3 12:40:28 2014 -0800

    ITS#7775 cleanup unnecessary assert()s

commit 1f191ba930938d6860e68f859fb1eb8374fbe799
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Tue Dec 31 02:16:19 2013 +0100

    mdb_page_malloc(): Move VGMEMP_ALLOC before memset

commit ce2a0d4016e1ff194923d70afed3a66850e3afbb
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sun Dec 29 15:58:21 2013 +0100

    ITS#7771 mdb_cursor_del0(): Fix xcursor tracking.

commit 5adc46d1d209237618e8f6a22cf0b1562a729fed
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sun Dec 29 15:57:33 2013 +0100

    sprintf format: pid_t need not be an int.

commit 661dd2c66d114a059075b5e771b9ac25c4cba5b9
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sun Dec 29 15:09:51 2013 +0100

    Add mdb_dbg_pgno(): (sub)pagenum for debug output.

commit 75494c08b49c3ef77dce8a00f2bc44c83658c1a7
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sun Dec 29 15:09:05 2013 +0100

    ITS#7772 Reduce spurious sub-page growth.
    
    mdb_cursor_put(): Use free sub-page space added by a
    previous put(existing DUPSORT item), if any.
    Tweak NUMKEYS code to avoid a new signedness warning.

commit 46de4ab84c57b417ca2faab38e341154a11d083c
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sun Dec 29 14:54:17 2013 +0100

    ITS#7665 Drop lmdb.h doc on non-overlapping flags.
    
    It was inaccurate and misplaced. Verify it in mdb.c instead.

commit 353cc77cffa46113849cb9d74cf882d6b0ddb24a
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sun Dec 29 14:52:30 2013 +0100

    ITS#7515 has been fixed.

commit c91f38160cdd2238d46bb0f3a307eb1d807cad41
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sun Dec 29 14:52:30 2013 +0100

    Drop UNLOCK_MUTEX_R() on mdb_reader_pid() error

commit 4c8f57615c5ca7b014c038e59c1045182e74f5ad
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Dec 21 12:31:57 2013 +0100

    Fix commit "Raise safe max MDB_MAXKEYSIZE."
    
    I.e. d69d2ce2307e9d0e2167843935c386b05a869c31, it left out some changes.

commit a2ed03642ca325cfe7685d6df782f3b363f9e46c
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Wed Dec 11 11:57:13 2013 +0100

    Replace MDB_node.mn_offset[], to ease debugging.

commit 2ce9ffa003ca190c25b68bd5486635a186f967d8
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Wed Dec 11 11:57:13 2013 +0100

    Comment MDB_node, mdb_page_unspill, mdb_update_key

commit 7e453c97632599a420824c06458353f2a18242aa
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Wed Dec 11 11:57:13 2013 +0100

    Fix mdb_reader_list() and its spec.
    
    It and the MDB_msg_func can now return >= 0 for success.
    Always return any MDB_msg_func() error result.

commit a58fd16ae5823823567d51c33f7ca07d983255f9
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Wed Dec 11 11:57:13 2013 +0100

    Support dynamic max MDB keysize.

commit d69d2ce2307e9d0e2167843935c386b05a869c31
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Wed Dec 11 11:57:13 2013 +0100

    Raise safe max MDB_MAXKEYSIZE.
    
    Use a sub-DB for DUPSORT item #1/#2 per key if needed: Not a sub-
    page too big for a node, nor an overflow page (which not all DUPSORT
    code checks for). Move "insert" code, to avoid non-loop goto upwards.
    
    (This is the commit which needs the change to xdata.mv_size in
    commit 9d6e4a916367e85ffdf37b1cb7b5cdb7ac0e15b5 "page sizes".)

commit 734bc7e6ada2588cddac6a67688421591a895807
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Wed Dec 11 11:57:12 2013 +0100

    Relax MDB_MAXKEYSIZE for existing data.
    
    Handle keys stored by a liblmdb with a bigger MDB_MAXKEYSIZE.
    mdb_get/mdb_del(absent key bigger than our MDB_MAXKEYSIZE)
    now return MDB_NOTFOUND instead of MDB_BAD_VALSIZE.

commit a8de10d148e99297c9ce4fba7a6ede053c3d6c74
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Wed Dec 11 11:57:12 2013 +0100

    ITS#7589 Fix me_nodemax and related node sizes.
    
    Change me_nodemax to not count the mp_ptrs[] entry. That's mostly
    how it was used. Compare node sizes ">" me_nodemax instead of ">=".
    The ">=" was a workaround for confusing sizes with and without the
    mp_ptrs[] entry, but broke for nodes with size (old me_nodemax-1).
    
    Explicitly make me_nodemax even. An odd value could break the
    comparisons. It was even anyway because MDB_MINKEYS == 2.

commit 6808abe770d916c395a20718571ff843c903af71
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Wed Dec 11 11:57:12 2013 +0100

    ITS#7589 Fix delete(uneven-sized MDB_DUPFIXED data).
    
    Do not give uneven sizes to the sub-page and the node it lives in.

commit c0858e6d93edb062b3f33672c37294c60dfdf069
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Wed Dec 11 11:57:12 2013 +0100

    put(MDB_MULTIPLE): Skip existing item cleanly.
    
    Don't set dkey.mv_size if mdb won't clear it before next iteration.

commit fcb0d09598ace3b47ef95022d2f3b41f531a7d1f
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Wed Dec 11 11:57:12 2013 +0100

    Add EVEN(): Micro-optimize "up to multiple of 2".

commit 753356a38a01eb5ec62ee3b0c3f0100e38b4ecf8
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Wed Dec 11 11:57:12 2013 +0100

    Warning cleanup.
    
    Drop unused computed/assigned values.
    mdb_page_alloc(): Make "mop_len>0 implies mop!=NULL" provable.

commit e1266bf33174383cec0a1a8a25133cf86bbd51ff
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Wed Dec 11 11:57:12 2013 +0100

    Clean up mdb_copy.
    
    Support MDB_NOSUBDIR. Catch more errors.  Write messages
    to stderr, not stdout which the data too may be piped to.

commit 1ffb5e1cba200b0e362d1f7a56f09f8ad8081451
Author: Howard Chu <hyc@symas.com>
Date:   Wed Dec 4 18:42:49 2013 -0800

    Fix GET_BOTH_RANGE
    
    On near match, return the matched data.

commit b77689f97572980d5de729e2fe6d8a5e6e9d6218
Author: Howard Chu <hyc@symas.com>
Date:   Fri Nov 29 17:03:49 2013 -0800

    ITS#7756 keysizes were wrong in mdb_update_key

commit f39bceb800dd1b1b4b05cfb45a3ddde94a273fff
Author: Howard Chu <hyc@symas.com>
Date:   Tue Nov 12 08:10:33 2013 -0800

    Doc tweak
    
    Measured perf cost of meminit was 7% worst case on an Intel Core2
    system. YMMV.

commit 3e40d0c8058967c1e0511f14ee1de36456c61386
Author: Howard Chu <hyc@symas.com>
Date:   Mon Nov 11 20:15:54 2013 -0800

    Bump to 0.9.10

commit f6d8dc4e768a0bd6fb6cf7ae48a0509b971dd90b
Author: Howard Chu <hyc@symas.com>
Date:   Mon Nov 11 20:08:26 2013 -0800

    Windows/Win64/MSVC tweaks
    
    Silence warnings, fix broken MinGW64 definitions, etc.

commit eecbaa594290a42af1ab594786663511ab757e92
Author: Howard Chu <hyc@symas.com>
Date:   Mon Nov 11 16:35:17 2013 -0800

    Clarify WRITEMAP / NOMEMINIT

commit 509a1977284a8d8c3affea9fc1afb9fa70ddb533
Author: Howard Chu <hyc@symas.com>
Date:   Mon Nov 11 15:09:32 2013 -0800

    Change default mem init behavior
    
    Init malloc'd memory by default, use #MDB_NOMEMINIT to disable.
    Bump version to 0.9.10

commit 92f71f50f9f2a9e93c7d757538688376a6f6debb
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Thu Nov 7 23:41:30 2013 +0100

    Add MDB_CLEANMEM option.
    
    Initialize unused portions of DB pages, for security or to silence
    checkers like Purify and Valgrind. Like BDB configure --enable-umrw.

commit fc87d405f1636d2241306584189f6b1266bbb833
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Thu Nov 7 23:38:15 2013 +0100

    Fix MDB_MAXKEYSIZE doc: Account for MDB_DUPSORT.
    
    A node may need room for [key, subpage with 2 items] = 3 keys.

commit 9d6e4a916367e85ffdf37b1cb7b5cdb7ac0e15b5
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Thu Nov 7 23:38:15 2013 +0100

    ITS#7713 Handle bigger OS page sizes
    
    Use DB page size = min(32k, OS pagesize).  Previous limit was 8k
    (MDB_MINKEYS*MDB_PAGESIZE).
    
    Handle DB pagesize < OS pagesize. That's an I/O pessimization,
    but transactions remain atomic: Only writing the MDB_meta must
    be atomic, and it fits in one OS page.
    
    Don't truncate desired subpage size: Asssign it to a size_t
    (mv_size), not an uint16_t (mp_upper).

commit 25d370cb2e13a6959e78fa20da750bfc1643d837
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Thu Nov 7 23:38:15 2013 +0100

    mdb_cursor_put(): Factor out code. Kill a label.

commit 550bbe3788fafdf0fddcb2130173c1349fbc477f
Author: Howard Chu <hyc@symas.com>
Date:   Thu Nov 7 09:37:48 2013 -0800

    Fix prev commit, cursor depth comparison

commit 4a1717708cf1127c3d5d9f4101af69d67d8296d7
Author: Howard Chu <hyc@symas.com>
Date:   Wed Nov 6 16:49:25 2013 -0800

    Fix cursor_del0 cursor fixup
    
    Skip cursors that aren't as deep as current cursor

commit 8c9a26c90d603a6040a74042ae995a95cadddda7
Author: Howard Chu <hyc@openldap.org>
Date:   Mon Nov 4 20:00:55 2013 -0800

    More for #7589

commit 34459e05856619e8647ef95c865d5c766f275ed7
Author: Howard Chu <hyc@openldap.org>
Date:   Thu Oct 31 17:31:15 2013 -0700

    ITS#7589 another mdb_page_split fix
    
    Tweak split_indx check, go one slot further.

commit e31983c723af27cfc2137c43326f3a345e052875
Author: Howard Chu <hyc@openldap.org>
Date:   Thu Oct 31 16:01:04 2013 -0700

    ITS#7736 fix regression in ITS#7733 patch
    
    In d8eccb353b1be7f07e74149dde9a41bb199d74e8

commit d8eccb353b1be7f07e74149dde9a41bb199d74e8
Author: Howard Chu <hyc@symas.com>
Date:   Mon Oct 28 07:25:54 2013 -0700

    ITS#7733 check cursor index before cursor_del

commit 742a078ea5785ff6667cec0c3fccb045dc25c633
Author: David Wilson <dw@botanicus.net>
Date:   Mon Oct 28 06:58:04 2013 -0700

    ITS#7734 Add MDB_NORDAHEAD to CHANGELESS.

commit 7449ca604ca732ad262cfd77da403968cdb9157f
Author: Howard Chu <hyc@symas.com>
Date:   Thu Oct 24 15:57:17 2013 -0700

    Bump to 0.9.9

commit b86f08e9d6f083d20c81054e2fff0d54695a4a2e
Author: Howard Chu <hyc@symas.com>
Date:   Mon Oct 21 10:29:38 2013 -0700

    Add mdb_env_get_fd()
    
    Return the environment's filedescriptor. Useful when the caller
    is doing their own locking.

commit dddc7a385ba4951c11e1c8405ccf002b6a75a53d
Author: Howard Chu <hyc@symas.com>
Date:   Mon Oct 14 09:47:26 2013 -0700

    Fix 01dfb2083dd690707a062cabb03801bfad1a6859
    
    USE_POSIX_SEM must define USE_HASH

commit ab9b08f8af70b8ce7bcc9cd28f9704f1f4542320
Author: Howard Chu <hyc@symas.com>
Date:   Sat Oct 12 16:20:04 2013 -0700

    ITS#7725 add MDB_NORDAHEAD flag for env_open

commit 5a9ddfd2899576d73449f0450274c9eb333c7dfb
Author: Howard Chu <hyc@symas.com>
Date:   Sat Oct 12 13:40:28 2013 -0700

    ITS#7589 silence warnings

commit 2211fb15db90e47b43690a55b93231e0345224fa
Author: Howard Chu <hyc@symas.com>
Date:   Sat Oct 12 13:31:09 2013 -0700

    ITS#7589 Fix typo in prev commit

commit 400e21370beb744a498b708e26cccdc1f0702618
Author: Howard Chu <hyc@symas.com>
Date:   Sat Oct 12 13:19:33 2013 -0700

    ITS#7589 Cleanup unneeded vars in prev patch

commit 310b656a2e1b81c039baf8ee4eeece7468c2b41e
Author: Howard Chu <hyc@symas.com>
Date:   Sat Oct 12 09:34:40 2013 -0700

    ITS#7589 avoid wasting space in mdb_page_split
    
    Also, check the split point on branch pages as well as leaf pages.

commit 01dfb2083dd690707a062cabb03801bfad1a6859
Author: Howard Chu <hyc@symas.com>
Date:   Fri Oct 4 10:22:14 2013 -0700

    Add MDB_USE_HASH
    
    There may be other uses for it besides semaphore names.

commit 940f5cb3736bf21fef1f4faa6c653cf2bb28f78d
Author: Howard Chu <hyc@symas.com>
Date:   Wed Oct 9 02:24:45 2013 -0700

    ITS#7722 fix page_merge for collapsing root
    
    Other cursors being fixed up are not necessarily height 1.

commit bf0e97aa0e9c7658c774d4be1c8ff3cbe2698eee
Author: Howard Chu <hyc@symas.com>
Date:   Tue Oct 8 04:43:58 2013 -0700

    ITS#7718 invalidate cursor when DB gets emptied

commit d327a36ad8c2602173da7bf2fb3b41db80950dc5
Author: Howard Chu <hyc@symas.com>
Date:   Fri Oct 4 02:55:34 2013 -0700

    Fix mdb_env_set_mapsize()
    
    Don't allow shrinking below minimum size for an already open env.

commit 2520247ba156ae2f881c800ccc47792c622725ae
Author: Howard Chu <hyc@symas.com>
Date:   Fri Oct 4 02:46:38 2013 -0700

    ITS#7715 always set filesize for WRITEMAP

commit 9f7ae8925fb896d7de9345ea441c5da3fce6670c
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Fri Oct 4 00:48:19 2013 +0200

    Add Caveat: Readers need write access. Whitespace.

commit 0f9b79e12cb9b1b716a0268f6dc70adc41067a09
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Thu Oct 3 23:59:25 2013 +0200

    Maintain MDB_cursor.mc_top

commit 99ea7669a35a79878394b29cd3448b58daf031fb
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Thu Oct 3 23:59:25 2013 +0200

    mdb_cursor_sibling(): Fix error result

commit 8f075595a14076fa78d1943f7bbb893031e9a6b2
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Thu Oct 3 23:59:25 2013 +0200

    mdb_node_add(): Plug page leak when MDB_PAGE_FULL.
    
    Do not fail after mdb_page_new() succeeds.

commit 3a1d73dafff3a4da3a1ec3841831edadcb7e76be
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Thu Oct 3 23:59:24 2013 +0200

    Optimize code holding reader mutex

commit 3d67838a59b30b5732c96612cf8ce5bbf59d7441
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Thu Oct 3 23:59:24 2013 +0200

    Set MDB_xcursor DB_DIRTY, clear md_name.
    
    Both were unused and md_name was unmaintained -- except
    mdb_cursor_touch(xcursor) would abuse md_name as a key to
    touch MAIN_DBI if it could somehow get passed ! DB_DIRTY.

commit 07dc79a7c33121bc1be55bbd81ff643094df6851
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Thu Oct 3 23:59:24 2013 +0200

    Set subDB DBI=parent DBI, fix MDB_DUPSORT delete.
    
    xcursor DBIs were parent DBI+1 for debugging. Instead output
    -(parent DBI).  Fixes a crash in mdb_cursor_del0()'s xcursor
    tracking, it forgot to subtract 1 for C_SUB cursors.

commit 79eac42c0f1fdd6c807f0b601c03ab35bf7d7d8e
Author: Howard Chu <hyc@symas.com>
Date:   Thu Oct 3 10:26:44 2013 -0700

    s/MDB_NORDLOCK/MDB_NOLOCK/
    
    Leave all lock management to the caller.

commit a1685c3ef70bc70fcb7b8fde4a2a2e9f6d8e11f0
Author: Howard Chu <hyc@symas.com>
Date:   Tue Oct 1 23:36:57 2013 -0700

    More doc for MDB_NORDLOCK

commit f73994054779be3e177bfd27f44fcd3147e7d08d
Author: Howard Chu <hyc@symas.com>
Date:   Tue Oct 1 13:16:38 2013 -0700

    Add MDB_NORDLOCK to omit all reader table usage
    
    Calling app wants to manage its own locking.

commit e3f6c152c5ab1a9810a1d3ed7de9a3252ff9e35a
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Mon Sep 23 20:21:11 2013 +0200

    Drop unneeded code.
    
    MDB_txn.mt_toggle: Use (mt_txnid & 1) instead.
    Drop error checks which will be repeated.
    mdb_cursor_set(): Turn assert into if/return to match the above.
    mdb_cursor_del(): 'flags' are now used as bitflags.

commit 2980bd30f5e7dcb5918ac26d82f658ddb05eabe7
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Mon Sep 23 20:21:11 2013 +0200

    Clean up and simplify mdb_page_search().
    
    Only named DBs can have DB_STALE, and they do not use MDB_PS_MODIFY.
    Replace magic key values with flags.  Drop duplicated comments at
    mdb_page_search_root() vs. mdb_page_search(), and rephrase.

commit 31cfca9316da2b2b901d384811d80a328eefbcdb
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Mon Sep 23 20:20:42 2013 +0200

    Tweak MDB_DEBUG output

commit 7bdb5be0b572a4ff952456a2faca9ecb7a6e8786
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Mon Sep 23 20:20:05 2013 +0200

    Rename SWAP() to avoid conflict with sqlightning.
    
    Happened since sqlightning #includes mdb.c, midl.c.

commit 52cb8b3417386e2cacee98401a797d8dd1a81020
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Mon Sep 23 20:13:27 2013 +0200

    mdb_page_unspill(): Rename local vars.
    
    The names have caused bugs, "txn" was treated as
    the current transaction.

commit 8e1d10e82887a0b8fdea6151c73377f9cabeb517
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Mon Sep 23 20:13:27 2013 +0200

    ITS#7515 Fix mdb_page_unspill() in nested txn.
    
    Malloc a page in this txn, not in a parent.

commit a3b3482854698f520135a49de930df4b788694dd
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Mon Sep 23 20:13:27 2013 +0200

    ITS#7515 Fix mdb_txn_commit(nested txn with spills).
    
    Catch malloc error.
    Fix hunt for dirty vs spilled pages: Don't leave x at a deleted pageno.
    Cleanup: Factor out variables, squash pages already marked for deletion.

commit bc48a40621ee26f15503dbd16321c972648b4769
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Mon Sep 23 20:13:27 2013 +0200

    ITS#7515 Fix mt_dirty_room in nested txns.
    
    Fix description & code: Also ignore dirty pages hidden by
    spilled pages, as they won't merge into our dirty_list.
    Update it in mdb_page_flush() instead of mdb_page_spill().

commit cfe262dce9a0be4791db4720aa308d5a6ecb8888
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Mon Sep 23 20:13:27 2013 +0200

    ITS#7515 mdb_pages_xkeep(): Careful about xcursors.
    
    Don't prod sub-pages or pages referring to uninitialized xcursors.

commit 5b96d68fafd1732790ac5f887e5050033a48da42
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Mon Sep 23 20:13:27 2013 +0200

    mdb_pages_xkeep(): Reformat, use common flag mask

commit 5b21307f29ccda563e5f0d82294083c841b0e927
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Mon Sep 23 20:09:47 2013 +0200

    Update MDB documentation and comments.

commit 3335b2583490f10c3f273391b48e1e2987022f4c
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Mon Sep 23 20:07:29 2013 +0200

    ITS#7682 mdb_env_copy(): Avoid Linux O_DIRECT bug.
    
    Use fcntl() to set the flag.  Linux open(,O_DIRECT...) can create
    the file even on failure, if the filesystem lacks O_DIRECT support.

commit 912e09fd04e0512e6f764176a4a0a2ab009c87d1
Author: Howard Chu <hyc@symas.com>
Date:   Sun Sep 15 13:08:29 2013 -0700

    ITS#7681 fix 18a07eb7c2dc33372455a6040984cd6b699b41a5
    
    Set rc=0 when taking the SET_RANGE branch

commit 0144da6eab00cf5f321d5c6794175485ba3efefd
Author: Howard Chu <hyc@symas.com>
Date:   Sat Sep 21 14:37:11 2013 -0700

    ITS#7701 fix mdb_rebalance
    
    Must copy tmp cursor back to real cursor when merging into tmp cursor.

commit 0f842a271085c198eb1df1ce3e177122c7a3c6ae
Author: Howard Chu <hyc@symas.com>
Date:   Mon Sep 9 08:29:46 2013 -0700

    Release 0.9.8

commit 7e58cc0fd39810c9bd0573ba62e3ac9c61b19f11
Author: Howard Chu <hyc@symas.com>
Date:   Thu Sep 5 16:23:49 2013 -0700

    updates

commit cfc13e2b4837f5cde8433251357ca82686e5b709
Author: Salvador Ortiz <sog@msg.com.mx>
Date:   Thu Sep 5 17:36:52 2013 -0500

    ITS#7682 In mdb_env_copy retry open if O_DIRECT fails

commit 90c55178db46379c28a4ec7c2b36e36e992cd288
Author: Howard Chu <hyc@symas.com>
Date:   Thu Sep 5 06:02:07 2013 -0700

    More for 5f6fa8c04204888c4ff7ac6be1868d81ff4410a8
    
    Reset delete flag in cursor_put().

commit 18a07eb7c2dc33372455a6040984cd6b699b41a5
Author: Claude Brisson <claude.brisson@gmail.com>
Date:   Thu Sep 5 12:58:18 2013 +0200

    ITS#7681 fix mdb_cursor_set behaviour for MDB_SET_RANGE

commit 5f6fa8c04204888c4ff7ac6be1868d81ff4410a8
Author: Howard Chu <hyc@symas.com>
Date:   Tue Sep 3 16:10:20 2013 -0700

    Remember if last cursor op was a delete
    
    If so, don't advance cursor on next NEXT. Also, init xcursor
    on the next GET_CURRENT.

commit 3d59ca35589d86fee7a4390ec28ff0cc563db40c
Author: Howard Chu <hyc@symas.com>
Date:   Wed Aug 28 20:22:41 2013 -0700

    Add a changelog

commit 5c5300c604a95c1627de640022af8050a574dfd5
Author: Howard Chu <hyc@symas.com>
Date:   Wed Aug 28 19:17:25 2013 -0700

    Bump version to 0.9.8

commit 2e7130cab0129e3b72a25d39c5d4e5a5c55cb353
Author: Howard Chu <hyc@symas.com>
Date:   Wed Aug 28 19:12:59 2013 -0700

    Allow mdb_env_set_mapsize() on an open environment
    
    The caller is responsible for making sure no transactions are
    active in this process before resizing. This is slightly lighter
    weight than doing a full env_close/env_open cycle.

commit 2a28686e4f56cf539e817661728e6c05de339eba
Author: Howard Chu <hyc@symas.com>
Date:   Tue Aug 27 06:28:30 2013 -0700

    ITS#7672 fix mdb_dbi_flags
    
    Use a txn instead of env argument. Only return persistent flags.

commit 4dd10d70a5f62cb68046efaf4dcb5edd806aa851
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sun Aug 25 23:59:58 2013 +0200

    mdb_page_unspill(): Fix dirty_room in nested txn

commit 56c2a8d04aeb1aeb7001d54bfa9b195da7eb140a
Author: Howard Chu <hyc@openldap.org>
Date:   Sat Aug 24 20:37:45 2013 +0100

    Another take on spill_pgs and deletes

commit b917266ca10c09092cb000c34740289c698ca694
Author: Howard Chu <hyc@symas.com>
Date:   Sat Aug 24 11:54:05 2013 -0700

    Cleanup prev commit

commit 41bf5c906aa745310b328a3b1a3700be339e3a9e
Author: Howard Chu <hyc@openldap.org>
Date:   Sat Aug 24 19:48:37 2013 +0100

    Speedup deletion from spill_pgs

commit 6423c8774904789fe4d3f0b7bc887201ef0ec41a
Author: Howard Chu <hyc@symas.com>
Date:   Fri Aug 23 07:36:07 2013 -0700

    ITS#7671 always return the key for a dup val

commit e15a90c7624797afaec703475b6f6be93ca62918
Author: Howard Chu <hyc@symas.com>
Date:   Thu Aug 22 21:43:29 2013 -0700

    ITS#7670 Tweak cursor_del0
    
    Always leave cursor pointing at "next" node, if any.
    Find next sibling if we're already at end of current page.

commit 6616034eb9a4ea5e84d620ec398a8aa0a9e336fb
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Fri Aug 23 07:39:04 2013 +0200

    mdb_page_spill(): Fix nested txn mt_dirty_room

commit 392be3a7c65837728426007c09f17c28a9397910
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Fri Aug 23 07:37:17 2013 +0200

    Simplify last commits

commit 45c4ed18050297871cb5f4f55a5b6560cb5ca1bc
Author: Howard Chu <hyc@symas.com>
Date:   Thu Aug 22 21:29:53 2013 -0700

    Tweak prev commit
    
    If somehow "need" is larger than the list size, don't
    try to fake out the dirty list.

commit 7b1db13050b86d864cdc17d9e0e7b18ee0f77071
Author: Howard Chu <hyc@symas.com>
Date:   Thu Aug 22 18:51:48 2013 -0700

    Less aggressive page_spill
    
    spilling all possible pages is a waste because the majority will be
    needed again. Just do 1/8th of the dirty list instead.

commit c22a7d98ecac671b69faeef7d406cec4140b2abf
Author: Howard Chu <hyc@symas.com>
Date:   Tue Aug 20 17:37:53 2013 -0700

    Update caveats now that mdb_reader_check exists

commit 214e9ed07d566307f22e16d0c1f1f57be9504a3b
Author: Howard Chu <hyc@symas.com>
Date:   Wed Aug 14 09:57:25 2013 -0700

    Silence warnings

commit 82b27c09c979e0f3e425bb14b64c5a0a28e04aab
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Wed Aug 14 15:21:59 2013 +0200

    Tweak ITS#7615 fix: Obey strict-aliasing rules.
    
    Do not access a long long as an array of longs.

commit 76f0a024859d3907305ec43b2f5826b45987d553
Author: Howard Chu <hyc@symas.com>
Date:   Tue Aug 13 13:12:47 2013 -0700

    ITS#7664 better fix
    
    For RDONLY, don't get lockfile until we know datafile exists.
    Also, don't try to create a new datafile for me_mfd if someone
    deleted it after we got me_fd.

commit a77ffaaa5d19ed42a6087109a5fa078f78eaf3e1
Author: Howard Chu <hyc@symas.com>
Date:   Tue Aug 13 13:05:32 2013 -0700

    Revert "ITS#7664 delete lockfile if there is no environment"
    
    This reverts commit 8725838409512e999d78ea7b60773ce2f94d588f.

commit 8725838409512e999d78ea7b60773ce2f94d588f
Author: Howard Chu <hyc@symas.com>
Date:   Tue Aug 13 11:34:32 2013 -0700

    ITS#7664 delete lockfile if there is no environment

commit eaeeecc3b28a814d6793b57102d9e03ff9a8cef7
Author: Howard Chu <hyc@openldap.org>
Date:   Mon Aug 12 12:43:42 2013 -0700

    Fix uninit'd mem ref in mdb_page_split
    
    Don't compare cursors beyond their depth. (detected by valgrind)

commit 6ecee1cbf9c6cad8665e2e3233e5a581f16a402b
Author: Howard Chu <hyc@symas.com>
Date:   Sun Aug 11 17:25:00 2013 -0700

    Tweak NODUPDATA flag check
    
    Should allow for the possibility of future flag combos.

commit 5a5d33ff330aaf7c630174dcd65b914783e2f8e4
Author: Howard Chu <hyc@symas.com>
Date:   Sun Aug 11 17:15:03 2013 -0700

    Fix obscure MDB_MULTIPLE bug
    
    If a key has a single existing value, and then a put (MDB_MULTIPLE)
    is done where the first of the multiple values matches the existing
    value, the put would return SUCCESS without writing any of the
    values. Fixed to loop to the next value as intended.

commit 76f8b77e36b0c4833ced7e529cb64705025f2c6a
Author: Howard Chu <hyc@symas.com>
Date:   Sat Aug 10 14:55:51 2013 -0700

    Point to mdb.c for docs on macros in Makefile

commit 9c49ef1d711dbb5e73f26759ce9ec67740741c5a
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Aug 10 13:50:10 2013 +0200

    Avoid compiling debug args with C90 compilers.
    
    Use double DPRINTF() parenthesis, so varargs macros are not needed.
    Parenthesize MDB_DEBUG, in case the user defines it as foo || bar.

commit 76d31573a40ba8fe27be6cf3a68230c363119bdf
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Aug 10 13:23:30 2013 +0200

    Refuse ops on bad txns

commit 9beea541e182ff2c9f09d57f02a256c333b6e345
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Aug 10 13:23:30 2013 +0200

    Replace EINVALs with generalized MDB_INCOMPATIBLE.
    
    Also check xcursor instead of DUPSORT, it's slightly briefer.

commit ef899fe84ed6eabe1e327eaee74f91c787d3bbfc
Author: John Hewson <john@jahewson.com>
Date:   Sat Aug 10 04:12:42 2013 -0700

    ITS#7656 fix install target

commit 86551828abbafc90f52fc17ba095f48e28edab3b
Author: Salvador Ortiz <sog@msg.com.mx>
Date:   Fri Aug 9 11:03:28 2013 -0500

    ITS#7660 Add mdb_txn_env to API

commit 5645812f41b66ca2bf26ff7367f4a5348a4d491e
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Aug 10 12:29:45 2013 +0200

    mdb_txn_commit(): Always commit if MDB_TXN_SPILLS.
    
    Checking dirty_list was insufficient after a spill
    with no named databases and no positioned cursors.

commit 92eb22018492e9a9e4837fac24b9534944a05ae3
Author: Salvador Ortiz <sog@msg.com.mx>
Date:   Sat Aug 10 09:42:19 2013 +0200

    ITS#7661 mdb_dbi_flags(): Allow main DBI

commit 335f0e4ceeed82a1302bf16cf2c3df00f45798c4
Author: Salvador Ortiz <sog@msg.com.mx>
Date:   Fri Aug 9 10:08:53 2013 -0500

    mdb_del must ignore data if db not opened with MDB_DUPSORT

commit 1ac3c8308f78269b31de0bd9e6cd99dcda7b48d1
Author: Howard Chu <hyc@symas.com>
Date:   Fri Aug 9 04:51:33 2013 -0700

    Add mdb_env_get_maxkeysize()

commit 1ecd86b14cf94381bcb96ae6e129d6a5bef7fc9d
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Fri Aug 9 13:05:14 2013 +0200

    Replace unpredictable EINVAL error returns.
    
    Return EINVAL only for simple programmer errors.

commit 22c104c5d7783c5fda8b354e68302f7f54a3dddf
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Fri Aug 9 12:54:42 2013 +0200

    Re-fix reader-pid code

commit 38b11b1de14a16eab461a12fcda9d78f406883a7
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Thu Aug 8 19:57:52 2013 +0200

    mdb_cursorpages_mark: Mark current txn and no more.
    
    Ignore parent txn cursors since it is the current txn's dirty_list
    which will be flushed. But check the current txn also when clearing,
    since cursors can have pages which are dirty in a parent.
    
    Check !mc_xcursor instead of !MDB_DUPSORT.  Equivalent for valid
    data, but a bit safer if the sub-DB flags are corrupt.

commit 2bd5d8102eddf460e288ccd4bd556ebba133b4b2
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Thu Aug 8 19:57:52 2013 +0200

    Fix mdb_ovpage_free() vs. spill.
    
    Ensure me_pghead has room before removing from spill/dirty list.
    Don't return pages to me_pghead in nested txns, use mt_free_pgs.

commit c3547e81f3fcefac2dc66f8dfff64025eb41cc36
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Thu Aug 8 19:57:51 2013 +0200

    Fix page spilling when MDB_WRITEMAP.
    
    mdb_page_spill(): Don't binary-search the unsorted dirty_list.
    mdb_page_flush(): Don't overwrite unprocessed dirty_list items.

commit ee5ba855651df54130a53daa8f5b638894343230
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Thu Aug 8 19:57:51 2013 +0200

    Set MDB_TXN_ERROR when inconsistent txn state

commit ffd2287b5505dd56a1ed12bf5f5fb903ff2fc8ea
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Thu Aug 8 19:54:54 2013 +0200

    Factor out MDB_env.

commit d66739f947ce06c16675aea2bd033c94b3d7d220
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Thu Aug 8 19:43:04 2013 +0200

    MDB_LOCK_VERSION -> MDB_LOCK_FORMAT.
    
    Pid locking needs a different lockfile-version: MDB_env's with and
    without pid locking must not coexist, they can sabotage each other.
    Store MDB_LOCK_FORMAT = (version | "use locking" flag) instead.

commit 1878213092fbc60f42131318f9eb98a73d5e888c
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Thu Aug 8 19:43:04 2013 +0200

    Fix mdb_reader_pid().
    
    Treat unexpected errors as "don't know".  Invert Pidcheck return
    value, so nonzero including error codes = "the process may exist".
    
    On Windows: Catch exited but still existing processes.  Handle
    undefined PROCESS_QUERY_LIMITED_INFORMATION.
    On Unix: don't trust F_GETLK error to leave the input alone,
    the fcntl() doc seems unclear.

commit 636c2d2a294ab4d61df832d864317400a5655d60
Author: Howard Chu <hyc@symas.com>
Date:   Wed Aug 7 12:42:46 2013 -0700

    Use proper printf format on Windows

commit 74ed1757a4fb9263e1a78adc7b60360531824e0a
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Mon Aug 5 10:01:39 2013 +0200

    Silence warnings

commit 27435aa5ac14c439ea14c0e7cf0f49c89470bf1e
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Mon Aug 5 09:55:57 2013 +0200

    Tweak comments

commit 6214423163cb5c5cc7385e9e2f6da45ea5ee61ef
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Mon Aug 5 09:55:48 2013 +0200

    Clarify doc: mdb_copy, nested txns, mdb_drop().
    
    mdb_copy: Does not copy lockfile. Can trigger file growth.
    mdb_txn_begin(): Clarify usage restrictions.
    mdb_drop(): State what to do rather than what will be done, since
    closing the handle could otherwise be read as happening even at failure.

commit 2cc2574d84686d2e2556e86f78a962bd593af19c
Author: Howard Chu <hyc@symas.com>
Date:   Wed Jul 31 08:09:40 2013 -0700

    Tweak prev commit again
    
    Make sure errors are propagated from init_meta

commit bc03467040550340f4b04f5f77dd0c741e5f4a2a
Author: Howard Chu <hyc@symas.com>
Date:   Tue Jul 30 13:44:28 2013 -0700

    Fix typo in Win32 branch

commit 254b77e63d722a3276b35a633ebd3291a5fdbf4c
Author: Howard Chu <hyc@symas.com>
Date:   Tue Jul 30 12:47:12 2013 -0700

    Cleanup prev commit
    
    Loop on copyfd meta write, since pipes may return after partial write.

commit eff35fcb2ab75245ac58c1dbea3e8fb7f30f7e86
Author: Howard Chu <hyc@symas.com>
Date:   Tue Jul 30 10:22:12 2013 -0700

    ITS#7652 fix I/O error checks
    
    partial revert of d6d2638acc245116b8f091ac425b6700d06c4713 and
    26a25df5fcc2fcddae6597a61c1b867fc27c568b
    
    The original code was already tested and working correctly.

commit acf20f77f34502e0513666cac46688156cb79f33
Author: Howard Chu <hyc@symas.com>
Date:   Sun Jul 28 17:02:51 2013 -0700

    Tweak mdb_envinfo numreaders
    
    Return the actual shared reader count when it exists, not
    just the current process env's reader count.

commit e8ba9dbd28e5f36717a226e01e7a4139d6968161
Author: Howard Chu <hyc@symas.com>
Date:   Fri Jul 26 10:19:54 2013 -0700

    ITS#7615 use shorter names for semaphores
    
    NetBSD can only handle up to 14 chars, we were using 21. Now
    we encode to 15, and for NetBSD truncate the last char.

commit de72c08660fca1597be0bb0b6536c122ae324645
Author: Howard Chu <hyc@symas.com>
Date:   Fri Jul 19 09:57:33 2013 -0700

    Tweak reader_pid check
    
    Check again after acquiring rmutex. Avoids potential issue with
    a duplicate pid coming in between initial check and rmutex.

commit b1dc72b6b54e81ff8db8a7666df47db317cfcc4f
Author: Howard Chu <hyc@symas.com>
Date:   Fri Jul 19 09:55:10 2013 -0700

    Get pid lock outside of rmutex
    
    Avoid holding rmutex for longer than necessary.

commit 5ca73f864f1185e855cd525b71c29ccd3c5e7f97
Author: Howard Chu <hyc@symas.com>
Date:   Thu Jul 18 15:24:09 2013 -0700

    Tweak reader checks
    
    Use mti_numreaders for loop limit, not me_maxreaders.

commit a4bbe57f8ba4c7d88ba6d16a63171c2ec2ce02ad
Author: Howard Chu <hyc@symas.com>
Date:   Thu Jul 18 10:40:21 2013 -0700

    Add mdb_reader_check()

commit 4d7c9e5bca70e08166cba3711df17a4f4e479cda
Author: Howard Chu <hyc@symas.com>
Date:   Thu Jul 18 09:11:09 2013 -0700

    Split MDB_VERSION to MDB_DATA/MDB_LOCK VERSION

commit 68a0adc59fc8b5385b357f4e1f9bb484bbb95f83
Author: Howard Chu <hyc@symas.com>
Date:   Thu Jul 18 09:00:51 2013 -0700

    Tweak reader_list

commit 360d0492db4eacc0b257566bf50c609c2c31d545
Author: Howard Chu <hyc@symas.com>
Date:   Thu Jul 18 08:33:24 2013 -0700

    Tweak mdb_stat(1)
    
    Don't obtain reader txn before displaying reader table. Exit
    after reader table if no other DB query options were given.

commit 49289f0d2e8b5b2fb0295606938c2a4007800e3b
Author: Howard Chu <hyc@symas.com>
Date:   Thu Jul 18 07:41:11 2013 -0700

    Add mdb_reader_list()
    
    Dump the active slots in the reader table.

commit fc137e39a311818fb636e9db59967406f02edda6
Author: Howard Chu <hyc@symas.com>
Date:   Mon Jul 15 10:57:13 2013 -0700

    Add mdb_dbi_flags()
    
    Retrieve the flags from a DB handle.

commit 501eac2fc48899aa7f3971666eaef1eb9e2f387c
Author: Howard Chu <hyc@symas.com>
Date:   Sun Jul 14 16:53:04 2013 -0700

    Fix child txn dirty_room counts in spill/unspill
    
    Don't count pages twice if they're already accounted in an ancestor txn.

commit 2c3488aeebf10edaf740ae9b4daba0e7ed89c8d6
Author: Howard Chu <hyc@symas.com>
Date:   Sun Jul 14 08:28:26 2013 -0700

    More for stale sub-cursor flags
    
    Same fix for cursor_first/last.

commit 56a41d87d42568328413f6e2a6197c2ae0dc67bd
Author: Howard Chu <hyc@symas.com>
Date:   Sun Jul 14 08:20:18 2013 -0700

    Fix stale sub-cursor C_INIT flag
    
    Whenever we enter cursor_set() the sub-cursor's flag must be
    cleared. If the new cursor position has valid subdata it will
    be initialized again, if not then the sub-cursor has nothing
    to point to.

commit 8ae56c34d537f93d6dc2e7f84fa45d09b42f05ac
Author: Howard Chu <hyc@symas.com>
Date:   Fri Jul 12 13:55:18 2013 -0700

    Tweak comments, defaults should be OK already

commit fa7228962bb4bc27b721564dc78437f6180b3841
Author: Howard Chu <hyc@symas.com>
Date:   Fri Jul 12 13:36:05 2013 -0700

    Bump version to 0.9.7

commit f04dc0ebd21f7a61ae31d9bff648907fce0e80e7
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Fri Jul 12 11:30:33 2013 +0200

    Also set/clear P_KEEP in parent txn's cursors

commit e9ed4d75f786e1b592f000cb4a0afb9b16f73cf1
Author: Howard Chu <hyc@symas.com>
Date:   Thu Jul 11 22:09:47 2013 +0200

    Spill pages, take 3

commit d7bc4baf637dc1dd2afae1f67384fb6ff9b31bb4
Author: Howard Chu <hyc@symas.com>
Date:   Thu Jul 11 22:09:47 2013 +0200

    Delay touching pages until cursor is positioned.
    
    This avoids unnecessary rewrites of pages that do not change.
    (Restructuring for upcoming mdb_page_spill work.)

commit c09db5757d4cac831bc2731476cca4a1d85d3368
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Thu Jul 11 22:09:46 2013 +0200

    Simplify: Always set C_UNTRACK for tracked cursors.
    
    TODO: Rename C_UNTRACK to C_TRACKED.  Omitted now for readability.
    The current name is because it's lazy: not always set when tracked.

commit 6741f9c0ef7973aeebacc3e547db9fc07702a8c2
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Thu Jul 11 22:09:46 2013 +0200

    Save freelist using proper mdb_cursor_put().
    
    (Restructuring for upcoming mdb_page_spill work.)
    mdb_freelist_save() can't just Get() the destination, since
    mdb_page_spill() may have put the destination in the read-only map.
    
    TODO: Can this new put() modify the freelist, which would break it? The
    final iteration's put() can shorten the node, the rest uses MDB_CURRENT.
    
    We could set P_KEEP on dirty freeDB leaves and ovpages, since they are
    all about to be modified.  But the code in this commit must stay anyway,
    if mdb should support dropping a 256G DB. I.e. too big for dirty_list.

commit 08373439a604b6ad852d7148aa0ec8f33774bbe4
Author: Howard Chu <hyc@symas.com>
Date:   Thu Jul 11 22:09:46 2013 +0200

    Move code out to mdb_page_dirty()

commit 87a7f06feb795ee50325c74ed02844ecfde5270c
Author: Howard Chu <hyc@symas.com>
Date:   Thu Jul 11 22:09:46 2013 +0200

    Factor out parent

commit ba6dfe0bbb454a41c1c1ad8a29238925b1927980
Author: Howard Chu <hyc@symas.com>
Date:   Fri Jul 12 12:53:35 2013 -0700

    Fix env_read_header() on Windows
    
    Commit d6d2638acc245116b8f091ac425b6700d06c4713 broke read
    on zero-length files.

commit 3d46d5502aa4065b9a08ddb3711aa4dfd14ddca2
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Wed Jul 10 22:11:44 2013 +0200

    Do not follow uninited cursors' page pointers.
    
    Nor uninited cursors' subcursors' page pointers.

commit b711c07f3432d104612fd3186a22dab6f2369570
Author: Howard Chu <hyc@symas.com>
Date:   Wed Jul 10 11:03:51 2013 -0700

    Fix rebalance/cursor adjust
    
    When collapsing root, must also move cursor index down,
    not just the page pointer.
    
    Also in mtest, break from NEXT loops on error, otherwise it just
    prints the previous key/data again, which looks confusing.

commit f81eb631ffec43b53d051664cf7e8a62852f4693
Author: Howard Chu <hyc@symas.com>
Date:   Wed Jul 10 08:49:29 2013 -0700

    Cursors: Clear C_EOF when clearing C_INITIALIZED

commit 64676da8d9c46d5a40eaca713bf0735e241ea4cf
Author: Howard Chu <hyc@symas.com>
Date:   Tue Jul 9 14:21:35 2013 -0700

    Fixup other cursors after delete op

commit a77767013a7cc60bd22ef598ebf5c6e7021bba88
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sun Jul 7 17:14:38 2013 +0200

    ITS#7515 Reject conflicting page versions.
    
    If mdb_page_touch() sees a page in txn's dirty_list, that
    is the page version txn's cursors should have.  Fail if
    the user may be seeing and depending on another version.

commit be47ca766713f55e5b3abd18120514fdad7d90f2
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sun Jul 7 17:13:27 2013 +0200

    ITS#7515 Fix tracking of parent txn's cursors.
    
    Restore mc_flags and xcursors, they were tracked but not merged.
    Simplify: Track parent txn's original cursors after backing them
    up, instead of tracking copies and merging them back at commit.

commit 9be6af0dcb0469965477022541e95e74d48dad9e
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sun Jul 7 17:13:27 2013 +0200

    Simplify MDB_cursor: Drop flags C_ALLOCD,C_SHADOW.

commit 3d1e70950455725a81fe9e3dc0370d994498d392
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Jul 6 21:42:45 2013 +0200

    Silence more uninit warnings

commit 06a3ad08cd07146ecc223c1a3940bd4906a6f7a0
Author: Howard Chu <hyc@symas.com>
Date:   Tue Jul 2 02:23:49 2013 -0700

    Silence uninit warning in prev commit

commit 589370d880fb7272ca6e8ff8fc6efec4cb51d8e2
Author: Howard Chu <hyc@symas.com>
Date:   Tue Jul 2 02:19:17 2013 -0700

    Tweaks for MDB_MULTIPLE
    
    Terminate loop on intermediate failures, return count of written items,
    document usage.

commit fb674c1cf58f19ddc0ff2ead443121d2c8359dd5
Author: Howard Chu <hyc@symas.com>
Date:   Mon Jul 1 14:53:29 2013 -0700

    ITS#7635 simplify 9474c1a0b62cad57b62855d09a201670385caa80

commit 9474c1a0b62cad57b62855d09a201670385caa80
Author: Howard Chu <hyc@symas.com>
Date:   Mon Jul 1 13:41:23 2013 -0700

    ITS#7635 fix read txn potential data race

commit 3347a029051c2154b4dbd9c618f8f11fe29db0c7
Author: Howard Chu <hyc@symas.com>
Date:   Sun Jun 30 07:40:02 2013 -0700

    Fix uninit warnings, lseek usage

commit 7f6738355284dbee8bf97a23396a6380e91dfa73
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Wed Jun 26 18:02:52 2013 +0200

    Fix alloc/free issues.
    
    Page leak, mdb_page_alloc(). On error, don't shorten me_pghead.
    Memleak, mdb_ovpage_free(). Free page or keep it in dirty_list.
    Bad MIDL, mdb_midl_need(). Fix midl[-1] (allocated size).

commit 12c558fe13fbba4c370b0b669271d8ccaad7819a
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Wed Jun 26 18:02:48 2013 +0200

    Factor out some vars, simplify.

commit b7ce06f5c56e452bca6c5a276da7915b8517d80b
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Wed Jun 26 18:02:26 2013 +0200

    Makefile/user-macro comments.

commit 26a25df5fcc2fcddae6597a61c1b867fc27c568b
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Wed Jun 26 18:02:17 2013 +0200

    Tweak I/O, fix last commit.

commit d6d2638acc245116b8f091ac425b6700d06c4713
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Jun 22 23:15:10 2013 +0200

    Improve MDB error handling, drop seek calls.
    
    Catch I/O errors. Do nothing between OS call failure and ErrCode().
    Do not use errno after non-OS-errors like write() >= 0, which could
    give a failure return of success (errno 0) or some irrelevant error
    code.  Drop seek calls, use pwrite/pread/Windows OVERLAPPED offset.

commit a5701cf2fe2b577488f4f9d2e616d5872e3c3e14
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Jun 22 23:01:30 2013 +0200

    Fix Windows I/O.
    
    Don't put a 64-bit filesize in a 32-bit int before shifting
    down.  Always pass &sizehi to SetFilePointer->maxsize, so
    sizelo not is treated a signed distance.  Hide unused vars
    when _WIN32.  Reinitialize OVERLAPPED before reuse.

commit 3d4ba01e8b8fd37e8323369c345838cbd1522b51
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Jun 22 22:17:41 2013 +0200

    Catch more MDB errors. DPRINTF in mdb_env_reset0.

commit 51ff20a4d6481e8a90ef2c7fc80f71ae8609f74c
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Jun 22 22:10:43 2013 +0200

    Tweak MIDLs, catch errors.
    
    Grow midls earlier in order to catch errors earlier.  Use
    mdb_midl_need() instead of mdb_midl_grow(), then mdb_midl_xappend()
    needs no error checks. Factor out mdb_midl_append_range().

commit 6b200e3beb55322f9d9ae0e42afe3090cc2f13a6
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Jun 22 12:30:04 2013 +0200

    Factor out MDB variables/expressions, cleanup.
    
    mdb_page_malloc(): Take a txn arg instead of a cursor.

commit 9e6ef6c88f842dbd43d8f671d169ca3dc909b3ce
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Jun 22 11:56:04 2013 +0200

    Rearrange MDB dirty page code.
    
    Split out mdb_dpage_free(), mdb_page_flush() and clean up.

commit c6f9323b3dc0ae8259af12a1b04edb4bbae7f05b
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Thu Jun 20 07:41:35 2013 +0200

    Simplify mdb_page_alloc().
    
    Merge if() branches. Restore retry=500 when MDB_PARANOID, for clarity.

commit 4a9ee2cb726fe8f5c4f256c1a567cdf6721c10a7
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Thu Jun 20 07:41:35 2013 +0200

    ITS#7620: Keep empty IDLs. Tweak mdb_page_alloc().
    
    MDB_env.me_pghead: Don't free it when empty. mdb_ovpage_free()
    needs it, but cannot allocate it.
    mdb_midl_alloc(): Fill in length=0.
    mdb_page_alloc(): Also Skip freeDB if txnid<3, instead of <4,
    and consistently DPRINTF consumed IDLs.

commit 1d94ea5b55e5bce58502b3c0065cf40983eee9a8
Author: Howard Chu <hyc@symas.com>
Date:   Mon Jun 17 22:26:11 2013 +0200

    ITS#7623 Clear P_SUBP on conversion from fake page

commit 60086c1bc77fafecef274a165b308b28902dfebb
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Thu Jun 13 08:58:25 2013 +0200

    ITS#7515 Nested MDB txns: Inherit txn flags.
    
    Committing a nested txn lost the MDB_TXN_DIRTY flag
    in the parent, unless the child had set it too.

commit 7030ad16e2b792d5782c328461d09a31c96b86e6
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Thu Jun 13 08:58:24 2013 +0200

    Clean up mdb_page_touch(), mdb_page_copy().
    
    When copying, round up/down to aligned sizes. Skip the unused portion,
    this was not done when touching a page dirty in the parent txn.
    No other change in behavior.
    
    Simplify mdb_page_touch(), including: Drop test m3==mc, the condition
    is caught below. Don't "modify" the parent's pgno into the same pgno,
    when a nested txn copies a parent's page into its freelist.

commit 79844bd44687dd5ecdf8ab36144584db06939dc7
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Thu Jun 13 08:58:24 2013 +0200

    ITS#7594 Fix MDB cursor tracking with subDBs.
    
    The tracking code should not change the current cursor.
    It did when that was a C_SUB cursor, which should not be
    checked against the tracked cursors but their xcursors.
    
    However, do not bother to skip the tracking code for the
    current cursor when it would not change that cursor anyway.

commit 2bacf6e59ed4510d2540d758c3b079406853b18a
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Thu Jun 13 08:58:24 2013 +0200

    ITS#7594 Invalidate a dropped MDB DB's cursors.

commit 62e4c4f9d0675647ad0d9ca4573060a13df20f34
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Thu Jun 13 08:58:24 2013 +0200

    Don't #define _GNU_SOURCE if already defined.

commit c37a11a424b79f1601b2426c5802ea309d7799e2
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Thu Jun 13 08:25:25 2013 +0200

    More for ITS#7620 Fix mdb_ovpage_free().
    
    Do not binary-search dirty_list, it is unsorted when MDB_WRITEMAP.
    Catch errors. In nested txns, put the page in mt_free_pgs after
    all since pages dirty in a parent txn would add complexities.

commit 2d0b362b6f2b1247eb693008a39efaf341f15e82
Author: Howard Chu <hyc@symas.com>
Date:   Wed Jun 12 08:41:32 2013 -0700

    Partial revert c2cac4588a40480c020d320b544bc5f8e72adb11
    
    MDB_NEXT was fine before, duh.

commit 99427aa7ded1f2f467fc2b32dde1169a28eb6b64
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Wed Jun 12 17:20:42 2013 +0200

    Drop me_pgfree, add mdb_freelist_save().
    
    Split up saving me_pghead, to make me_pgfree unneeded. Also mf_pghead
    is now a midl. Needed after e7f6767ea815fe0ada1f95037dfdec176ec4d5bb
    ("Return fresh overflow pages to current pghead").
    Tweak MDB_DEBUG freelist output, make it ascending.

commit c2cac4588a40480c020d320b544bc5f8e72adb11
Author: Howard Chu <hyc@symas.com>
Date:   Tue Jun 11 17:13:08 2013 -0700

    Fix CURSOR_NEXT/PREV on emptied DB

commit bcb67dd22f06a7f7c85350bc548c50ccfc27dbaa
Author: Howard Chu <hyc@symas.com>
Date:   Sat Jun 8 14:10:08 2013 -0700

    Make sure mdb_stat() gets valid data

commit e7f6767ea815fe0ada1f95037dfdec176ec4d5bb
Author: Howard Chu <hyc@symas.com>
Date:   Sun May 5 01:28:12 2013 -0700

    Return fresh overflow pages to current pghead
    
    And remove them from the current dirty list.

commit aff123ba113728a254339c07560b7d98c88f30a6
Author: Howard Chu <hyc@symas.com>
Date:   Wed Jun 5 16:13:43 2013 -0700

    ITS#7594 more for subDB cursor fix

commit 3b623d66e1e0d1fd78d85e5e657b1a167dba8a51
Author: Howard Chu <hyc@symas.com>
Date:   Wed Jun 5 15:23:54 2013 -0700

    ITS#7594 better fix
    
    Update the subDB cursor, don't invalidate it

commit 65faa5ed7ebba7136999f52514c71d8670402627
Author: Howard Chu <hyc@symas.com>
Date:   Thu May 30 15:56:30 2013 -0700

    tweak mdb_copy, trap signals

commit d29b9600e6b893ebea8ed34c5c9ec933727ecb5b
Author: Howard Chu <hyc@symas.com>
Date:   Thu May 30 15:33:59 2013 -0700

    Windows portability fixes for prev commit

commit f207c50b15e3727ac3f7ca7bdf54022e34a84e2f
Author: Howard Chu <hyc@symas.com>
Date:   Thu May 30 13:13:33 2013 -0700

    Add warning about interrupting copy

commit ad573fe1251f1a1c1f29b4c921f11209ae8e9ffb
Author: Howard Chu <hyc@symas.com>
Date:   Thu May 30 13:09:28 2013 -0700

    Fix prev commit

commit c68e5ae9be63d9464efcf37ace117881e63b7d9a
Author: Howard Chu <hyc@symas.com>
Date:   Thu May 30 13:06:12 2013 -0700

    Add mdb_env_copyfd()
    
    Allow writing backup to an already opened file handle, for piping
    to tar/gzip/ssh/whatever.

commit 4b49291653c485841886e5a52c0aabd9ce50a9d9
Author: Howard Chu <hyc@symas.com>
Date:   Sat May 25 10:16:55 2013 -0700

    Add _M_IX86 macro for MSVC

commit e31c7d3b31d8d5073195e31b283e8ccb46bd13cf
Author: Howard Chu <hyc@symas.com>
Date:   Thu May 23 08:13:08 2013 -0700

    ITS#7594 De-init other subcursors in page_touch

commit 92fe958805be33a06d8ae55727e9c61c81c8b751
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Tue May 21 23:58:57 2013 +0200

    Drop unused liblmdb MIDL-range support.

commit feaeab0c0488ba60f4b2b1a901cb685df0c5cf01
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Tue May 21 23:55:13 2013 +0200

    Factor out mdb_find_oldest,mdb_dlist_free,dirty_list.
    
    Do not rescan reader table (mdb_find_oldest) after "goto again".
    Skip clearing dirty_list[nonzero].mid in mdb_dlist_free(); it
    was not done in mdb_reset0() anyway.

commit 5ea1cd8f6d083095cf4f20b802cea90441cea03a
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Tue May 21 23:48:27 2013 +0200

    mdb_stat cleanup.
    
    Exit with success when there was no failure.
    Do not use data containing NUL as a DB name (which is a C string).

commit a1b16ce5f0f661b0dd5a30706a1d6178cf0fa561
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Tue May 21 22:44:51 2013 +0200

    ITS#7598 Tweak MDB_<NEXT/PREV>_NODUP,fix mdb_stat.
    
    MDB_NEXT_NODUP, MDB_PREV_NODUP: Allow for non-MDB_DUPSORT databases.
    No mdb.c code changes needed.
    
    mdb_stat.c: Use MDB_NEXT_NODUP, to avoid a crash with a DUPSORT mainDB.

commit 1b6d7ee7e1aae85bfce2794e60038c2b264ad93c
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Tue May 21 19:04:52 2013 +0200

    ITS#7598 mdb_dbi_open(named DB): Check mainDB flags.
    
    Reject attempts to open named databases if the main
    database has flag MDB_DUPSORT or MDB_INTEGERKEY.
    
    DUPSORT would require an xcursor for the DB, INTEGERKEY
    would expect the DB name to be a binary integer.

commit a2ce25482a60e516d1d9b417ed666dac6fdebb93
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Mon May 20 23:12:52 2013 +0200

    ITS#7515 Fix nested txn touch of subpage/ovpage.
    
    mdb_page_touch(): Don't touch a subpage, replacing with non-subpage.
    mdb_cursor_put(): Don't overwrite ancestor txn's dirty overflow page.

commit 5bdf2aae6ee0c8bdcd6a7759bd098d6531c668a0
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Mon May 20 23:12:26 2013 +0200

    Tweak mdb_page_malloc(),mdb_page_get() semantics.
    
    mdb_page_malloc(): Add "number of pages" parameter.
    mdb_page_get(): Add output param for how page was found.
    Do not set return params on error.
    mdb_cursor_put(): Catch mdb_page_get() error.
    
    Prepares for next commit, no change in caller behavior other
    than on mdb_page_get error.

commit 2eb50b1d2ed61dedf33a9d89ef25e0ba853f5f81
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sun May 19 19:08:07 2013 +0200

    More ITS#7589 followup: OVPAGES() -> mp_pages.

commit e4ce404992f440adf0a5b026932b8cfd392bfa35
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sun May 19 18:38:13 2013 +0200

    More ITS#7589: Fix prev commit.
    
    mp_pages gives #pages in the ovpage. OVPAGES() no longer does.

commit 0cdd9dffddf66c730a35f48db2bb02d8bb3e5731
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Fri May 17 19:31:17 2013 +0200

    ITS#7589 mdb_cursor_put(): Update ovpage nodesize.
    
    Update the nodesize when overwriting an overflow page.
    As before, do not attempt to shrink the page.

commit 833cd905b7e1d28ae1d5d726ea43dc0a38f06858
Author: Howard Chu <hyc@symas.com>
Date:   Wed May 15 11:50:40 2013 -0700

    Include <netinet/in.h> for Solaris 8
    
    Needed for <resolv.h>, which is needed for BYTE_ORDER.

commit 7233bc295bb3e40b2758158ae2de6f42516962f8
Author: Howard Chu <hyc@symas.com>
Date:   Tue May 14 16:57:50 2013 -0700

    Fix mdb_page_split - nested split
    
    If updating a page's separator triggers a split in its parent,
    we may have missed adjusting the parent's cursor position.

commit 1105aa35ba46f811ebfddb7e5790c3d9e90000e6
Author: Howard Chu <hyc@symas.com>
Date:   Mon May 13 12:36:47 2013 -0700

    Doxygen cleanup

commit 9ebd5992c9aa726bf9622f0b59fba4223dc5d675
Author: Howard Chu <hyc@symas.com>
Date:   Fri May 10 05:56:16 2013 -0700

    Fix 66c839f0292d9aea12bf93ef6568ac2bd2ca0fc8
    
    Forgot #include <errno.h>

commit 66c839f0292d9aea12bf93ef6568ac2bd2ca0fc8
Author: Howard Chu <hyc@symas.com>
Date:   Thu May 9 17:27:29 2013 -0700

    Refactor mdb_midl_append, add mdb_midl_grow()

commit 2d6aed75375cd9c3231130ddcdbd9f685f953029
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sun May 5 15:13:31 2013 +0200

    ITS#7515 Fix nested transaction error handling.
    
    mdb_txn_begin(): Do not free(mt_free_pgs), it needs mdb_midl_free().
    mdb_txn_commit(): Catch commit(child) error.

commit 521fdb00cca97e168e0c167e9915f2a5a0e7e6c1
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sun May 5 14:26:05 2013 +0200

    Fix mdb_env_close(unopened MDB_env).
    
    Do not try to scan me_dbxs in a closed/never-opened MDB_env.
    Broken by 7d643d3acb94a6d7306330b550fce0e5755444a9
    and 151c416b460b02cd96502a47189cda19ab651ada.

commit 0b9a2085302191a14ee14449c0987c5294be9026
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat May 4 12:53:43 2013 +0200

    Simplify/cleanup mdb_cursor_init, C_ALLOCD.
    
    No real change.
    mdb_cursor_init() checks if it needs mx, so pass it unconditionally.
    Set C_ALLOCD for shadow cursors, for clarity. (It was always set as
    it should anyway from the origin cursor, which would have C_ALLOCD.)

commit f355de0298d2dc4f080fdc4f275a881bfecb0716
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat May 4 12:41:28 2013 +0200

    MDB warning cleanup.
    
    Unused function when MDB_DEBUG. Unused 'excl' param.

commit b389341b4b2413804726276d01676a6a9d05346f
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat May 4 12:34:49 2013 +0200

    mdb_dcmp(): Assume the database has MDB_DUPSORT.
    
    There was little point in returning EINVAL when not: Comparing (A,B)
    and (B,A) would claim (A > B && B > A), which could confuse callers.

commit 91a93004ce1fb4efbdf2867680d2e6cddbbeab8c
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat May 4 12:34:20 2013 +0200

    Update MDB doc: Cursors, DB handles, data lifetime

commit 385889b0bee53b355f64d1749ba1e7788f7c66cb
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat May 4 12:34:02 2013 +0200

    Allow mdb_cursor_close() after readonly txn ends.
    
    Catch mdb_cursor_renew(write txn's cursor).  Add flag C_UNTRACK, so
    mdb_cursor_close need not peek inside a possibly-freed readonly txn.

commit 17ffe9c9922082d15f76d43c853c1bc5da517a3e
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat May 4 12:33:06 2013 +0200

    Close cursors when commit(writer). Factor out code.
    
    Close remaining cursors when committing a write txn. The doc says this
    happens, and it avoids cursor tracking when updating mainDB + freeDB.
    
    Rename mdb_cursor_merge() -> mdb_cursors_close() for code reuse,
    and add a merge option.  Simplify its loop a bit.
    
    Factor out cleanup of DBIs.

commit dca0cef678c285c6a173147a70fd8692ce447f62
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat May 4 12:31:31 2013 +0200

    Plug txn leak and MDB_NOTLS slot leaks on error.
    
    On mdb_env_copy() error: Abort the txn.
    On mdb_txn_renew0() error: Release new MDB_NOTLS reader slot.

commit f45d40a88bc10b2d1abab43712469309a26c6d98
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat May 4 10:03:19 2013 +0200

    Cleaner "Support mdb_txn_abort(a reset txn)".
    
    Redo 8a562f560edcc6417672df453c4e626dfb4c4024 so !mt_dbxs indicates
    "txn was reset", so mt_numdbs gets one magic value instead of two.

commit 151c416b460b02cd96502a47189cda19ab651ada
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat May 4 10:03:19 2013 +0200

    Update fixes for dbi_open/close, ITS#7515.
    
    Reset me_dbflags[dbi] when closing DBI, to get rid of MDB_VALID flag.
    mdb_env_close(): Re-fix DB-name memleak. DBIs > me_numdbs may exist.

commit 21da623bf40dc21f89c3172c523d094075e0824b
Author: Howard Chu <hyc@symas.com>
Date:   Wed May 1 22:43:35 2013 -0700

    Allow reading freelist while working on it
    
    The circular dependency issues appear to have been resolved.
    Still, need to watch closely, maybe revert this change if
    problems arise.

commit 568c22c4cc494410147f6ef5435694bd3eca17c3
Author: Howard Chu <hyc@symas.com>
Date:   Tue Apr 30 21:09:09 2013 -0700

    Avoid assert
    
    Due to underfilled branch page. We're in the process of merging/moving
    nodes to it because we already know it's underfilled. Took this approach
    rather than just removing the assert in mdb_page_search_root, because
    that assert may yet catch other situations we don't know about.
    
    (Although, it has been there since the original commit of mdb.c and
    has never triggered any other times...)

commit 37bd48a618b62f72029dcd03e0a2ee91c8e7713c
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Mon Apr 22 20:46:56 2013 +0200

    Plug mdb_cursor_renew() memleak

commit c0575825730dd2aab4031100b25d632a3d052447
Author: Howard Chu <hyc@symas.com>
Date:   Sat Apr 20 19:30:06 2013 -0700

    Fix MDB_LAST, reset cursor index

commit da3e4d78d6e2e1e48871b9121da58a734abb4637
Author: Howard Chu <hyc@symas.com>
Date:   Sat Apr 20 09:47:33 2013 -0700

    Fix typo from 7aba5f5ab92a3fa92de001edb2c5ff4b04fd7d0d

commit 9dd61011fe18a46400d9c33db32a45193802f26a
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Thu Apr 18 08:00:03 2013 +0200

    Tweak comments/readability.
    
    Show MDB_PERSISTENT/MDB_VALID/DB_VALID relationship.
    mdb_txn_renew0(): Remove obsolete "cannot fail" comment.

commit 272e4e98ad7e792a91f9dfd056ee9fc9d0e0ebde
Author: Howard Chu <hyc@symas.com>
Date:   Thu Apr 18 04:17:03 2013 +0200

    Add MDB_NOTLS envflag.

commit afe488d8a9c4dcdf09d1b33014b616a27e8e707f
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Thu Apr 18 04:16:07 2013 +0200

    Catch MDB txn reuse/sync errors.

commit 8a562f560edcc6417672df453c4e626dfb4c4024
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Thu Apr 18 04:15:45 2013 +0200

    Support mdb_txn_abort(a reset txn).

commit ce6335b0d92043622c812061a7968e8f080ef5d3
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Thu Apr 18 04:15:13 2013 +0200

    Cleanup for TLS key and read-only filesystem.
    
    Move key init into mdb_env_setup_locks().
    Don't create unused TLS key when read-only filesystem.
    Drop internal flag MDB_ROFS, we can instead test either
    !me_txns, !mt_u.reader or me_lfd==INVALID_HANDLE_VALUE.

commit 65a6542765dd734421b401d23053bc6d6710348c
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Thu Apr 18 04:13:43 2013 +0200

    Clean up MDB_env setup.
    
    Malloc before I/O. Avoids possible malloc error after I/O.
    Don't allocate dirty & free lists when MDB_RDONLY.
    Factor out code.

commit dbb9ded2f826a1c05919759492cbffd58e54e243
Author: Howard Chu <hyc@symas.com>
Date:   Wed Apr 17 14:33:41 2013 -0700

    Fix mdb_rebalance
    
    Don't do anything with (fake root) subpages

commit aca6c0889768eed2bfb55d0ed22faa92d7cf947a
Author: Howard Chu <hyc@symas.com>
Date:   Tue Apr 16 12:05:03 2013 -0700

    ITS#7574 blind fix
    
    Fix 227329c8e1fb818548f1936f5dc1349ffd733523, don't persist
    the MDB_VALID bit in db.md_flags.

commit 92fc932f21bfd783d9137cbb6a617bebbc495c18
Author: Howard Chu <hyc@openldap.org>
Date:   Mon Apr 15 09:30:39 2013 -0700

    fix prev commit

commit 0cccf79a0284b05655ea07c3f4d66cb4d6b653d8
Author: Howard Chu <hyc@symas.com>
Date:   Sun Apr 14 23:59:54 2013 -0700

    Fix mdb_rebalance
    
    Need to check NUMKEYS as well as fill threshold, when deciding
    whether to change anything. Don't let the page drop below the
    minimum number of keys.

commit 14c5a5dff19ce98ed227dc7e70a93ed5b1074577
Author: Howard Chu <hyc@symas.com>
Date:   Sun Apr 14 16:53:30 2013 -0700

    Revert "ITS#7570 fix MDB_GET_MULTIPLE and MDB_NEXT_MULTIPLE"
    
    This reverts commit 372b3ddb85bef953fb548fbf2b9ef0cba4e3c8ed.
    
    Original code works as designed.

commit 372b3ddb85bef953fb548fbf2b9ef0cba4e3c8ed
Author: Claude Brisson <claude.brisson@gmail.com>
Date:   Wed Apr 10 14:40:49 2013 +0200

    ITS#7570 fix MDB_GET_MULTIPLE and MDB_NEXT_MULTIPLE

commit fbe6a6051b180bb7e07a393abeced80d5c7932c2
Author: Howard Chu <hyc@symas.com>
Date:   Sun Apr 7 19:21:46 2013 -0700

    Fix 227329c8e1fb818548f1936f5dc1349ffd73352
    
    mdb_dbi_close() must allow any dbi < maxdbs, since opens in an
    uncommitted txn don't increment env->me_numdbs.

commit e43fa77eaaee72c5c390bd69addcc8c3e131d72f
Author: Howard Chu <hyc@symas.com>
Date:   Fri Apr 5 03:44:56 2013 -0700

    Revert "Fix 6beaad52129da5353fd40c0ec48e6a78c4f71a2e"
    
    This reverts commit 8eef7a4275eda8f2fa2e0d1e67c1d5cbcd91607e.
    Previous commit was correct, duplicate keys should not appear here.

commit 227329c8e1fb818548f1936f5dc1349ffd733523
Author: Howard Chu <hyc@symas.com>
Date:   Tue Apr 2 11:25:44 2013 -0700

    Fixes for dbi_open/close, ITS#7515

commit 6b46799379a3d15ae110f2b4b60bd360dda1ca75
Author: Howard Chu <hyc@symas.com>
Date:   Thu Apr 4 16:16:25 2013 -0700

    ITS#7561 Fix mdb_drop bugs
    
    Check for overflow pages, reset cursor position properly.

commit 8eef7a4275eda8f2fa2e0d1e67c1d5cbcd91607e
Author: Howard Chu <hyc@symas.com>
Date:   Thu Apr 4 07:25:21 2013 -0700

    Fix 6beaad52129da5353fd40c0ec48e6a78c4f71a2e
    
    In APPEND don't immediately reject matching key, since this
    is valid for APPENDDUP.

commit 6beaad52129da5353fd40c0ec48e6a78c4f71a2e
Author: Howard Chu <hyc@symas.com>
Date:   Wed Apr 3 18:26:41 2013 -0700

    Fix d3990eb2f8b2944782604a2ca7bd52e08c58fc3e
    
    Append mode should *reject* keys that are too small.
    Also allow APPENDDUP in mdb_put().

commit e31d748dbe16b326fb2e80c1b876814cf7b24f45
Author: Howard Chu <hyc@symas.com>
Date:   Mon Apr 1 20:34:40 2013 -0700

    Fix rebalance when collapsing root page
    
    When fixing other cursors, must also fix their depth.

commit cb1cc6483136b1404de29731279f81878fdf1199
Author: Howard Chu <hyc@symas.com>
Date:   Mon Apr 1 19:49:40 2013 -0700

    More fixes for MDB_LAST
    
    Make sure C_INITIALIZED gets set on successful call

commit 3213fc4db725fec22ccf894cad3b9623ac9ccf7b
Author: Howard Chu <hyc@symas.com>
Date:   Mon Apr 1 19:06:05 2013 -0700

    ITS#7556 fix cursor_sibling for PREV

commit 7d643d3acb94a6d7306330b550fce0e5755444a9
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sun Mar 31 23:50:02 2013 +0200

    Plug MDB memory leak of DB names.

commit ccb7b26916f5604ebc653671a11bf9acfbab3425
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sun Mar 31 23:48:10 2013 +0200

    Silence signedness warning

commit a70b026f6b4df47dc7f2c5263dcf6e517b201dd1
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sun Mar 31 23:47:45 2013 +0200

    Fix MDB_DEBUG compile when no varargs macros.
    
    Variables mdb_debug, mdb_debug_start were used undefined.

commit 30da15a18df0810fd71f83b15e14a64dd7deee6a
Author: Howard Chu <hyc@openldap.org>
Date:   Sun Mar 31 20:56:08 2013 +0100

    Tweak mode_t def per Hallvard's suggestion

commit 0c568117cea6764c3f12a0d69ddf54ee467d2dec
Author: Howard Chu <hyc@symas.com>
Date:   Sun Mar 31 08:10:43 2013 -0800

    MSVC doesn't define mode_t

commit 7aae15739b2c77bb601c98b112c804f51778a33b
Author: Howard Chu <hyc@symas.com>
Date:   Fri Mar 29 01:08:06 2013 -0700

    Fix CURSOR_LAST/CURSOR_PREV

commit 863fa77a086e01c439e59a0b4c51be7d88b2e146
Author: Howard Chu <hyc@symas.com>
Date:   Tue Mar 26 11:24:59 2013 -0700

    ITS#7553 better fix

commit 8a99b00acc6fc737b825c979c057a98a081e4e68
Author: Howard Chu <hyc@symas.com>
Date:   Mon Mar 25 12:15:53 2013 -0700

    ITS#7553 deinit cursor after deleting last node

commit bccbcd1938269de42e81af163a3cbfb7216f0d56
Author: Howard Chu <hyc@symas.com>
Date:   Mon Mar 25 11:53:32 2013 -0700

    Silence stupid warnings

commit bbb27cde4af7d9f60ca77b4b0caea4b6237ed289
Author: Claude Brisson <claude.brisson@gmail.com>
Date:   Fri Mar 22 16:00:21 2013 +0100

    bugfix for mdb_cursor_put with MDB_MULTIPLE
    
    If the variable dkey.mv_size is non-zero, then it means dkey
    contains some original data which has to be put back in the
    child db, typically when the child db has just been created.
    
    But when using MDB_MULTIPLE, if this variable has not been
    reset to zero, we may come back to this section and wrongly
    think that there is some original data to be taken care of.

commit 77001f549ba5b28a4cff89c4d58012a106985437
Author: Howard Chu <hyc@symas.com>
Date:   Tue Mar 12 17:29:34 2013 -0700

    ITS#7538 fallout from ITS#7536 fix.
    
    Allow leaf pages to have only 1 key.

commit 3247d7cbd625d6134c894320f6777d3c6cfa27ea
Author: Howard Chu <hyc@symas.com>
Date:   Tue Mar 12 17:25:49 2013 -0700

    Precalculate max size of a node

commit 8c1d95a438e5798e257e8a37f541c7cb839a24fc
Author: Howard Chu <hyc@symas.com>
Date:   Mon Mar 11 10:28:25 2013 -0700

    Fix f97552a83abb085bc44b1b578e550d64c1313a4b
    
    Causes Bus Error on SPARC

commit f80171e07950e93f1dc86af9327c2e998e2fad4b
Author: Howard Chu <hyc@symas.com>
Date:   Mon Mar 11 06:04:54 2013 -0700

    Check for MADV_RANDOM
    
    Android supports madvise but not posix_madvise

commit 9c4ee8229750c3b8517e0b5001213fd550691c0c
Author: Howard Chu <hyc@symas.com>
Date:   Mon Mar 11 05:59:07 2013 -0700

    ITS#7377 Fix c0f3d9b9a8864e744a8d1eaffc99bc86026d5351
    
    Add missing parens

commit b1da555c4c7275d7f756d693c42814388a9aa839
Author: Howard Chu <hyc@symas.com>
Date:   Mon Mar 11 05:49:14 2013 -0700

    Turn off readahead on main mmap
    
    It's harmful when the DB is larger than RAM.

commit d74330128ac0c5b1ba3a06a199238f9780f685fd
Author: Howard Chu <hyc@openldap.org>
Date:   Wed Mar 6 12:30:37 2013 -0800

    ITS#7536 fix mdb_rebalance
    
    A page must always have at least 2 keys (unless it's a root page)

commit 6dab37f2acaef70a31f65bd485fd2222c2648d2b
Author: Howard Chu <hyc@symas.com>
Date:   Mon Feb 25 05:06:51 2013 -0800

    Use CC/LDFLAGS to link the shared lib

commit d8b407d9a27a8c9d183cb532f1d4bccbf0002401
Author: Howard Chu <hyc@symas.com>
Date:   Mon Feb 25 02:02:15 2013 -0800

    Install manpages too

commit 26e4222ffb8b74d29674136b4c8c821e73250605
Author: Howard Chu <hyc@symas.com>
Date:   Sun Feb 24 23:40:34 2013 -0800

    Delete obsolete @todo
    
    We do it now... (coalescing freelist entries in page_alloc)

commit 58e27b6c204af932cd7d9faaaaf3079c0d77d7c3
Author: Howard Chu <hyc@symas.com>
Date:   Sun Feb 24 23:39:17 2013 -0800

    Add sample apps for comparison/education purposes

commit 66c9f030558320290d1a8d3961a31670a15c56f2
Author: Howard Chu <hyc@openldap.org>
Date:   Mon Feb 25 06:50:51 2013 +0000

    Add $(DESTDIR) to make install target

commit 3394bac2c0fcb69f29da5bd182fdb025b6ac42f6
Author: Howard Chu <hyc@symas.com>
Date:   Wed Feb 20 05:08:52 2013 -0800

    Update error code instances

commit 80cd88118406acdd5e153c91a6a42c7c90804ac6
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Wed Feb 20 12:19:45 2013 +0100

    Tweak MDB_INCOMPATIBLE description

commit fbd76c44e4d67ed0ffce7a8387fbf505775356d7
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Wed Feb 20 09:08:41 2013 +0100

    Tweak prev commit: Restore if-test as an assert

commit 208e5c614dcbb67ac276f45aa7ebabf63565c53c
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Tue Feb 19 22:03:41 2013 +0100

    ITS#7515 Fix mdb_txn_commit(nested txn).
    
    Don't modify the parent txn until the current txn cannot fail.
    Don't assume new dirty child pgnos > dirty parent pgnos.
    
    Page alloc/touch: Fail if child+parent dirty pages would exceed
    dirty_list's maxsize. Avoids an error situation in commit.

commit f43ae20be7cb1b45b9a4156a32e6fdcefbe4f63d
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Tue Feb 19 22:03:04 2013 +0100

    ITS#7512 Plug mdb_txn_abort(nested txn) page leaks.
    
    Also catch mdb_cursor_shadow() errors.

commit f97552a83abb085bc44b1b578e550d64c1313a4b
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Tue Feb 19 22:02:37 2013 +0100

    Check DB flags when refreshing a stale MDB DBI.
    
    It's hairy to figure out when a DBI is valid. Catch destructive
    user errors, and flags which another process changed under us.

commit 2dbb8bb833f8495f3638900ca8aaad67e8817658
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Tue Feb 19 22:02:15 2013 +0100

    mdb_cursor_prev,mdb_cursor_next: Fix return value.
    
    Return mdb_node_read()'s return value if it fails, not 1.
    (Can happen if mdb_page_get() fails and NDEBUG is #defined.)

commit e4af9ee5daa207dd726091e9878750e1dbc0c58b
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Tue Feb 19 22:01:29 2013 +0100

    ITS#7515 mdb_dbi_open(): Also open in parent txns.
    
    This makes aborting nested and non-nested txns more
    similar: The new DBI is available to the surrounding
    context (parent txn and MDB_env respectively).

commit 4b6727037434c32038661be08fb2b55914596d28
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Tue Feb 19 21:17:33 2013 +0100

    mdb_page_alloc(): Handle freeDB txnid range holes.
    
    A txn writes no freeDB entry if previous txn dropped mainDB and a read
    txn prevents freelist entry reuse. This surprised mdb_page_alloc (and
    mdb_txn_commit too before 65c053a6e7f6973c1d09710aa1bd57b218206fcb).

commit f19655eabc49d563878b88db8723478d2ee2cba7
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Tue Feb 19 21:15:26 2013 +0100

    ITS#7517 Document that dirty DBs may not be closed

commit 8ad25001ffed13d12d1e84705002cc799b6c8676
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Tue Feb 19 21:14:23 2013 +0100

    ITS#7485 Document key/data size limits in lmdb.h.
    
    mdb.c already describes them. The user doc should too.

commit ef25056cfb072d6cbeb29c7e6adbdb8a0a1bc382
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sun Feb 17 08:42:14 2013 +0100

    Revert "ITS#7515 update parent's mt_next_pgno on child commit"
    
    This reverts commit fd4861bf00fb0b86a9f3b80d16cbe363a8eac227.
    It duplicated earlier code.

commit fd4861bf00fb0b86a9f3b80d16cbe363a8eac227
Author: Howard Chu <hyc@openldap.org>
Date:   Sun Feb 17 00:49:53 2013 +0000

    ITS#7515 update parent's mt_next_pgno on child commit

commit 890f1da3eeedab99aecc63c85b9792aa17faf537
Author: Howard Chu <hyc@openldap.org>
Date:   Sun Feb 17 00:48:43 2013 +0000

    Don't limit retries when coalescing freelist
    
    Try to use whatever's available.

commit 00d7a96bd584412016036b1029fd31e441f5dc34
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Feb 16 19:11:20 2013 +0100

    ITS#7515 Fix MDB parent/child txn interaction.
    
    mdb_txn_commit(child): Copy more state. Copy all of mt_dbs:
    Include mainDB, and even freeDB since mdb_drop() can update
    it. Don't skip DBs with unchanged root, this could break
    when the new was newly opened and the old unused junk.
    
    mdb_page_get(): Search parents' dirty lists.

commit d90581fa5a9ae42b87325f18259553bc80d89a14
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Feb 16 19:08:54 2013 +0100

    ITS#7377 Catch MDB failure updating root pointers.
    
    "cannot fail" was wrong, it fails at least when exceeding mapsize.

commit c7db955a94344b028ffba506bea1b5c2ecd564ca
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Feb 16 19:08:37 2013 +0100

    ITS#7517 Don't save dropped dirty MDB databases.
    
    mdb_txn_commit's attempt to save the DB could corrupt another DB if
    another thread had called mdb_dbi_open and reused the closed DBI.

commit 8e1bbdf0dd2c05f56937c6293dc23d7c4945fbe2
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Feb 16 19:07:16 2013 +0100

    mdb_stat -ff[f]: show contiguous page spans.

commit 7aba5f5ab92a3fa92de001edb2c5ff4b04fd7d0d
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Feb 16 19:06:28 2013 +0100

    Add error code MDB_MAP_RESIZED.

commit 5e59695b8d8825ed85e0ebd59aa2da168e869075
Author: Howard Chu <hyc@openldap.org>
Date:   Thu Feb 14 19:20:45 2013 +0000

    Don't memmove freelist entry when chunking it
    
    Just advance the pointer, now that it's no longer a complex struct

commit 52ecd38e18ac25329e5397d34d60387008f12559
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Tue Feb 12 12:27:59 2013 +0100

    ITS#7455 Save freelist in single-page chunks

commit 1b8bfc575694fe4ee4e40eefd444873da5655086
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Wed Jan 23 15:47:35 2013 +0100

    Freelist cleanup/streamlining
    
    Drop unneeded definitions, redundant code.

commit 65c053a6e7f6973c1d09710aa1bd57b218206fcb
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Thu Feb 7 08:17:30 2013 +0100

    ITS#7512 Fix MDB page leak when malloc error.
    
    mdb_page_alloc(): Delay moving me_pgfirst,me_pglast
    until malloc(MDB_oldpages to hold the IDs) succeeds.

commit e0eb495fb3c0909b341803c98ac2c78ac39f1f5b
Author: Howard Chu <hyc@symas.com>
Date:   Mon Feb 4 10:53:17 2013 -0800

    Revert "ITS#7515 fix mdb_dbi_open/close"
    
    This reverts commit 48dc782ea612f85e8356a50bfbafe22e5be121cf.

commit 744e31193913d117a68414fe163c9038a78edde2
Author: Howard Chu <hyc@symas.com>
Date:   Fri Feb 1 06:19:23 2013 -0800

    NULL key is allowed for MDB_CURRENT

commit 48dc782ea612f85e8356a50bfbafe22e5be121cf
Author: Howard Chu <hyc@symas.com>
Date:   Thu Jan 31 20:05:48 2013 -0800

    ITS#7515 fix mdb_dbi_open/close
    
    If a DBI handle is opened by a txn that aborts, the DBI handle
    should no longer be valid.

commit 27aaecc744955d08d2bfe7a3ca786d742267c5bd
Author: Howard Chu <hyc@openldap.org>
Date:   Mon Jan 28 18:45:36 2013 -0800

    ITS#7511 make sure cursor is marked valid after successful put

commit 9fa0c3bf31f256bac8643980c97b7696a3947806
Author: Howard Chu <hyc@openldap.org>
Date:   Tue Jan 29 01:08:24 2013 +0000

    ITS#7505 fix prev commit, partial revert

commit 0b8ac92b7ad37a49db2008f3a46052f0cdc7b8bf
Author: Howard Chu <hyc@openldap.org>
Date:   Sun Jan 27 17:55:21 2013 +0000

    ITS#7505 Fix mdb_update_key when key is too big

commit cfedb365b4a2a90111810a7918d58aa679adb99c
Author: Howard Chu <hyc@openldap.org>
Date:   Sat Jan 26 18:55:35 2013 +0000

    Fix MDB_CURRENT updating for dupsort items

commit 7fdf6720416d5eaadf5fd811c4513c87a2899a0f
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Wed Jan 16 18:42:57 2013 +0100

    Update MDB comments: Caveats, flags, etc.

commit 8e7bb2042b560618caf481e280f2d42ff9594f47
Author: Howard Chu <hyc@openldap.org>
Date:   Tue Jan 15 04:24:07 2013 -0800

    ITS#7485 data sizes limited to 32 bits
    
    That's all we have space for in a node record.

commit 1a0d02c4c40bb869e8179192de10f8fbad60b1e2
Author: Howard Chu <hyc@symas.com>
Date:   Mon Jan 14 13:46:25 2013 -0800

    ITS#7485 more size checks

commit 25a99d4024930574490f18c9eaa1e0448df34eba
Author: Howard Chu <hyc@symas.com>
Date:   Mon Jan 14 13:12:15 2013 -0800

    ITS#7485 check maxkeysize in mdb_cursor_put
    
    Also MDB_MAXKEYSIZE is redefinable at compile time.

commit 9e35127f1d0484005038685c7b0b7f3a10c44de0
Author: Howard Chu <hyc@symas.com>
Date:   Mon Jan 14 12:57:54 2013 -0800

    One more rename
    
    Forgot this in 98fe3390891c7577e5f2664a091088786da78ffb

commit 53cf2eed907c75354dc08a880ee1cc21ee2088e4
Author: Howard Chu <hyc@symas.com>
Date:   Fri Jan 11 11:45:25 2013 -0800

    ITS#7491 check for filled dirty page list
    
    Very large single transactions will fail. It's not just a problem when
    nested transactions are used. We could make this dynamically sized,
    but I'm not sure what the point is.

commit fed573cb86ed99f37bd062908ec814ee0ca47053
Author: Howard Chu <hyc@symas.com>
Date:   Thu Jan 10 02:58:55 2013 -0800

    Happy New Year

commit cd80a154748ec052ec9d8bd0d596bbcd16641ad5
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Wed Jan 9 20:49:43 2013 +0100

    Delete liblmdb/mfree. It has moved into mdb_stat.

commit 2a36346b50abbdad1f36338fdbfbdfa16674602c
Author: Howard Chu <hyc@openldap.org>
Date:   Wed Jan 9 08:30:13 2013 -0800

    ITS#7455 don't give up so soon
    
    If we're operating on the freelist, see if our current pghead
    can satisfy the request before giving up and using new pages.

commit 057e0686303444d56f29a7bee0536e261fdf0b6a
Author: Howard Chu <hyc@symas.com>
Date:   Wed Dec 19 13:20:24 2012 -0800

    Fix typo

commit 460a05bf787d06220c60c8c021b2b73e164447ab
Author: Howard Chu <hyc@symas.com>
Date:   Wed Dec 19 13:09:56 2012 -0800

    Add initial mdb utility manpages

commit 82b97a8af0f951d0c545d38de9e016a4674f83b7
Author: Howard Chu <hyc@symas.com>
Date:   Tue Dec 11 22:21:52 2012 -0800

    init_meta should write mapsize
    
    Was leaving it 0 initially.

commit 0702fbd688117f5d2f7fb491a73c6b25ba6f39d8
Author: Howard Chu <hyc@symas.com>
Date:   Tue Dec 11 16:01:25 2012 -0800

    Update version date

commit 9acf801cc119d187e1252474cab7d228dc6d7676
Author: Howard Chu <hyc@symas.com>
Date:   Tue Dec 11 12:55:47 2012 -0800

    Make sure init_meta is at beginning of file

commit ed86a086f7ae92c8f8bd40032ab5dc3e02cf40b0
Author: Howard Chu <hyc@symas.com>
Date:   Tue Dec 11 12:46:17 2012 -0800

    More for prev commit
    
    Use the latest meta page

commit e74d70e88e838c0f1e80b00e7c3cf6ea57762d0d
Author: Howard Chu <hyc@symas.com>
Date:   Tue Dec 11 12:03:19 2012 -0800

    Partially revert 65d40eb5d2c7c28df05e2c1d9b21d90e2a82e0b5
    
    Allow both increasing and decreasing the environment size.
    But don't allow decreasing below the currently occupied space.

commit 282be11654f871ce3cf824e85113b5ecae1810a6
Author: Howard Chu <hyc@symas.com>
Date:   Mon Dec 10 17:21:24 2012 -0800

    FIx prev commit

commit 0ce6bb4be0034120c850917bc4f59b4d4efc1432
Author: Howard Chu <hyc@symas.com>
Date:   Mon Dec 10 12:21:36 2012 -0800

    Add error checks to txn_commit
    
    These ops could fail if the map is full.

commit aff2693fc0721df4ccb6ceb357f80501c413ed38
Author: Howard Chu <hyc@symas.com>
Date:   Mon Dec 10 12:16:50 2012 -0800

    ITS#7455 simplify
    
    Don't try to reclaim overflow pages while operating on
    the freelist (for now). The circular dependencies are much like
    the single-page case, but worse. Maybe look into this in the
    future, but it's not absolutely necessary now.

commit e26fc734177ccc4da91d6bf79035a9dda354784a
Author: Howard Chu <hyc@symas.com>
Date:   Fri Dec 7 13:19:36 2012 -0800

    ITS#7467 add verbose freelist info

commit 784757faa91b4570465e7fc6453305324e686a0a
Author: Howard Chu <hyc@symas.com>
Date:   Fri Dec 7 12:06:30 2012 -0800

    ITS#7465 fail if both -a and -s specified

commit 9a5d4370be39b249be04d8004a8610159440f743
Author: Howard Chu <hyc@symas.com>
Date:   Thu Dec 6 17:39:49 2012 -0800

    Yet more retries for overflow page scan

commit 5863d5cc616b2e0ff4738358e27ed1d095f3eead
Author: Howard Chu <hyc@symas.com>
Date:   Thu Dec 6 08:25:43 2012 -0800

    Freelist fixes
    
    Keep list sorted if it grows during a write. Don't free pghead until
    we're sure our writes are all finished.

commit 7b10fdde0039cd79435a4ef128e882163d4ebd9a
Author: Howard Chu <hyc@openldap.org>
Date:   Tue Dec 4 06:30:22 2012 -0800

    Fix mdb_env_copy
    
    Just write in 2^31 sized chunks

commit 04b7c421090691422577a41f120c0d5379dc63d7
Author: Howard Chu <hyc@symas.com>
Date:   Mon Dec 3 16:53:24 2012 -0800

    Rename mdb_open/close mdb_dbi_open/close
    
    Avoid possible symbol clashes with MDB-Tools libmdb

commit e545b742e5f934c0e68bcccd5e21695d7e0b5bff
Author: Howard Chu <hyc@symas.com>
Date:   Mon Dec 3 13:57:46 2012 -0800

    Fix 5c1ee7f7ba9580d5ff29e74cbb02eee335c33d94
    
    mdb_cursor_sibling() no longer pops cursor before returning.

commit 5af47adf6b02a4b260ed717944c40d6ed120577a
Author: Howard Chu <hyc@symas.com>
Date:   Mon Dec 3 13:57:28 2012 -0800

    Fix mdb_midl_shrink

commit d3f51fdcf7e952422dc39b356ae197e29de8db73
Author: Howard Chu <hyc@symas.com>
Date:   Fri Nov 30 12:54:19 2012 -0800

    More retries for overflow page scan

commit 98fe3390891c7577e5f2664a091088786da78ffb
Author: Howard Chu <hyc@symas.com>
Date:   Fri Nov 30 12:45:34 2012 -0800

    Rename libmdb to liblmdb

commit 2a94ebced6b349b36bfd7b9e1adc3c0f06e2faea
Author: Howard Chu <hyc@symas.com>
Date:   Fri Nov 30 12:39:53 2012 -0800

    Add install target

commit 13f3bcd59c2055d53e4759b0c3356b001eca44b0
Author: Howard Chu <hyc@symas.com>
Date:   Fri Nov 30 12:30:51 2012 -0800

    Rename libmdb to liblmdb, lmdb.h
    
    Avoid naming conflicts with other mdb* packages. Bump version to 0.9.5

commit f1655071994b80612e463894e17817a4161f2ee4
Author: Howard Chu <hyc@symas.com>
Date:   Wed Nov 28 17:13:26 2012 -0800

    ITS#7455 use freelist for overflow pages

commit 185136397dd20c64148e090a24c620430d420287
Author: Howard Chu <hyc@symas.com>
Date:   Wed Nov 28 15:34:44 2012 -0800

    Drop unneeded #include <time.h>

commit 049b145ec77f0cde208a2b63baf8adb2090ce9ce
Author: Howard Chu <hyc@symas.com>
Date:   Wed Nov 28 15:34:19 2012 -0800

    Doc layout tweaks

commit 97ed96206d10c29c5612ef38db9c37de23005871
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Tue Nov 27 23:56:47 2012 +0100

    mdb_env_sync(,force=1): Override MDB_MAPASYNC.
    
    With MDB_MAPASYNC, the API provided no way to ensure full sync.

commit b9275c999117061fcbfce97e99600c1074c3e610
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Tue Nov 27 23:56:47 2012 +0100

    mdb_cursor_dbi(): Assume valid args.
    
    It returned 0, which is the freelist DBI and is valid for a few uses.

commit 7e620a34a28e200394dcf25839021c653449bd29
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Tue Nov 27 23:56:47 2012 +0100

    API change: mdb_drop() only accepts del=0 or 1.
    
    This allows for other flag values in the future.

commit d903bed218ce19c4ef2e95ec9560169512212747
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Tue Nov 27 23:56:47 2012 +0100

    API change: mdb_env_set_maxdbs(, *named* DBs).
    
    Let the user specify the number of databases he will actually
    use. Adding 2 for FREE_DBI and MAIN_DBI is an internal matter.

commit 6b56e0fab1945522864cb48cdbbf607ef0900856
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Tue Nov 27 23:56:47 2012 +0100

    ITS#7453 Fix reset of MDB_NOSYNC/MDB_NOMETASYNC.
    
    mdb_env_open() with these flags did not open a synchronizing
    file descriptor.  Thus disabling them later did not work.

commit 0201b9002cfc5396e229fae2757a52cfb719e121
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Tue Nov 27 23:56:47 2012 +0100

    Tweak MDB_FIXEDMAP handling.
    
    Drop mmap()'s MAP_FIXED flag, so it returns another address instead
    of unmapping existing overlapping pages. Verify the returned address.

commit 52e3adbdec847e3f8cd6ddcd35a7e4b94cd40e9f
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Tue Nov 27 23:56:47 2012 +0100

    Renumber MDB_NOSUBDIR. Check mdb_env_open() flags.
    
    MDB_NOSUBDIR was == MDB_REVERSEKEY. That affected the freelist:
    Env flags are stored in mm_flags alias mm_dbs[FREE_DBI].md_flags.
    
    It stays a persistent flag, in case mdb_env_open someday wants
    to pick/verify which lockfile to use with the datafile.
    
    Catch bad flags so they will no longer make it into the data file.

commit bb36bdcd1c22d1fbc6575452ef5c9112715ab083
Author: Howard Chu <hyc@symas.com>
Date:   Mon Nov 5 05:06:06 2012 -0800

    ITS#7432 fix typo in mdb_midl_sort
    
    Wasn't pushing the optimal half of the array onto the stack,
    thus used more stack than expected -> overrun.

commit 0108327c274a4b260b5b355d2a7c3ffc3a85f4c1
Author: Howard Chu <hyc@symas.com>
Date:   Thu Oct 25 06:55:46 2012 -0700

    Better fix for MDB_DEBUG tweak -- from hbf

commit b68aa3f86bf60076088d572c720373337eb6cc75
Author: Howard Chu <hyc@symas.com>
Date:   Thu Oct 25 06:54:09 2012 -0700

    Revert "MDB_DEBUG tweak for old compilers"
    
    This reverts commit ef2092eac9f35b77eae250801c96dfa515c6d4b2.

commit ef2092eac9f35b77eae250801c96dfa515c6d4b2
Author: Howard Chu <hyc@symas.com>
Date:   Thu Oct 25 05:28:55 2012 -0700

    MDB_DEBUG tweak for old compilers

commit c2f15990c70cb6b1cb3e081d1109e8a629ff1e92
Author: Howard Chu <hyc@symas.com>
Date:   Tue Oct 23 04:48:04 2012 -0700

    Fix flag checks in mdb_open

commit f5b8d017dffa3d0dd8b0ee803a999e97acf489ff
Author: Howard Chu <hyc@symas.com>
Date:   Tue Oct 23 04:32:55 2012 -0700

    fix Windows mdb_env_copy(), WriteFile overflow

commit 66f2b7b2ec4318557be079ad4764becf4e36ec73
Author: Howard Chu <hyc@symas.com>
Date:   Mon Oct 22 17:03:15 2012 -0700

    Make sure mdb_open flags are committed on main DB
    
    If no data was modified in the txn, mdb_open flag changes were dropped.

commit 5f2ddb5532df92c765f2f36a7606ed6ef28d23db
Author: Howard Chu <hyc@symas.com>
Date:   Mon Oct 22 16:13:06 2012 -0700

    Minor cleanup

commit 5c1ee7f7ba9580d5ff29e74cbb02eee335c33d94
Author: Howard Chu <hyc@symas.com>
Date:   Mon Oct 22 15:58:46 2012 -0700

    Fix MDB_PREV
    
    Could return 1 garbage record before actual data, if starting from EOF

commit 617769bce5bcac809791adb11301e40d27c31566
Author: Howard Chu <hyc@symas.com>
Date:   Tue Oct 16 16:52:13 2012 -0700

    Tweak output, add free page info

commit 754cd88819cceafe503b7a5c428b52c6abbcb748
Author: Howard Chu <hyc@symas.com>
Date:   Tue Oct 16 16:22:21 2012 -0700

    Add mdb_env_info() to retrieve interesting env params

commit 7f0771a3ed4ec42bd57f246919aba1dd755a207c
Author: Howard Chu <hyc@symas.com>
Date:   Tue Oct 16 15:28:20 2012 -0700

    Merge mdb_stata into mdb_stat

commit 65d40eb5d2c7c28df05e2c1d9b21d90e2a82e0b5
Author: Howard Chu <hyc@symas.com>
Date:   Tue Oct 16 14:53:25 2012 -0700

    Make sure increases of mapsize are persisted

commit 94965307c831be615f5fbb771c348fd72217adc0
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Mon Oct 15 17:04:48 2012 +0200

    ITS#7377 Errorcheck Windows calls and thread keys.

commit 88b7bb46394a53675b452b70e5a7a109626bdd3f
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Mon Oct 15 17:04:43 2012 +0200

    Explicitly unlock the MDB lockfile on Windows.

commit e9d87866c49acdba4118259fb05de2dafb4d698f
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Mon Oct 15 17:04:11 2012 +0200

    mdb_env_open(): Keep mdb_env_set_flags() flags.

commit 092f9a5c66425535f9d538d8fefd0049ad65f452
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Mon Oct 15 17:03:46 2012 +0200

    More for mdb_env_copy().
    
    Fix #define _GNU_SOURCE = 1 to match any command line -D_GNU_SOURCE.
    .gitignore += mdb_copy.

commit 462d9dfd104397652a905e8f685289bd4ac8a6e1
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Mon Oct 15 17:03:33 2012 +0200

    Fix last commit.
    
    Add flag MDB_ENV_ACTIVE instead of using the state of me_lfd.
    Require MDB_RDONLY for MDB_ROFS.  Swap reader/writer mutex lock.

commit e40713b631506dcab54402c26a826bd2d421dcb0
Author: Howard Chu <hyc@symas.com>
Date:   Sat Oct 13 04:05:00 2012 -0700

    Support read access on read-only media

commit f037dd2d19978256182a0f91f9a8178d37a8193f
Author: Howard Chu <hyc@symas.com>
Date:   Thu Oct 11 16:47:56 2012 -0700

    Silence warning in prev commit

commit ebb6859ea5f4ca44ca528e49b17800f9992703e7
Author: Howard Chu <hyc@symas.com>
Date:   Thu Oct 11 12:21:40 2012 -0700

    Add mdb_copy for backing up a DB environment

commit 756ce8e10ca52ff4516b56d42308116fac3c185d
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Wed Oct 3 21:13:21 2012 +0200

    Tweak MDB restrictions

commit a3f33dd20e71b9c94e94a0e1125fcee8d35fc70f
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Wed Oct 3 18:08:56 2012 +0200

    Fix mdb_open() off-by-one error in maxdbs check

commit 38fb8e6eb1c2db048fd2473bfcdd5eb16ec54517
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Wed Oct 3 18:06:29 2012 +0200

    ITS#7377 Wrap fcntl F_SETLK in EINTR loop too.
    
    This can happen even on local filesystems.

commit ab3fea51dc890feaca7075643efe9410949e5363
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Wed Oct 3 18:06:29 2012 +0200

    ITS#7377 Catch ftruncate() error

commit 2b960613e03dbc5b371378abfd051c8e75821171
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Wed Oct 3 18:04:07 2012 +0200

    ITS#7377 Document caveats/troubeshooting.

commit 7333b6bdc90c49c332d4728c62c7904e64c95077
Author: Howard Chu <hyc@symas.com>
Date:   Sun Sep 30 10:01:57 2012 -0700

    Fix prev commit
    
    It only worked if the freelist was already non-empty

commit cd228b47222e2606ea69391e6cf955ae9d5a636b
Author: Howard Chu <hyc@symas.com>
Date:   Sun Sep 30 07:49:30 2012 -0700

    Fix mdb_drop
    
    if it was the only operation in a txn, it would be ignored.

commit 0c4c6fe72a57f812e4486cd017298f730df19c23
Author: Howard Chu <hyc@symas.com>
Date:   Thu Sep 27 05:01:53 2012 -0700

    ITS#7385, check further for bad splits
    
    More for 48ef27b6f5c804eca6a9d27f8dd2b4ded376f8af
    Our definition of "large" data item needs to be smaller to
    handle more cases where a bad split is possible

commit ba6c3281a121d59ee2b69638861321596e375321
Author: Howard Chu <hyc@symas.com>
Date:   Wed Sep 19 06:15:09 2012 -0700

    Add MDB_GET_CURRENT
    
    return whatever the cursor is currently pointing at

commit d13ca0de4fccafa93cf97674f4b8539b8f00d3f3
Author: Howard Chu <hyc@symas.com>
Date:   Tue Sep 18 12:36:54 2012 -0700

    ITS#7394 ignore WRITEMAP if RDONLY

commit 0a359fb62998d54c4c3b44f0d1b243e52640fd72
Author: Howard Chu <hyc@symas.com>
Date:   Mon Sep 17 07:02:41 2012 -0700

    More for 48ef27b6f5c804eca6a9d27f8dd2b4ded376f8af
    
    page_split with newindex > split_indx

commit 5ef56b437e2163e14b7e761bcd2e2700fe007c7d
Author: Howard Chu <hyc@symas.com>
Date:   Mon Sep 17 07:01:28 2012 -0700

    More for ab04c50a32275e216b82edaeeed50208cf49336b
    
    Use explicit MDB_RDONLY flag

commit c67ea9c060d845829a5ef903f2437cac2e044255
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Mon Sep 17 15:42:15 2012 +0200

    ITS#7377 Catch MDB user errors.

commit c0f3d9b9a8864e744a8d1eaffc99bc86026d5351
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Mon Sep 17 15:42:15 2012 +0200

    ITS#7377 Catch MDB setup errors and clean up.

commit fe1b3794de3944967bd4ebce46dd0dc0d3449a17
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Mon Sep 17 15:42:15 2012 +0200

    ITS#7364 Limit mdb lock upgrade before sem_unlink.
    
    Do not try shared lock when closing or after error.  Track file lock
    state to decide.  Change meaning of *excl to reflect file lock state.

commit c760e536ec1b9fed01b4d8e8d884533dceec397d
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Mon Sep 17 15:42:15 2012 +0200

    ITS#7364 Always sem_unlink() in mdb_env_open().
    
    Drop the sem_unlink() error checks, which could prevent the 2nd
    unlink.  Instead use O_EXCL in sem_open().
    
    This makes "open+close the database" the API for trying to clean
    away the old semaphores, if they were left behind by a previous run.

commit 31be24896b455e45eaf4e3739299a19a29979183
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Mon Sep 17 15:42:14 2012 +0200

    ITS#7377 Wrap sem_wait & file locks in EINTR loops

commit a35f9b2a5346e84bc920111348a1ea7d1cdfe32a
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Mon Sep 17 15:42:14 2012 +0200

    Remove mdb data races. Use (txnid_t)-1 as "no ID".
    
    Avoid race between numreaders++ and reading numreaders at cleanup. Make
    the un-mutexed reset of reader table entry, atomic: Reset mr_pid only.
    
    Instead check mr_pid != 0 in mdb_page_alloc()'s scan for readers.
    (txnid_t)-1 as "no ID"-mark avoids a check for mr_txnid != 0.
    The scan can stop when seeing an old reader.

commit 38cc1e96b48ef0d0f00b79543c4c6db879537546
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Mon Sep 17 15:42:14 2012 +0200

    Save pid in MDB_env instead of repeating getpid().
    
    An open MDB environment does not survive or catch fork(),
    so repeating getpid() was pointless.

commit 20a216fcc9cbfad838f5bfc970a160a23e9fe2be
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Mon Sep 17 15:42:14 2012 +0200

    MDB_WRITEMAP needs no DSYNC descriptor (me_mfd)

commit 588a84a5ae0eb9ea343802e24b199af835204bfd
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Mon Sep 17 15:42:14 2012 +0200

    ITS#7363 Preprocessor namespace cleanup.
    
    Rename USE_POSIX_SEM to MDB_USE_POSIX_SEM.
    Separate MDB_FDATASYNC from MDB_USE_POSIX_SEM.

commit 8bb10add2465eee34e79abeaa62011e3e234effb
Author: Howard Chu <hyc@symas.com>
Date:   Mon Sep 17 06:35:03 2012 -0700

    More for ab04c50a32275e216b82edaeeed50208cf49336b
    
    Fix typos, error code ranges

commit acbff5b1eac9950c04780f8bcb4933cbc38fc9d8
Author: Howard Chu <hyc@symas.com>
Date:   Mon Sep 17 04:41:13 2012 -0700

    Add mdb_cursor_renew()
    
    Allow cursors on read-only txns to be reused with later txns.

commit 076b2b36a97b0d4cf206e517ef63965976ad5f75
Author: Howard Chu <hyc@symas.com>
Date:   Mon Sep 17 03:48:54 2012 -0700

    Shared lib should depend on pthread

commit c542442c9f4637847422ed2368ca3391d1476628
Author: Howard Chu <hyc@symas.com>
Date:   Mon Sep 17 02:17:25 2012 -0700

    Add MDB_SET_KEY cursor op
    
    Overwrites the passed in key with the DB's key

commit ab04c50a32275e216b82edaeeed50208cf49336b
Author: Howard Chu <hyc@symas.com>
Date:   Fri Sep 14 06:05:48 2012 -0700

    ITS#7383 More explicit error codes

commit 48ef27b6f5c804eca6a9d27f8dd2b4ded376f8af
Author: Howard Chu <hyc@symas.com>
Date:   Wed Sep 12 10:43:27 2012 -0700

    ITS#7385 fix mdb_page_split (again)
    
    More for d793594173bb5367e466134d5fe3366feeb672f6 ITS#7229

commit de7788289816cfabf47441b769ad39a0a59f81e6
Author: Howard Chu <hyc@symas.com>
Date:   Fri Sep 7 13:40:07 2012 -0700

    Update comments, bump version
    
    Note read-write vs read-only mmap tradeoffs.

commit 2e677bcb995b63d36461eea254f2134ebfe29da2
Author: Howard Chu <hyc@symas.com>
Date:   Thu Sep 6 11:17:25 2012 -0700

    msync should default to fully synchronous

commit 1c733bdc4e83e815f7391139b6c889841876120a
Author: Howard Chu <hyc@symas.com>
Date:   Wed Sep 5 08:40:17 2012 -0700

    Add msync support for WRITEMAP option

commit d8a89464cd702a95bfeb5593be0d743d33bbd443
Author: Howard Chu <hyc@symas.com>
Date:   Tue Sep 4 10:28:37 2012 -0700

    Add MDB_WRITEMAP to use a writable mmap

commit 14a08f877fc6b999432b392d2e38c063a261301c
Author: Howard Chu <hyc@symas.com>
Date:   Tue Sep 4 06:02:26 2012 -0700

    More for 57b5fbea491c956ed7a4ab7d12d802de2b29455d
    
    Fix abort of child txn

commit 4608cd955250c9ebb0eed62d220577b93acba39e
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Wed Aug 29 06:43:35 2012 +0200

    libmdb: Fix P_INVALID when pgno_t != unsigned long

commit 3e3c7850344a00d15ab541cf6cd833849f8ad5d9
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Wed Aug 29 06:42:52 2012 +0200

    libmdb: Check sem_open() against SEM_FAILED.

commit 4bc18a5dd391a2c24c617418c5ba3057c6505b54
Author: Howard Chu <hyc@symas.com>
Date:   Mon Aug 27 14:45:16 2012 -0700

    In mdb_audit, change assert to fprintf

commit 85ae5011e722ef5b7cc74de9d686c88f8c5268a9
Author: Howard Chu <hyc@symas.com>
Date:   Sun Aug 26 11:05:45 2012 -0700

    Fix mdb_audit()
    
    due to a0993354a603a970889ad5c160c289ecca316f81

commit bd92b570a8a3389a5e6bd86abcce2722919f8363
Author: Ondrej Kuznik <ondrej.kuznik@acision.com>
Date:   Fri Aug 24 05:28:36 2012 -0700

    ITS#7369 mdb_stat: cleanup in case something went wrong.

commit a2d1b42e3921d5c874a8f35fcd42047af604ce96
Author: Howard Chu <hyc@symas.com>
Date:   Fri Aug 24 05:23:55 2012 -0700

    ITS#7369 abort txn before exiting

commit 916995236ed5979b971615ecc763745c187d37f6
Author: Howard Chu <hyc@symas.com>
Date:   Wed Aug 22 23:01:19 2012 -0700

    ITS#7364 also close the mutexes as needed
    
    Otherwise a process that opens and closes an env more than once
    will leak mutex handles. (WIN32/BSD)

commit 46cf44270000eb17297b804121f9721932ba182b
Author: Chris Mikkelson <cmikk@qwest.net>
Date:   Wed Aug 22 16:51:35 2012 -0500

    ITS#7364 Remove POSIX semaphores when the last user closes the mdb environment.

commit 9f983b7999e380300ba83156f21b15d33fe2e680
Author: Chris Mikkelson <cmikk@qwest.net>
Date:   Wed Aug 22 13:22:19 2012 -0500

    ITS#7363 Use posix semaphores on apple and bsd systems.

commit f114fec545ba2189f3b2a0797b2ede8921a0f5f7
Author: Howard Chu <hyc@symas.com>
Date:   Thu Aug 16 10:25:40 2012 -0700

    Loop thru all DBs and show their stats
    
    This is quick and dirty, should be integrated into mdb_stat.

commit d53644f6820206f9aaf7c415e5f381f80c505c4a
Author: Howard Chu <hyc@symas.com>
Date:   Thu Aug 2 15:56:13 2012 -0700

    Minor cleanup

commit d1120fbccc7657342e71cd14f92d98625373dcbe
Author: Howard Chu <hyc@symas.com>
Date:   Tue Jul 31 16:03:48 2012 -0700

    Write optimization: avoid copying unused portions of pages.

commit 234cd9dfb54ef2f7f83963d95b6eb8e9735bb372
Author: Howard Chu <hyc@symas.com>
Date:   Thu Jul 26 08:42:41 2012 -0700

    Fix txn_commit error check

commit 23219ed32a7e2aed22e01f8e9903f506d0f4e142
Author: Howard Chu <hyc@symas.com>
Date:   Thu Jul 26 07:22:52 2012 -0700

    Fix 205bb17793e27be67098ccc80ee919165d7cb993
    
    Ignore current cursor pos if it's out of bounds.

commit d1a7fa267bdb9e27777ba87db44034ce83a75084
Author: Howard Chu <hyc@symas.com>
Date:   Thu Jul 26 06:25:31 2012 -0700

    Update sub-DBs before updating free list

commit d3990eb2f8b2944782604a2ca7bd52e08c58fc3e
Author: Howard Chu <hyc@symas.com>
Date:   Wed Jul 25 12:31:08 2012 -0700

    Append mode should also detect keys that are too small

commit 5da67968afb599697d7557c13b65fb961ec408dd
Author: Howard Chu <hyc@symas.com>
Date:   Tue Jul 24 04:21:40 2012 -0700

    Fix root split check in mdb_page_split

commit 205bb17793e27be67098ccc80ee919165d7cb993
Author: Howard Chu <hyc@symas.com>
Date:   Mon Jul 23 04:23:49 2012 -0700

    Skip unneeded calls to mdb_page_get in mdb_page_search

commit ccc4d23e749edc5ea461261427a0ee0a663fdfe5
Author: Howard Chu <hyc@symas.com>
Date:   Sun Jul 22 17:42:36 2012 -0700

    Leave extra space when creating a fake page
    
    Minimizes the number of memcpy's if additional dups are stored.

commit 05ec98d11927a5148bbea8ed5672fdf61609b6cd
Author: Howard Chu <hyc@symas.com>
Date:   Sun Jul 22 17:41:58 2012 -0700

    Append mode still needs to detect duplicates

commit 14fb1f59c7e119a100952890f947377d7e95f135
Author: Howard Chu <hyc@symas.com>
Date:   Sat Jul 21 06:10:02 2012 -0700

    Append tweaks, page_split fixes
    
    Append mode now does no key comparisons, input must be in sorted order.
    page_split was not updating cursor parents correctly.

commit 7e9a6134fde1e65648aa18c935c1af7554fd5b97
Author: Howard Chu <hyc@symas.com>
Date:   Tue Jul 17 04:02:48 2012 -0700

    Make sure cursor's DB is init'd if STALE.

commit a0993354a603a970889ad5c160c289ecca316f81
Author: Howard Chu <hyc@symas.com>
Date:   Thu Jul 12 17:04:05 2012 -0700

    Don't use env-private copy of DB root nodes.
    
    Just lookup the DB roots as needed. When many DBs are in use,
    most of the copies won't be referenced in a given txn, and
    there's a bad race condition in the copy routine.

commit 0ea56294f179d7e93e06a575af73837eb0a8607c
Author: Howard Chu <hyc@symas.com>
Date:   Fri Jul 13 11:57:11 2012 -0700

    Fix darwin sem_open() names
    
    Must begin with '/'

commit 1a9775dc5a0a494659b2669f0732cd09b152571d
Author: Howard Chu <hyc@symas.com>
Date:   Fri Jul 13 11:56:29 2012 -0700

    Fix ID -> MDB_ID due to 20baad4a207db5d0e84fc3a7409f216aefa59385

commit 248fd1c7b86c21f1f02f5bdd8b3018882159be63
Author: Howard Chu <hyc@symas.com>
Date:   Thu Jul 12 16:50:27 2012 -0700

    Windows thread callback support

commit e562f53e10b07ed439d3dae934198d3e9cdb9834
Author: Howard Chu <hyc@symas.com>
Date:   Sun Jul 8 18:24:11 2012 -0700

    Drop me_toggle, unused

commit 179c44e7da554049ded2c3733cfc83d440945496
Author: Howard Chu <hyc@symas.com>
Date:   Sun Jul 8 18:18:12 2012 -0700

    Revert "libmdb: Do not use the MDB_txbody.mtb_txnid field."
    
    This reverts commit 4a0b30499caab8628efcedb8be5643fead7cd17e.

commit 433105f09b33b28065a06185f628b4b38e0c4c22
Author: Howard Chu <hyc@symas.com>
Date:   Fri Jul 6 17:38:03 2012 -0700

    Fix: avoid direct reference to meta pages
    
    Relevant info should be copied during txn_begin only.

commit df7ddb6bf44a6ceec7f3974293fdc0669b68251f
Author: Howard Chu <hyc@symas.com>
Date:   Thu Jul 5 18:11:18 2012 -0700

    Add MDB_NOMETASYNC env option.
    
    Just a trial. This may not make sense if we decide to split the
    meta pages into their own separate file, to allow meta traffic to
    reside on a separate spindle.

commit 38560c2517d53bd43b530361ec7682657583aded
Author: Howard Chu <hyc@symas.com>
Date:   Thu Jul 5 17:43:29 2012 -0700

    Tweak b802bcf7040110e1f0768d9d9ffa88dabd4bd5e7
    
    Clarify prev commit, fix Doxygen comments broken by earlier changes

commit b802bcf7040110e1f0768d9d9ffa88dabd4bd5e7
Author: Howard Chu <hyc@symas.com>
Date:   Thu Jul 5 16:40:46 2012 -0700

    Partial revert of 13c663f666ac28d7a72cbe644d393fc8d2dd9881
    
    Don't re-use free pages so soon; that leaves us vulnerable to
    DB corruption if data syncs successfully but meta doesn't.

commit a334257800bc30810e4ed4da7fd2681c1f765821
Author: Howard Chu <hyc@openldap.org>
Date:   Sat Jun 2 05:26:31 2012 -0700

    Tweak prev commit, use first unused slot

commit 4cabb24b830af0ecf1b726837f6b5097239e27d1
Author: Howard Chu <hyc@openldap.org>
Date:   Sat Jun 2 05:24:47 2012 -0700

    Fix mdb_open, re-use closed dbi slots

commit eeec509150c3198047ec349eaf80eea90569ed2d
Author: Howard Chu <hyc@symas.com>
Date:   Wed May 9 11:24:25 2012 -0700

    ITS#7266 fix rebalance for LEAF2 pages

commit a540597dd6531c5a0648ebe46555559d93932b9e
Author: Howard Chu <hyc@symas.com>
Date:   Tue May 8 22:17:17 2012 -0700

    More freelist tweaks, avoid referencing freed page

commit fadf75a9cb2764f3797abb0c3c710e47101a5d51
Author: Howard Chu <hyc@symas.com>
Date:   Sat May 5 19:41:45 2012 -0700

    Further clarification of mdb_open()

commit fbf9c233045881e85ca2eaafd930af404bf39f86
Author: Howard Chu <hyc@symas.com>
Date:   Wed Apr 18 15:59:54 2012 -0700

    ITS#7251 fix Apple/Windows shared mutex naming

commit 20baad4a207db5d0e84fc3a7409f216aefa59385
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Thu Apr 12 07:34:14 2012 +0200

    libmdb: midl.h namespace cleanup.
    
    Prefix ID, NOID, ID2, IDL, ID2L with 'MDB_'.
    Also drop bdb from file description.

commit 0a4aa889277a701b893cd842d7cf73ff87a1ed90
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Thu Apr 12 07:34:14 2012 +0200

    libmdb: Simplify pick_meta() from read_meta().
    
    Put one call in #if MDB_DEBUG. Move DPRINTF(Using meta page #) there.

commit dce5bb2fee751d623327005e0c2ba625fae66c1f
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Thu Apr 12 07:34:14 2012 +0200

    libmdb: Simplify mdb_default_cmp. No real change.

commit 729a8a28196f043603b3c296b02e0010dfae1648
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Thu Apr 12 07:34:13 2012 +0200

    libmdb: signed meets unsigned warning cleanup

commit 99fa22c164438e6845ecd0878b02afb8069cdf9e
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Thu Apr 12 07:34:13 2012 +0200

    libmdb: MDB_FDATASYNC code cleanup.
    
    Define MDB_FDATASYNC() instead of redefining fdatasync().

commit 592b3f87279ce057985b8f1f55d39f746afbac14
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Thu Apr 12 07:34:13 2012 +0200

    libmdb: Add C++ 'extern "C" {}' to *.h

commit 8e1ebbb4a83a7c8b1500d00b7e5c5f3da134f1ca
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Thu Apr 12 07:34:13 2012 +0200

    libmdb: Don't open datafile twice when not needed.
    
    If the database is opened with MDB_RDONLY or MDB_NOSYNC,
    instead use the same file descriptor for me_mfd and me_fd.
    
    Also factor out Windows/Unix error handling after open.

commit 6d0b424dbe2dd4abe75fad7b88def5088b7ff074
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Thu Apr 12 07:34:13 2012 +0200

    libmdb: Set close-on-exec flag on lockfile

commit 4a0b30499caab8628efcedb8be5643fead7cd17e
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Thu Apr 12 07:34:13 2012 +0200

    libmdb: Do not use the MDB_txbody.mtb_txnid field.
    
    Get txn->mt_txnid from the meta page instead.  Otherwise it
    and txn->mt_toggle could become inconsistent, since read-only
    txns fetched both from MDB_txbody without mutex proteciton.

commit d1738c3e6b8260d4036ddd17b4f4194407d5ab38
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Thu Apr 12 07:34:13 2012 +0200

    Fix MDB_DEBUG in last ITS#7299 commit.
    
    Make DPRINTF usable in if-else.  Silence signed vs unsigned warning.

commit d793594173bb5367e466134d5fe3366feeb672f6
Author: Howard Chu <hyc@openldap.org>
Date:   Tue Apr 10 14:05:05 2012 -0700

    ITS#7229 more mdb_page_split tweaks
    
    Also add mdb_debug/mdb_debug_start to toggle debug output at runtime

commit a66f9e9292069ed01ae0fcf50e8a5bb3d3888935
Author: Howard Chu <hyc@symas.com>
Date:   Mon Apr 9 19:24:47 2012 -0700

    ITS#7210 fix check for freelist changes
    
    Was being fooled before because the newly malloc'd block had
    the same address as the previously freed block.

commit 191d78948b3af4ddc24773e3f73741281a25513d
Author: Howard Chu <hyc@symas.com>
Date:   Mon Apr 9 05:01:37 2012 -0700

    ITS#7238 doc clarification

commit ae027b52141d2748d59dfedcb4feebeda5162476
Author: Howard Chu <hyc@openldap.org>
Date:   Mon Apr 9 04:45:32 2012 -0700

    ITS#7229 additional tweaks
    
    Should probably compare nsize to pg_size/4 instead...

commit de0cb27d70554b8540cbb73bf5fe682546fd48f3
Author: Howard Chu <hyc@openldap.org>
Date:   Mon Apr 9 04:44:08 2012 -0700

    ITS#7230 check and strip 0 length IDLs from freelist

commit 7ba25c488a88520f01f9dd95dc6436fb7dfa6b83
Author: Howard Chu <hyc@symas.com>
Date:   Sat Apr 7 01:27:38 2012 -0700

    ITS#7229 more mdb_page_split fixes

commit 84acc0e803d34051c5e7b737c2544d3970cb8155
Author: Howard Chu <hyc@symas.com>
Date:   Wed Apr 4 05:22:26 2012 -0700

    ITS#7219 fixup keysize in previous commit

commit 0f1081449431cf0c2b4a00c1b742958f13cdb253
Author: Howard Chu <hyc@symas.com>
Date:   Tue Apr 3 12:24:27 2012 -0700

    ITS#7219 fix for odd-aligned keys in mdb_update_key()

commit 91bab157f65941919a69179a395d471cabfd3d79
Author: Howard Chu <hyc@symas.com>
Date:   Fri Mar 30 06:36:02 2012 -0700

    ITS#7210 fix leak of overflow pages in freelist

commit f53beeabee812922b55f0b3a4b82fe2e36ed132d
Author: Howard Chu <hyc@symas.com>
Date:   Wed Mar 28 10:44:18 2012 -0700

    Partial revert of prev commit
    
    Sub-DBs were correct before

commit ac0b18911b73e7ca5da3f239e6f388ed60ed6b6c
Author: Howard Chu <hyc@symas.com>
Date:   Wed Mar 28 10:34:35 2012 -0700

    Fix entry counts in cursor_put
    
    when replacing an existing item

commit 0952cfdf84d926da5e6ba984fa55b3ab5a2ef9aa
Author: Howard Chu <hyc@symas.com>
Date:   Wed Mar 28 09:33:06 2012 -0700

    Fix uninit'd xcursor index

commit 5c16c8842b8a41229f2256cdeb3ed1ce9bd4ad50
Author: Howard Chu <hyc@symas.com>
Date:   Wed Mar 28 09:20:18 2012 -0700

    Add mfree utility to show the freelist

commit 04f488e7a0b81be79f7cd28404457edadefef193
Author: Howard Chu <hyc@symas.com>
Date:   Tue Mar 27 10:42:22 2012 -0700

    ITS#7210 additional freelist fixes
    
    Also allow read access to freelist in mdb_cursor_open

commit b92af0760bab43d06d04a16c3f52aff3b5431b62
Author: Howard Chu <hyc@symas.com>
Date:   Tue Mar 27 06:44:28 2012 -0700

    ITS#7210 partial fix
    
    Allow pages from free list to be used when growing the free list.
    (Yes, this is self-referential...)

commit 8a4981d8aa01512faeffb0e96a03504efe1383da
Author: Howard Chu <hyc@symas.com>
Date:   Mon Mar 26 06:58:16 2012 -0700

    ITS#7213 fix page_split with MDB_APPEND
    
    don't skip the cursor adjust checks

commit 25e8e82c5f2ec03e495e237f0c9b4ac6ab739b94
Author: Howard Chu <hyc@symas.com>
Date:   Tue Mar 20 17:14:59 2012 -0700

    Update overflow page count when freeing overflow page

commit c7da506dd2c8d3b8a2b209a26afbcb2ff94db13c
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Fri Mar 9 19:30:34 2012 +0100

    Fix MDB_txninfo.mt2 padding on Windows/Apple

commit c7fe1f466e8bfcac0c9169c741710c76807a11ba
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Fri Mar 9 19:25:44 2012 +0100

    Tweak mdb comment with conflicting spec of 'ID'

commit 5c182fbedf5f69d167073c2a2b4766798a247928
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Fri Mar 9 19:22:31 2012 +0100

    Fix valgrind call after malloc failure in  mdb.
    
    Also line up the code logic a bit.

commit d3b9939e7178647232aa07f3e03a0984c70cd7b9
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Fri Mar 9 19:06:04 2012 +0100

    Clean up MAP_FAILED handling in mdb.
    
    Delay (MDB_txninfo*) cast to after comparing mmap() with MAP_FAILED.
    Otherwise, if MAP_FAILED = (void*)-1 but MDB_txninfo requires stricter
    alignment, the compiler could assume the result is never MAP_FAILED.
    
    Also store NULL in env->(me_map, me_txns) after mmap failure.

commit 2baadabdff2b517e71dc65c87b319bcc0cb0670f
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Fri Mar 9 18:45:39 2012 +0100

    ITS#7191 Align dirty MDB pages on the stack

commit 15f3e650da0fb2d4f93808c2e1fedad80e31bb59
Author: Howard Chu <hyc@symas.com>
Date:   Thu Mar 8 21:28:24 2012 -0800

    ITS#7191 more alignment tweaks
    
    Revealed when gcc optimization is enabled

commit 2ccf0d58b20345905d979e8534333e6a9a041271
Author: Howard Chu <hyc@symas.com>
Date:   Tue Mar 6 22:55:53 2012 -0800

    Fix typo in 7bc62c512824c0d54cc6885ea876c2764510eca2

commit 7bc62c512824c0d54cc6885ea876c2764510eca2
Author: Howard Chu <hyc@symas.com>
Date:   Tue Mar 6 22:12:21 2012 -0800

    ITS#7190 fix merging of branch pages in deletes

commit d50d57ed63a4fd29d90da3b7de9cc105fff63a3e
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sun Sep 25 23:36:49 2011 +0200

    Fix libmdb comments

commit e1b88d93ac8812635785dcc3f87ea015f454e022
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Mar 3 09:52:33 2012 +0100

    Remove development file libmdb/make.sh

commit d8b459808520027019987d19c79250cbf737f2c3
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Mar 3 09:49:20 2012 +0100

    ITS#7191 Fix mdb_xcursor_init1() unaligned access

commit 1b07b48c1abef0e5fdec19b0734fbf4bb1035f46
Author: Howard Chu <hyc@symas.com>
Date:   Fri Mar 2 17:26:49 2012 -0800

    ITS#7196 use IOV_MAX if it's defined and small

commit b23bb7a0b143bbe3d1cd301ea101368a80ddce67
Author: Howard Chu <hyc@symas.com>
Date:   Tue Feb 21 11:52:01 2012 -0800

    ITS#7160 get BYTE_ORDER def for HPUX (and Solaris)

commit 953796759e666adbc28962b9f79f97e8946819e3
Author: Howard Chu <hyc@symas.com>
Date:   Sat Jan 21 17:31:23 2012 -0800

    Fix typo in e8e57be42107a877f604d0c4e67115ef37681a1b

commit e8e57be42107a877f604d0c4e67115ef37681a1b
Author: Howard Chu <hyc@symas.com>
Date:   Sat Jan 21 08:22:59 2012 -0800

    Add valgrind support with -DUSE_VALGRIND
    
    Track allocations and invalid accesses to freed tmp pages.

commit 3d6b924c2560f39973de82d2599ce9d6542b9cb2
Author: Howard Chu <hyc@symas.com>
Date:   Sat Jan 21 08:20:43 2012 -0800

    txn_commit must abort txn before returning errors
    
    Fix for failure when committing a txn that is a child of
    some parent txn.

commit 1c8de1883c1a9c239a5ba69a291c07889c1fe7da
Author: Howard Chu <hyc@symas.com>
Date:   Sat Jan 21 08:18:37 2012 -0800

    ITS#7121 fix page splits when newindx == 0

commit b9cbcb05889811f64983622cd75a3485f688a0dc
Author: Howard Chu <hyc@symas.com>
Date:   Sat Jan 21 08:12:56 2012 -0800

    ITS#7126 fix cursor tracking code
    
    Don't compare cursors that aren't deep enough to match the
    current cursor.

commit 713bf092b6d3ac350deea6d8f641110784d61efe
Author: Howard Chu <hyc@symas.com>
Date:   Sat Jan 21 08:07:56 2012 -0800

    Happy New Year!

commit a17f8e73265d5407e0a3f98ab79add0f839b997b
Author: Howard Chu <hyc@openldap.org>
Date:   Wed Jan 4 15:25:18 2012 -0800

    ITS#7121 fix page splits when data+key size is too large

commit 81afbb2fca0effc3637c88ce03935b6b3f5eca47
Author: Kurt Zeilenga <kurt.zeilenga@isode.com>
Date:   Sun Jan 1 07:07:45 2012 -0800

    Happy New Year!

commit 95a72ac82a4ddd0fc8f27cc487e292ee70fa9c97
Author: Howard Chu <hyc@symas.com>
Date:   Fri Nov 18 15:43:55 2011 -0800

    Add $(SOLIBS) macro for shared lib dependencies

commit dd9c56f0fbe0925067642964c77f3ebff1a906de
Author: Howard Chu <hyc@symas.com>
Date:   Tue Nov 15 11:23:00 2011 -0800

    More s/DEBUG/MDB_DEBUG/

commit 575691ca8a5a6224eff23a55e0386b43f0b25db6
Author: Howard Chu <hyc@symas.com>
Date:   Mon Nov 14 16:21:59 2011 -0800

    Alignment fixes for debug msgs

commit 51c1ba6818fe102d610b73cf785672894e622666
Author: Howard Chu <hyc@symas.com>
Date:   Mon Nov 14 14:40:43 2011 -0800

    s/DEBUG/MDB_DEBUG/

commit 29de655bc42e9eecaafcb5a65177a8fae801b154
Author: Howard Chu <hyc@symas.com>
Date:   Fri Nov 11 12:49:11 2011 -0800

    Add MDB_FDATASYNC to allow override to fsync if needed.

commit 291c0ce2db8545a5d4b672c671cc289c241d1257
Author: Howard Chu <hyc@symas.com>
Date:   Fri Nov 11 10:59:27 2011 -0800

    Use <inttypes.h> instead of <stdint.h>

commit 8763c41e30b8bf28fc23e6ef3b47d2e39c15c0f5
Author: Howard Chu <hyc@symas.com>
Date:   Thu Nov 10 12:41:34 2011 -0800

    Fix size check

commit 04b522cc72ad5f40cfc09e97b8bd5734c810e7e9
Author: Howard Chu <hyc@symas.com>
Date:   Wed Nov 9 15:32:37 2011 -0800

    More Solaris warning cleanup

commit 68143e4532ba3b3dccdb4e80665140542170d6d6
Author: Howard Chu <hyc@symas.com>
Date:   Wed Nov 9 00:36:50 2011 -0800

    More pgno alignment tweaks

commit 690792c17074fd94d485cdd4037f45bd421438fd
Author: Howard Chu <hyc@symas.com>
Date:   Tue Nov 8 20:05:29 2011 -0800

    Add dummy DKEY define

commit cc7a89cd677980443a326a3d48fffb71871adb7d
Author: Howard Chu <hyc@symas.com>
Date:   Tue Nov 8 19:04:39 2011 -0800

    Add Solaris byte-order detection

commit f0c9d7732683b148e6df5a09683e4583fdd3d1fa
Author: Howard Chu <hyc@symas.com>
Date:   Tue Nov 8 16:45:45 2011 -0800

    Fix mdb_drop return

commit a103a64434cfbba6231b87c1b1c185dbece7eb8a
Author: Howard Chu <hyc@symas.com>
Date:   Fri Oct 14 22:03:46 2011 -0700

    Android/ARM portability
    
    2-byte alignment isn't good enough for subpages

commit 331bf92df58eefbf2272a235a7a19ef0f6fe7493
Author: Howard Chu <hyc@openldap.org>
Date:   Thu Oct 6 18:53:07 2011 -0700

    Fix page_split with MDB_RESERVE

commit 19e4df476dd8969209585903effa935de09771dc
Author: Howard Chu <hyc@symas.com>
Date:   Thu Oct 6 16:11:25 2011 -0700

    Fix subcursor initialization

commit 934a19553c058a799ddd27b1ae1e885e37d37a95
Author: Howard Chu <hyc@openldap.org>
Date:   Mon Oct 3 18:02:17 2011 -0700

    Don't use Append mode when splits are caused by sub-page inserts
    
    Sub-pages need room to grow...

commit ea0d07ffa324cd834b87dd29053961366172330b
Author: Howard Chu <hyc@symas.com>
Date:   Mon Oct 3 12:40:53 2011 -0700

    Fix freelist bug on page split
    
    NULL out env->pghead before writing it, so that its pages can't be used
    to satisfy the write.

commit 85bfb3c1d129f137d455b7208bac285dfa9c6b2d
Author: Howard Chu <hyc@openldap.org>
Date:   Mon Oct 3 11:25:31 2011 -0700

    Add rudimentary MDB_MULTIPLE support for puts
    
    Only for DUPFIXED DBs. Still could do better.

commit fa3c2945f5e2fe137970e4f964dbe14292ec0740
Author: Howard Chu <highlandsun@gmail.com>
Date:   Sun Oct 2 21:27:07 2011 -0700

    Add MDB_APPEND to avoid splitting full pages

commit 163514e4706cfcf827afde82c7d2811032c1c19b
Author: Howard Chu <highlandsun@gmail.com>
Date:   Sun Oct 2 19:52:12 2011 -0700

    Fix 6e05ca17e988754ae90fde1921765ba130bb90b2
    
    Missed a MDB_RESERVE case

commit 28b8aaeb9670cad3d02d1be226ff5980590625f4
Author: Howard Chu <hyc@symas.com>
Date:   Sun Oct 2 19:27:31 2011 -0700

    Add mdb_cursor_txn() and mdb_cursor_dbi() for querying the cursor

commit 6e05ca17e988754ae90fde1921765ba130bb90b2
Author: Howard Chu <hyc@symas.com>
Date:   Sun Oct 2 10:02:30 2011 -0700

    Add MDB_RESERVE mode
    
    When putting a record, just make space for the data, don't copy it.
    (Not compatible with MDB_DUPSORT, since the actual data is needed
    to determine the insert location.)

commit fe11433619573444d67ee2ce193725177579a9f0
Author: Howard Chu <hyc@symas.com>
Date:   Fri Sep 30 22:15:05 2011 -0700

    Tweak cursor adjustment code
    
    Skip the original cursor that made the change

commit 19d1e72bbc66a2a85d7dfe95b582e15fc5a6b04c
Author: Howard Chu <hyc@symas.com>
Date:   Thu Sep 29 21:07:07 2011 -0700

    Make sure mdb_open actually got a sub-db record

commit fa0d64242be440281629a6a5696d03257347e40e
Author: Howard Chu <hyc@symas.com>
Date:   Thu Sep 22 21:46:12 2011 -0700

    Doc for the MDB_NOSUBDIR env option

commit 7a40080dd185cdce547769a6c747238a54c1013e
Author: Howard Chu <hyc@symas.com>
Date:   Thu Sep 22 18:05:06 2011 -0700

    Add MDB_NOSUBDIR option
    
    Create the data file using exactly the given pathname, and
    the lock file using a suffix on the data file name.

commit 54eb76cc7aab42f5caa396ec920e1de8c1531970
Author: Howard Chu <hyc@symas.com>
Date:   Thu Sep 22 04:34:40 2011 -0700

    Reader table notes

commit 4bcaabecf5410065ba17d64d0fa95d2844aa5582
Author: Howard Chu <hyc@symas.com>
Date:   Wed Sep 21 17:21:48 2011 -0700

    assert cleanup

commit 619e671f1c85446c09864430030ad99c33561cc2
Author: Howard Chu <hyc@symas.com>
Date:   Wed Sep 21 16:37:29 2011 -0700

    txn_abort/commit free all their cursors now.

commit 9bcc51ef5d6e4081770cfb5cc309c6c8a6f38f2f
Author: Howard Chu <hyc@symas.com>
Date:   Wed Sep 21 16:06:52 2011 -0700

    Only free malloc'd cursors

commit b9d13a29e6c4c2742277c82bdc646c32d364a619
Author: Howard Chu <hyc@symas.com>
Date:   Wed Sep 21 14:14:11 2011 -0700

    Track changes to all cursors.
    
    For any change to a page or node, update all other cursors pointing
    at the same page (or node). Cursors are now stored in a linked list
    off their owning transaction. Cursors are all closed when the transaction
    ends. Cursors in parent transactions are updated when their child
    transaction commits.

commit c4d5e6e78634a6fa96cdf577688fb3a7fba266ed
Author: Howard Chu <hyc@symas.com>
Date:   Tue Sep 20 12:57:05 2011 -0700

    Add support for nested transactions.

commit 8fa10ae668b2fd1e35b7b5b36a1a0b42bd5698e2
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Tue Sep 13 09:39:28 2011 +0200

    libmdb IDL cleanup.
    
    Microoptimize IDL search.
    Use RANGE_<FIRST/LAST> when IDL is known to be a range.

commit 02abfb91ba3b2e62552fdb31d7fc3a1cde63b17f
Author: Howard Chu <hyc@symas.com>
Date:   Sun Sep 18 18:26:54 2011 -0700

    Additional fix for prev commit

commit 4272e7de4f2f068b99cc6e32dd4ba86beb4d7266
Author: Howard Chu <highlandsun@gmail.com>
Date:   Sun Sep 18 18:13:23 2011 -0700

    Make sure 2 subpages fit in one real page

commit 237fabda645410996abc7d1285cf4a1b66ac298b
Author: Howard Chu <hyc@symas.com>
Date:   Sun Sep 18 17:07:47 2011 -0700

    Fix last delete from a subpage

commit 0ab841598ffb490f4246f892248f0b409e411cc1
Author: Howard Chu <hyc@symas.com>
Date:   Sun Sep 18 16:39:18 2011 -0700

    Fix 09006ccec7928c9cf53bca6abe741e8d4d466c98
    
    Check for stale DBs was in the wrong place.

commit 2c70d0430adc24b1afb59a265ffcc43a124e64ad
Author: Howard Chu <hyc@symas.com>
Date:   Sun Sep 18 14:18:27 2011 -0700

    Fix mdb_drop() if not deleting the DB record

commit 77b1017b85338bfd54de9052e431a44b68119e14
Author: Howard Chu <hyc@symas.com>
Date:   Sun Sep 18 13:28:08 2011 -0700

    Fix typo, minor cleanup

commit 57b5fbea491c956ed7a4ab7d12d802de2b29455d
Author: Howard Chu <hyc@symas.com>
Date:   Sun Sep 18 12:37:02 2011 -0700

    Add mdb_drop() for deleting a DB
    
    Allow MIDLs to grow arbitrarily, to allow unlimited number of
    pages to be freed in one txn.

commit 09006ccec7928c9cf53bca6abe741e8d4d466c98
Author: Howard Chu <hyc@symas.com>
Date:   Sun Sep 18 10:38:08 2011 -0700

    API change, consistency check
    
    mdb_close() takes an env, not a txn.
    Also, add check for stale DB records (in case some other process
    wrote to the DB last).

commit b7057eb61e690ebad59e6c9ff15e616933ce42cd
Author: Howard Chu <hyc@symas.com>
Date:   Fri Sep 16 16:51:32 2011 -0700

    New sorted-dup subpage support
    
    Instead of converting directly to a subDB when the first duplicate
    item is seen for a key, convert to a subpage instead. Allow the
    subpage to grow up to the overflow limit, then convert to a subDB.
    This saves a significant amount of space in a typical slapd index
    database.
    
    Currently we don't convert back to the smaller form if items are
    later deleted. Probably could do that with some hysteresis, e.g.,
    convert back from subDB to subpage when the size drops below
    (overflow limit/2). Maybe later.

commit 0a2854813175db57a0bc91cee337b3987f2aa849
Author: Howard Chu <hyc@symas.com>
Date:   Thu Sep 15 10:36:15 2011 -0700

    Use FNV-1A hash to generate unique mutex names
    
    For Windows and MacOSX

commit 2c033676ea481f3f84b843c09c81295d0d30a46d
Author: Howard Chu <hyc@symas.com>
Date:   Wed Sep 14 20:33:09 2011 -0700

    Doc tweak - txn flags

commit 5b7c983a663ee45a3a2f7f05bbe7d294013a06d6
Author: Howard Chu <hyc@symas.com>
Date:   Wed Sep 14 20:30:26 2011 -0700

    MacOSX semaphore names are limited to 31 chars
    
    Including the terminating NUL. Good job documenting that, guys.

commit 0533f80364810fb89b1feac892f9397fffe6ebd0
Author: Howard Chu <hyc@symas.com>
Date:   Wed Sep 14 11:31:27 2011 -0700

    Add MacOSX support
    
    mmap() with FIXEDMAP fails, otherwise things work.

commit e222506b88bcadff3ff63c055e0257233721606e
Author: Howard Chu <hyc@symas.com>
Date:   Wed Sep 14 01:46:08 2011 -0700

    Minor doc cleanup

commit 9e3e7cefd8d9ac36eaa42b9a3b46b2694030d834
Author: Howard Chu <hyc@symas.com>
Date:   Wed Sep 14 01:08:01 2011 -0700

    More docs

commit 71a665aa9dd2da3dd56b5daff8597e2f1645b182
Author: Howard Chu <hyc@symas.com>
Date:   Tue Sep 13 23:36:41 2011 -0700

    Namespace cleanup

commit 56fe0d4f1a90f0a8bac5f6096ddfdc6d670fea95
Author: Howard Chu <highlandsun@gmail.com>
Date:   Tue Sep 13 13:34:22 2011 -0700

    Tweak search_node inner loop to avoid LEAF2 checks

commit 70c79df1dfd70e90a4c18d3d9710a3b01be011b2
Author: Howard Chu <highlandsun@gmail.com>
Date:   Tue Sep 13 11:25:17 2011 -0700

    cursor_set/search_node tweaks, use intcmp when possible

commit dc83777ab9e925e66c172d16621956bd9af17019
Author: Howard Chu <hyc@symas.com>
Date:   Mon Sep 12 01:11:56 2011 -0700

    Minor tweaks, update relfunc behavior

commit 25529a4c36903d0456b1251712de32f665850029
Author: Howard Chu <hyc@symas.com>
Date:   Sun Sep 11 23:57:17 2011 -0700

    More cursor_init cleanup

commit 8acb7550349352522a4e2eb10bfa27850df89079
Author: Howard Chu <hyc@symas.com>
Date:   Sun Sep 11 23:13:36 2011 -0700

    One more sub-cursor fix

commit 92a63ff79026fa3f2373cde4bb6793f132b8f287
Merge: 3501248 946b38f
Author: Howard Chu <hyc@symas.com>
Date:   Sun Sep 11 22:23:35 2011 -0700

    Merge branch 'mdb.master' of ssh://git-master.openldap.org/~git/git/openldap into mdb.master

commit 350124854855ba3aeda6f07c8d6e4d1f27b835bc
Author: Howard Chu <hyc@symas.com>
Date:   Sun Sep 11 20:54:32 2011 -0700

    Fix 2e3bc39fa94f21d692d8e94183f57aef9122c487
    
    Various mistakes when converting from previous data structures.
    Add a few more debug asserts/sanity checks.
    Split all "if (foo) return" constructs to separate lines to allow
    easier breakpoint setting.
    
    Add mtest6 for checking mdb_split() behavior. This needs to be
    expanded to check rebalance/merge cases too.

commit 946b38f471636e475661daf3569ce9d1f86c6ed2
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sun Sep 11 13:00:52 2011 +0200

    Fix mdb debug formats

commit ed0fc55fd39b50b19b5c7cf30d41811b180f1ae5
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sun Sep 11 11:08:40 2011 +0200

    Restore missing LAZY_LOCKS semicolon.
    
    Lost in C90 compat commit c5dad7a6d0eb1b3597beda18b38fe92820df0d30.

commit 90ed5533015ce2ad668422aca318e40ee1ce7410
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Sep 10 10:11:56 2011 +0200

    mdb integer type cleanup: Use MDB_dbi consistently.
    
    This changes the prototype of mdb_env_set_maxdbs().

commit b56be64d2e5ff6ab79533df2949ebdf3df383427
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Sep 10 20:01:07 2011 +0200

    Drop ULONG in favor of size_t.

commit b1cfff4aeb9aceed8b18714f4029bd53d59f05ca
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Sep 10 10:11:56 2011 +0200

    Add mdb.c:txnid_t for readability.
    
    Maybe later we'll test txnid wraparound with it defined to ushort.

commit bf9d722bec7d0e6094242b405d6a66720b934fc6
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Sep 10 10:11:56 2011 +0200

    mdb type cleanup: Consistent reader count types.
    
    Use unsigned int for reader counts/max limits, that's the smallest
    change.  Don't need uint32_t when mdb_env_set_maxreaders() takes less.
    Change prototypes of mdb_env_set_maxreaders,mdb_env_get_maxreaders().
    Check the mdb_env_set_maxreaders() argument.

commit 5f682934751d54263df19f3b181f1555158daf25
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Sep 10 10:11:55 2011 +0200

    explain mdl_midl_sort() istack size

commit 2d1f3b7ed39007201cb009a4e7ed8aa58a4be6fc
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Sep 10 10:11:55 2011 +0200

    Fix memn(r)cmp of key sizes > INT_MAX.  Simplify.

commit 69e53cf700bcceb5c531384ab97e10c2ecff922a
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Sep 10 10:11:55 2011 +0200

    Check some mdb integer type assumptions

commit 88da18cccfb7e76b35e075b0c9419c6b164c6a43
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Sep 10 10:11:55 2011 +0200

    Put MDB_node.<mn_lo,mn_hi> in host byte order.

commit c5dad7a6d0eb1b3597beda18b38fe92820df0d30
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Sep 10 10:11:55 2011 +0200

    C90 compatibility cleanup in mdb.
    
    Fix void* pointer arithmetic in cintcmp().
    Fix invalid ';'s in declarations after possibly-empty macros.

commit 3dc8fa491add8aaa7688375439d967bb5ffe524f
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Sep 10 10:11:55 2011 +0200

    Cleanup mdb macros.
    
    Parenthesize.  Rename GetPageSize -> GET_PAGESIZE since it does not
    behave like a function (it has a non-pointer output argument).

commit ec2d82f79ae0884326daf2276e42052fae2ca750
Author: Hallvard Furuseth <hallvard@openldap.org>
Date:   Sat Sep 10 10:11:55 2011 +0200

    libmdb/.gitignore += test[45], Doxygen output

commit acdc248f57306edc00046c43e5af0126e06de50b
Author: Howard Chu <hyc@openldap.org>
Date:   Fri Sep 9 21:43:22 2011 -0700

    If put(NOOVERWRITE) exists, return existing data

commit a7edb95e6496bb65eed291fffc1eb11fbf60f7cd
Author: Howard Chu <hyc@symas.com>
Date:   Fri Sep 9 03:52:12 2011 -0700

    Minor typos, additional clarification

commit 0c487538cf05df05b2c60e1814cf8153fae768fc
Author: Howard Chu <hyc@symas.com>
Date:   Thu Sep 8 20:18:29 2011 -0700

    Partial revert, fix MDB_page definition

commit 9ac8638d9d9e5c7f58f2d637c07894f398b51193
Author: Howard Chu <hyc@symas.com>
Date:   Thu Sep 8 17:13:51 2011 -0700

    More docs

commit bed3123b828a83d0a3f07e87a70fad1251e84ab8
Author: Howard Chu <hyc@symas.com>
Date:   Thu Sep 8 13:11:33 2011 -0700

    More docs

commit 1b69295a48cca409ed0c2f3fe655325e00f55ce2
Author: Howard Chu <hyc@symas.com>
Date:   Thu Sep 8 13:10:17 2011 -0700

    Speedup cintcmp
    
    Now that we know we're always 2-byte aligned...

commit dac3fae3b540841ae753bea16f3b353e2124c43d
Author: Howard Chu <hyc@symas.com>
Date:   Thu Sep 8 10:08:21 2011 -0700

    Fix previous commit

commit 6ac14938e239ff108f8f242c753bde563439b44d
Merge: 47c1218 8678fef
Author: Howard Chu <hyc@symas.com>
Date:   Wed Sep 7 23:57:50 2011 -0700

    Merge branch 'mdb.cursor' into mdb.master

commit 8678fef59780d655cdddc50f33b9515f899ded70
Author: Howard Chu <hyc@symas.com>
Date:   Wed Sep 7 23:10:19 2011 -0700

    Forgot to commit this

commit 47c1218916becc65dcf74eb995fd9f57bed2b397
Author: Howard Chu <hyc@symas.com>
Date:   Wed Sep 7 23:10:19 2011 -0700

    Forgot to commit this

commit 2e3bc39fa94f21d692d8e94183f57aef9122c487
Author: Howard Chu <hyc@symas.com>
Date:   Wed Sep 7 02:04:40 2011 -0700

    Further cursor-based restructuring
    
    Get rid of all of the redundant MDB_*page structs and other cruft.

commit 976a15097385f7ba0af0379fc9fd712e4e048467
Author: Howard Chu <hyc@symas.com>
Date:   Tue Sep 6 23:37:37 2011 -0700

    Cleanup unused code

commit 1f8c3369b90f54d7fd58c5e327343ca1c708e813
Author: Howard Chu <hyc@symas.com>
Date:   Tue Sep 6 23:16:45 2011 -0700

    Fix mdb_move_node again

commit f9c8796d0b3ed9bc0f51c76bb28609121b1e2eec
Author: Howard Chu <hyc@symas.com>
Date:   Tue Sep 6 15:22:53 2011 -0700

    Fix search_node, add cintcmp

commit 5e6a864513c9fa6f281a3cb0989b682f9061fa91
Author: Howard Chu <hyc@symas.com>
Date:   Tue Sep 6 12:54:09 2011 -0700

    Guarantee nodes are 2-byte aligned
    
    Also fix xcursor_init1 md_dirty flag
    Also another mdb_cmp refactoring fix

commit 293df78b2be77d6d153fd7052cc62d3377dc5501
Author: Howard Chu <hyc@symas.com>
Date:   Tue Sep 6 05:17:24 2011 -0700

    Change MDB_node to depend on 2-byte alignment

commit 807841b1aa2ef3bbf8466ca936f213e5520050fc
Author: Howard Chu <hyc@symas.com>
Date:   Mon Sep 5 16:54:39 2011 -0700

    Fix for mdb_cmp refactoring

commit 963c421a971cc4e95947f3ff20a70a6cc8c9cb5d
Author: Howard Chu <hyc@symas.com>
Date:   Mon Sep 5 14:22:46 2011 -0700

    Minor cleanup

commit 2cde97ae94d67405cec056839c766388ba0bc1f4
Author: Howard Chu <hyc@symas.com>
Date:   Mon Sep 5 02:36:24 2011 -0700

    Use mdb_midl_append/sort instead of _insert

commit 70a4f6f29d7cc488a3e03598bf62bb93a9332361
Author: Howard Chu <hyc@symas.com>
Date:   Mon Sep 5 00:46:32 2011 -0700

    mdb_cmp refactoring

commit 7bb14a2e79972a452fa37d2baa973c9dfc2e55ba
Author: Howard Chu <hyc@symas.com>
Date:   Sun Sep 4 18:34:03 2011 -0700

    Cursor stuff working, no major perf gain

commit 1843fe0b53cbeed89d6c4c3036b23957739909cf
Author: Howard Chu <hyc@symas.com>
Date:   Sun Sep 4 11:59:32 2011 -0700

    Cursors in-progress, broken

commit 8d89a53165a5d4b5c5725e3b8997b271aa734c0b
Author: Howard Chu <hyc@symas.com>
Date:   Sat Sep 3 20:42:46 2011 -0700

    Use cursor->mc_flags

commit 7f46832ec595e17818dd65dacbe8aeb8b72ed410
Author: Howard Chu <hyc@symas.com>
Date:   Sat Sep 3 17:24:39 2011 -0700

    Begin reimplementing basic ops as cursor ops

commit f6edbd7793e5c01cb9089365872d01c11206c2ae
Author: Howard Chu <hyc@symas.com>
Date:   Sat Sep 3 15:19:24 2011 -0700

    Add MDB_{FIRST,LAST}_DUP for cursor_get

commit 9d821c26c3023b1efe3270cf8a8ce5eca111189f
Author: Howard Chu <highlandsun@gmail.com>
Date:   Sat Sep 3 20:11:07 2011 -0700

    Fix mdb_split, fix MDB_GET_BOTH

commit e91dae3ed52ea2ced5d747b3ab95534c957c8e6d
Author: Howard Chu <hyc@symas.com>
Date:   Fri Sep 2 03:09:05 2011 -0700

    Cleanup midl, start documenting internals

commit b30d0266e7ebc0dc0a3eafea2938fd41c0676566
Author: Howard Chu <hyc@openldap.org>
Date:   Fri Sep 2 01:09:11 2011 -0700

    Tweak docs

commit 30736a0ff5baf9159e02a0562ac7bd31ea128c3d
Author: Howard Chu <hyc@symas.com>
Date:   Thu Sep 1 03:38:48 2011 -0700

    Ugly-as-sin initial Windows port

commit 2510bea718d725b179abefdb01f5ed58a5ecd560
Author: Howard Chu <hyc@symas.com>
Date:   Wed Aug 31 04:58:40 2011 -0700

    API cleanup, doxygen docs for public API

commit 0f459dd77307b296078d3ce507522322bb6549ab
Author: Howard Chu <hyc@symas.com>
Date:   Mon Aug 29 16:55:41 2011 -0700

    Cleanup, fix freelist alloc
    
    Don't allow new pages for free list to come from the free list.
    Otherwise a nasty data self-reference occurs that is too much
    trouble to unwind.

commit f7aa0d5e4af93eb950dc503ff4c72a4f6a62b901
Author: Howard Chu <hyc@symas.com>
Date:   Mon Aug 29 03:45:13 2011 -0700

    Tweak locks, fix race conditions

commit d27a7754f341c33145534915e62ae91785bb0e9c
Author: Howard Chu <hyc@symas.com>
Date:   Sat Aug 27 17:32:24 2011 -0700

    Reduce excessive memcpy in mdb_split

commit 027e1daa105b3ffe8c1061d9aca0fe22714518b9
Author: Howard Chu <hyc@symas.com>
Date:   Sat Aug 27 16:53:58 2011 -0700

    Fix mdb_split, tweak split_indx if space is tight

commit 01b9fc59fb2b8b4576ed43445b16b531d0b7b2ce
Author: Howard Chu <hyc@symas.com>
Date:   Fri Aug 26 13:37:02 2011 -0700

    Fix update of big data items

commit 13c663f666ac28d7a72cbe644d393fc8d2dd9881
Author: Howard Chu <hyc@symas.com>
Date:   Fri Aug 26 00:01:16 2011 -0700

    Fix free page reclaim and dbs table update
    
    Can re-use free pages 1 txn earlier
    Must update all dbs tables on txn commit

commit 94718fab000c63c0bd06e43bf91b9b0a3788ccd7
Author: Howard Chu <hyc@symas.com>
Date:   Thu Aug 25 19:45:08 2011 -0700

    More debug, fix MDB_DEL_DUP

commit ee69051a7cfda19330f3c0645cfa420072ceff10
Author: Howard Chu <hyc@symas.com>
Date:   Thu Aug 25 02:08:56 2011 -0700

    More debug output

commit d54eb7dd816d4c612d6d534bbac039216ea4c0fb
Author: Howard Chu <hyc@symas.com>
Date:   Wed Aug 24 01:45:42 2011 -0700

    Add txn_reset / txn_renew

commit 590c728044348a2c0d0fa0a46105b4c2c63fe326
Author: Howard Chu <hyc@symas.com>
Date:   Sun Aug 21 17:49:54 2011 -0700

    First cut at DUPFIXED support
    
    Also in cursor_set, check the current page (if already set from
    before) before starting over again from the root.

commit 720c4b0a3d63c00d807dc9e3c891f23242e14a99
Author: Howard Chu <hyc@symas.com>
Date:   Fri Aug 19 17:20:56 2011 -0700

    Set MINKEYS to 2
    
    For better space utilization

commit 66a647e55deb4f4b6e62af6441b50d4a11fd4c1f
Author: Howard Chu <hyc@symas.com>
Date:   Fri Aug 19 16:43:57 2011 -0700

    Keep re-using dpages instead of freeing them

commit ca496bd357bf945c51c2f542bab110724f22d71d
Author: Hallvard B Furuseth <h.b.furuseth@usit.uio.no>
Date:   Fri Aug 19 08:45:57 2011 +0200

    Avoid cast-away-const for errstr[]

commit 5b3b522313893982163b59027ab775e488ca868a
Author: Hallvard B Furuseth <h.b.furuseth@usit.uio.no>
Date:   Fri Aug 19 20:35:25 2011 +0200

    Wrap O_DSYNC in MDB_DSYNC.
    
    If O_DSYNC is not defined, that may be due to poor compiler options.
    We could fall back to the less efficient O_SYNC, but it seems better
    to let the user learn of the problem and give better compiler options.

commit cb7c95522055c4928a78694605ca1b5cc679b8fc
Author: Hallvard B Furuseth <h.b.furuseth@usit.uio.no>
Date:   Fri Aug 19 17:27:06 2011 +0200

    Simplify: Replace IDL*_CMP() with CMP()

commit 3029bb694de9128b6539c924b3385686dbc427bb
Author: Hallvard B Furuseth <h.b.furuseth@usit.uio.no>
Date:   Fri Aug 19 21:56:10 2011 +0200

    Macro cleanup: Parenthesize, simplify, remove a ;

commit a1b4144b8079e0de8b99149a7b4b6a5be3123d54
Author: Hallvard B Furuseth <h.b.furuseth@usit.uio.no>
Date:   Fri Aug 19 20:18:18 2011 +0200

    Drop gcc extension ,##__VA_ARGS__.  Add DPUTS().
    
    C99 says DPRINTF(fmt, ...) must get at least 2 args.  Using DPUTS for 1 arg.

commit 8f77043372b77a5fdceaa84da969fa1ebd7d9c81
Author: Howard Chu <hyc@symas.com>
Date:   Fri Aug 19 13:57:36 2011 -0700

    Fix cursor_set for dups
    
    Also make sure dups are counted in md_entries

commit edf9d8e51bbc36594f1fad0681ebd03a880cfd38
Author: Howard Chu <hyc@symas.com>
Date:   Fri Aug 19 13:10:51 2011 -0700

    Sorted dups fix
    
    Write the first datum normally. Convert to a sub-db if
    additional items for the same key are written.

commit e15d4d16b6a01ef0fb249885051bbc9e0756ead1
Author: Howard Chu <hyc@symas.com>
Date:   Fri Aug 19 00:14:16 2011 -0700

    Don't alloc in cursor_push/pop

commit 1ceae5c2c011edc5b5997e08270c5edc185fd248
Author: Howard Chu <hyc@symas.com>
Date:   Thu Aug 18 23:09:17 2011 -0700

    Fix multi-page commits

commit 6d924c1dda5a2ce6333e139c029576d3ca2d329b
Author: Howard Chu <hyc@symas.com>
Date:   Thu Aug 18 21:58:22 2011 -0700

    Fix overflow page read

commit 3dd815162ca77f03e45cde54886af5d52ee8aae1
Author: Howard Chu <hyc@symas.com>
Date:   Thu Aug 18 20:28:02 2011 -0700

    Sub-DB init/dirty fixes

commit 11308a190d31e2c9aee3c8ec8e87caf122afa58e
Author: Howard Chu <hyc@symas.com>
Date:   Thu Aug 18 19:30:54 2011 -0700

    Fix dupsort fetch

commit 697e00a8e2133794acac51d9e52f56459983d404
Author: Howard Chu <hyc@symas.com>
Date:   Thu Aug 18 19:22:24 2011 -0700

    More txn/cursor cleanup

commit e29660566c181cecece9c9b1d632eda7b34ba84c
Author: Howard Chu <hyc@symas.com>
Date:   Thu Aug 18 17:38:39 2011 -0700

    Update DB tables on commit even if no dirty pages

commit bab6be80775e1c49f876418c90d9d267694d387b
Author: Howard Chu <hyc@symas.com>
Date:   Tue Aug 16 16:47:15 2011 -0700

    Add mdb_strerror(), mdb_env_set_flags()

commit 9902a7764e1cefa56a001bde6751e607f14b2702
Author: Howard Chu <hyc@symas.com>
Date:   Tue Aug 16 14:23:44 2011 -0700

    allow silent commit of read-only TXNs

commit 9860d5a43ffb8c3bf28954bc5d934d570e136134
Author: Howard Chu <hyc@symas.com>
Date:   Mon Aug 15 18:40:50 2011 -0700

    Protect err codes

commit 5e3a3db1f2dac9f47123a4032bd5435c70a45c1a
Author: Howard Chu <hyc@symas.com>
Date:   Mon Aug 15 18:37:30 2011 -0700

    Error cleanup
    
    Replace MDB_FAIL with more specific codes
    Return MDB_PANIC after failure to write meta page

commit 5ef6c43acfb64f86efb6c6b08e95552743140ddc
Author: Howard Chu <hyc@symas.com>
Date:   Sun Aug 14 20:12:20 2011 -0700

    Get rid of AC_MEMCPY

commit 1aa5105b674ed3a35e28ac4fe29d00d5e321e32a
Author: Howard Chu <hyc@symas.com>
Date:   Sun Aug 14 20:01:26 2011 -0700

    Use IDL2 for dirty page list

commit 88a5f35c433bd81658f5c5d72b7ab681fd7a4f67
Author: Howard Chu <hyc@symas.com>
Date:   Sun Aug 14 17:36:44 2011 -0700

    Use O_DSYNC on metafd.
    
    Use sync writes in mtest.

commit 3e1c72a08e30243c6e31968f4a13b64e12eb16fd
Author: Howard Chu <hyc@symas.com>
Date:   Fri Aug 12 04:59:12 2011 -0700

    Minor cleanup

commit 19f5eebff80d9eeacc6ccf74b7bfa7718e3f7ea2
Author: Howard Chu <hyc@symas.com>
Date:   Fri Aug 12 04:47:00 2011 -0700

    Better defs for locker structures

commit af0b49aa6089347fa63a54dfe21e8eca756ad2d5
Author: Howard Chu <hyc@symas.com>
Date:   Fri Aug 12 04:11:14 2011 -0700

    Silence stupid warning

commit f9f0ec92a995cbabb1e3bc09a872b35442b965db
Author: Howard Chu <hyc@symas.com>
Date:   Thu Aug 11 23:20:16 2011 -0700

    Add mdb_version()

commit 76d7ca8ce0637315d0940b0865137f0c22483683
Author: Howard Chu <hyc@symas.com>
Date:   Thu Aug 11 21:14:29 2011 -0700

    Rationalize mdbenv namespace

commit c378b2525c7b3b1df2b699e303d2f2d0420475e0
Author: Howard Chu <hyc@symas.com>
Date:   Thu Aug 11 20:23:39 2011 -0700

    Move MDB_VERSION to mdb.h, use major/minor/patch

commit af70c0d9ced6fa7b14683922b7cd2b6bc694ff32
Author: Howard Chu <hyc@symas.com>
Date:   Thu Aug 11 20:16:10 2011 -0700

    Tweak MDB_val to match struct berval

commit 985f765dc53621f8db910737f677261de4562433
Author: Howard Chu <hyc@symas.com>
Date:   Thu Aug 11 17:33:28 2011 -0700

    Rename idl to midl

commit f5297dfc25a38c8ef82f320cbb8e7cf035dff63f
Author: Howard Chu <hyc@symas.com>
Date:   Thu Aug 11 15:03:33 2011 -0700

    Add another FIXME comment

commit 35fca0f6af07878ae3b6065f422c1f71541bd5b8
Author: Howard Chu <hyc@symas.com>
Date:   Thu Aug 11 14:56:54 2011 -0700

    Add mtest2 and 3

commit b070f7bff9603259469b241282f2825e8576ee85
Author: Howard Chu <hyc@symas.com>
Date:   Thu Aug 11 14:55:58 2011 -0700

    Portability tweak

commit 170703b0e486dd4be8f0381f0aad60091e30d9c3
Author: Howard Chu <hyc@symas.com>
Date:   Thu Aug 11 14:35:52 2011 -0700

    Make a shared library too

commit 785d8e184cba7b7d1fcc45eceb5e7b1a9b7725c8
Author: Howard Chu <hyc@symas.com>
Date:   Thu Aug 11 14:23:01 2011 -0700

    Start using as a library

commit 920115f7470161e6e7ac5c0fd96295b647d1b108
Author: Howard Chu <hyc@symas.com>
Date:   Thu Aug 11 13:43:01 2011 -0700

    Sorted dup fixes

commit ce9456d95cadf5783ce3f3ad26eb407aa0f14197
Author: Howard Chu <hyc@symas.com>
Date:   Thu Aug 11 11:35:39 2011 -0700

    Add MDB_INTEGERKEY db flag

commit d499c244cd39bec338cb371a5a8bae7ae38b9ac3
Author: Howard Chu <hyc@symas.com>
Date:   Thu Aug 11 05:04:49 2011 -0700

    Allow setting DB flags on main DB

commit 2f7ddb4103a8b4161b47353d160ea75028c52936
Author: Howard Chu <hyc@symas.com>
Date:   Thu Aug 11 04:46:14 2011 -0700

    Cleanup, add mdb_cursor_count()

commit 2e776bd36eae2369325f32c58b6beaaa5a0aff24
Author: Howard Chu <hyc@symas.com>
Date:   Thu Aug 11 04:00:19 2011 -0700

    More DB checks

commit b834dc05b3d4f4a71fb5e415d7f6a39f6e1963fe
Author: Howard Chu <hyc@symas.com>
Date:   Thu Aug 11 03:48:26 2011 -0700

    Consolidate stat functions

commit 11204d176a79b0525908df24bb4668b4b855fd19
Author: Howard Chu <hyc@symas.com>
Date:   Thu Aug 11 03:30:00 2011 -0700

    Header cleanup

commit 40df306d52cf0f6e2314d1da5bc35ee76369d78d
Author: Howard Chu <hyc@symas.com>
Date:   Thu Aug 11 03:23:22 2011 -0700

    More subDB fixes

commit 39817f6e852ff8beb4c2ba7876828ce9c959d098
Author: Howard Chu <hyc@symas.com>
Date:   Thu Aug 11 01:36:12 2011 -0700

    Parameter cleanup

commit 819d98169ed1784eb6fd32793799404506fa1602
Author: Howard Chu <hyc@symas.com>
Date:   Thu Aug 11 01:08:16 2011 -0700

    Valgrind complaints

commit 01c2f7816f643ef0c7080f2cf7964f5d34d20efe
Author: Howard Chu <hyc@symas.com>
Date:   Thu Aug 11 00:33:27 2011 -0700

    More subDB stuff

commit 2fe9fbd1a36eab2a1d47d119e7027eaed5ca841c
Author: Howard Chu <hyc@symas.com>
Date:   Wed Aug 10 23:38:50 2011 -0700

    Make sure subDB info is saved after writes

commit 314ac289389eb2a02b03db4ebe1a5976a0abe53c
Author: Howard Chu <hyc@symas.com>
Date:   Wed Aug 10 23:21:36 2011 -0700

    Sorted dups basically completed, needs testing

commit f586e57742042437743ad9534463790831853422
Author: Howard Chu <hyc@symas.com>
Date:   Wed Aug 10 22:50:34 2011 -0700

    Added cursor_get for sorted dups

commit f48f085ed865ebca1d61c262b09258bce6b991ea
Author: Howard Chu <hyc@symas.com>
Date:   Wed Aug 10 20:17:06 2011 -0700

    Add mdb_get for sorted dups

commit e3703ab58cf172f546e5390141092159761ba1c7
Author: Howard Chu <hyc@symas.com>
Date:   Wed Aug 10 20:00:13 2011 -0700

    Add mdb_del for sorted dups

commit bb6a034e282def9c201153a5b4e3a4d139ac54ab
Author: Howard Chu <hyc@symas.com>
Date:   Wed Aug 10 19:26:06 2011 -0700

    Add mdb_put for sorted dups

commit 51e210c604d6c7b6a5f08306d18ad6adca9204b8
Author: Howard Chu <hyc@symas.com>
Date:   Wed Aug 10 16:09:29 2011 -0700

    Fix reader txn locking

commit e3b668e84a769634baa64d255ca354890ed951f7
Author: Howard Chu <hyc@symas.com>
Date:   Wed Aug 10 15:48:58 2011 -0700

    Don't malloc the free_pgs list every time

commit 9f0b00b467e0d1e29ba1290f8b8bd4c77802962a
Author: Howard Chu <hyc@symas.com>
Date:   Tue Aug 9 19:54:15 2011 -0700

    Setup context for sorted dups

commit e5cf84495b16a009ae2450ee185d6ff8148a0b1b
Author: Howard Chu <hyc@symas.com>
Date:   Tue Aug 9 18:56:08 2011 -0700

    Add explicit md_dirty flag to dbxs

commit edf78694661259e6760f3af044139bbd0d948146
Author: Howard Chu <hyc@symas.com>
Date:   Tue Aug 9 03:26:45 2011 -0700

    Add cursor_prev

commit cc56ba04fb828db593fa376883e38d63f24a132e
Author: Howard Chu <hyc@symas.com>
Date:   Tue Aug 9 02:22:28 2011 -0700

    Use BDB cursor terminology

commit 60550e14eeba3bba634f03a40bc83abe07562f83
Author: Howard Chu <hyc@symas.com>
Date:   Tue Aug 9 01:13:55 2011 -0700

    Add some legalese
    
    Note derived from Martin Hedenfalk's btree.c; the code
    is significantly reworked but owes a lot to the original.

commit 36b08835648a19187c65677613ba5d8e7162227e
Author: Howard Chu <hyc@symas.com>
Date:   Mon Aug 8 17:15:02 2011 -0700

    Additional debug, fixes
    
    Fixed order of mdb_del0 operations
    Drop in-memory free list from env on txn_abort

commit 4ba37eed5e34f7aeebd1e2abb8733ac8947fad7b
Author: Howard Chu <hyc@symas.com>
Date:   Mon Aug 8 05:41:50 2011 -0700

    Save free-list in DB

commit 852ac0e3bc46d497b67f7b5cacc46cc1bfa5d425
Author: Howard Chu <hyc@symas.com>
Date:   Sun Aug 7 22:37:45 2011 -0700

    More sub-db stuff

commit a687f2dc3c82b7e0298e8442a0c262cfdc491577
Author: Howard Chu <hyc@symas.com>
Date:   Wed Aug 3 15:09:45 2011 -0700

    Use STAILQ instead of SIMPLEQ
    
    For compat with ancient BSD. Will probably just copy <ldap_queue.h> instead.

commit 1f3fdc811e3ce6a34bea15d3dd275fe01425a2a6
Author: Howard Chu <hyc@symas.com>
Date:   Wed Aug 3 15:04:20 2011 -0700

    More subdb stuff, add cursor_last()

commit 9b4c6896019100f4095127966bc98e1ea730ec58
Author: Howard Chu <hyc@symas.com>
Date:   Wed Aug 3 11:51:36 2011 -0700

    Tweak mt_dbxs array

commit 8211dd39603c16bb942a4a3361a55bfc89657263
Author: Howard Chu <hyc@symas.com>
Date:   Wed Aug 3 03:29:15 2011 -0700

    Fix free page re-use

commit 415d98755d43bdfb2033f574aaae6b71c0a373b1
Author: Howard Chu <hyc@symas.com>
Date:   Wed Aug 3 03:21:07 2011 -0700

    Fixup metapage writes

commit 4fd0f278d28b363ade419eb5b991c924a03e125d
Author: Howard Chu <hyc@symas.com>
Date:   Wed Aug 3 02:23:16 2011 -0700

    Tweaks to txn handling

commit f89d0cc4b73168ea9b98a6bb623dd683296d053a
Author: Howard Chu <hyc@symas.com>
Date:   Wed Aug 3 01:41:54 2011 -0700

    More subDBs, compiles now

commit cb4519179303fd54f282d3e4dcb477befbfca48d
Author: Howard Chu <hyc@symas.com>
Date:   Tue Aug 2 17:59:37 2011 -0700

    Start DB restructuring

commit 194334b2f79541c9eedb5d135829c03d2474951b
Author: Howard Chu <hyc@symas.com>
Date:   Sun Jul 31 02:38:34 2011 -0700

    Replace ulong with ULONG macro

commit 2766e88eeb03af4d4c65f8e79fab219cd1c12b61
Author: Howard Chu <hyc@symas.com>
Date:   Sun Jul 3 04:22:10 2011 -0700

    More prep for subdatabases

commit 86e78566e3ccd3b2d5451f5a31dc912a16ce81fb
Author: Howard Chu <hyc@symas.com>
Date:   Sat Jul 2 20:44:24 2011 -0700

    Tweak comment about overflow allocations

commit bc0ca49d16698c195898859ec09fff09a8b60062
Author: Howard Chu <hyc@symas.com>
Date:   Sat Jul 2 20:15:54 2011 -0700

    Use an environment directory
    
    Go back to using an mmap'd lock file

commit 5a72c6a294d51f833a576cd75a3b349371de4dbe
Author: Howard Chu <hyc@symas.com>
Date:   Fri Jul 1 06:37:51 2011 -0700

    No longer need -lssl

commit 5e6f32243cece21c6808b5ed7cf2883f49ebd60b
Author: Howard Chu <hyc@symas.com>
Date:   Fri Jul 1 06:25:36 2011 -0700

    Fix db_stat stuff

commit 3f025d1d4cceff4ca2090e527833df3561a20d28
Author: Howard Chu <hyc@symas.com>
Date:   Fri Jul 1 05:45:56 2011 -0700

    More fixes for seeking

commit 27ab75ef36ef7c6d10da824572423d8906e69cc0
Author: Howard Chu <hyc@symas.com>
Date:   Fri Jul 1 03:56:09 2011 -0700

    Re-use old pages

commit 661d4f80e3125505b4385fba4ccb90851c3cae54
Author: Howard Chu <hyc@symas.com>
Date:   Fri Jul 1 02:31:36 2011 -0700

    Drop header page
    
    it's useless, just use meta pages instead

commit c98c14fef591cac8700e32cc5f93133871e4ddd8
Author: Hallvard B Furuseth <h.b.furuseth@usit.uio.no>
Date:   Wed Jun 29 21:58:17 2011 +0200

    Private: make.sh

commit 63370215dd7777f4a68e387deccd0de6ef6f4fdc
Author: Hallvard B Furuseth <h.b.furuseth@usit.uio.no>
Date:   Wed Jun 29 21:32:52 2011 +0200

    #define _XOPEN_SOURCE for random()

commit f88d626ff1927a17cc8926e682dbc46d4d2cf85a
Author: Hallvard B Furuseth <h.b.furuseth@usit.uio.no>
Date:   Wed Jun 29 21:12:08 2011 +0200

    Drop unused vars

commit 95c88a57b1ddc81d9aad0382b50a3b424cd5000b
Author: Hallvard B Furuseth <h.b.furuseth@usit.uio.no>
Date:   Wed Jun 29 20:48:48 2011 +0200

    Warning cleanup: Make parent index unsigned

commit 7c1e5e9540ec3a31a197bcc74adda420c391ec9a
Author: Hallvard B Furuseth <h.b.furuseth@usit.uio.no>
Date:   Wed Jun 29 20:40:22 2011 +0200

    Warning cleanup: printf(%p, struct*)

commit 5fdbc54d7613b9d7da75307086fb5bb1c53b4cab
Author: Hallvard B Furuseth <h.b.furuseth@usit.uio.no>
Date:   Wed Jun 29 20:35:40 2011 +0200

    Warning cleanup: if(rc = mdb_<func>()) & co

commit 160585b1bc491f1f5cf14a2a825c97342aece2e5
Author: Hallvard B Furuseth <h.b.furuseth@usit.uio.no>
Date:   Wed Jun 29 20:13:56 2011 +0200

    Warning cleanup: Drop unneeded 'unsigned >= 0'

commit bd2ceeb74e9cc126b0076558176c1565cfea4fee
Author: Hallvard B Furuseth <h.b.furuseth@usit.uio.no>
Date:   Wed Jun 29 20:09:31 2011 +0200

    Fix P_INVALID signedness

commit f42f7f344245dcbf07058f37b2cd00f304c2097b
Author: Hallvard B Furuseth <h.b.furuseth@usit.uio.no>
Date:   Wed Jun 29 19:52:37 2011 +0200

    Fix formats, reduce PAGEHDRSZ size_t->unsigned.
    
    NUMKEYS was size_t due to PAGEHDRSZ; printing unsigned int is simpler.
    
    Instead increase PAGEFILL to long, since it involves a multiply.
    Possibly uint32_t or something would be sufficient.

commit aed36f5780648b4b4f62745be30480fae88fce0e
Author: Hallvard B Furuseth <h.b.furuseth@usit.uio.no>
Date:   Wed Jun 29 19:17:31 2011 +0200

    Compact memnrcmp, just for fun

commit ab0d6fa05ed44d7c09b6c16db8d2b6fb2e0c3183
Author: Hallvard B Furuseth <h.b.furuseth@usit.uio.no>
Date:   Wed Jun 29 18:59:53 2011 +0200

    Fix memncmp(): Do not memcmp twice

commit 86b40907d4e81225b016c7bee7dc501e405a38f5
Author: Hallvard B Furuseth <h.b.furuseth@usit.uio.no>
Date:   Wed Jun 29 18:47:08 2011 +0200

    DPRINTF(): Fix format, handle non-gcc, simplify.
    
    Add C99-required 1st parameter.  Disable for for non-gcc.  Simplify.
    GNU extension #define DPRINTF(<no 1st arg>...) -> GNU ext ,##__VA_ARGS__.
    Fix __LINE__ format %ld -> %d.

commit 84659a5bb6a474b50ad1b090c54e1df623d40778
Author: Hallvard B Furuseth <h.b.furuseth@usit.uio.no>
Date:   Wed Jun 29 18:07:37 2011 +0200

    Makefile

commit f73a992ac9c9a0fc0360dc4d6c24699c082b504c
Author: Hallvard B Furuseth <h.b.furuseth@usit.uio.no>
Date:   Wed Jun 29 18:01:42 2011 +0200

    .gitignore

commit 2d4f522a73e1009e8c1ebc88f68c0ac02e2318f2
Author: Howard Chu <hyc@symas.com>
Date:   Wed Jun 29 01:55:53 2011 -0700

    More cursor tests, fail...

commit bddc86c0ee77a63f2e70f6b156f0c0aeba80dceb
Author: Howard Chu <hyc@symas.com>
Date:   Wed Jun 29 01:55:07 2011 -0700

    Save a byte in nodesz

commit 3a62d59c4513131c5ee5765fd33237b4f3534eaf
Author: Howard Chu <hyc@symas.com>
Date:   Tue Jun 28 22:34:53 2011 -0700

    meta init

commit fe703b0ee07c8f508e73a3cca34d8e0efbe51efb
Author: Howard Chu <hyc@symas.com>
Date:   Tue Jun 28 22:05:54 2011 -0700

    Log txnID in msgs

commit 421ee6bb1ddd6023b57f5684251f4a487c9171fd
Author: Howard Chu <hyc@symas.com>
Date:   Tue Jun 28 18:40:52 2011 -0700

    Use toggling meta page instead of always appending

commit a37195f686746eb5781c9fcbc81ba2f389602324
Author: Howard Chu <hyc@symas.com>
Date:   Tue Jun 28 14:22:22 2011 -0700

    Use shmat for lock region instead of mmap

commit f367441b6966914d1985f241647e1229b4b6c8e8
Author: Howard Chu <hyc@symas.com>
Date:   Tue Jun 28 13:46:48 2011 -0700

    Add locking support

commit a4c3626267dcaf2565a1ddf2730a86ff8abb12da
Author: Howard Chu <hyc@symas.com>
Date:   Tue Jun 28 02:57:02 2011 -0700

    Fix P_INVALID def

commit 7d678832a798d1facba6b53a4f83b4628a44a80e
Author: Howard Chu <hyc@symas.com>
Date:   Tue Jun 28 02:43:49 2011 -0700

    Cursor testing

commit cd57e9741f11d59882f5699636fdfe00a579b7e7
Author: Howard Chu <hyc@symas.com>
Date:   Tue Jun 28 02:40:46 2011 -0700

    Fix splits, cursor navigation, newpage flags

commit 11e80dae6366516bca9e59c807f171073a596885
Author: Howard Chu <hyc@symas.com>
Date:   Tue Jun 28 00:16:05 2011 -0700

    Return statistics for a DB
    
    Eventually this will have to grow up to be like BDB db_stat...

commit a2de260fb37e384dfa21e9d1c7fb95e6e4ee3a89
Author: Howard Chu <hyc@symas.com>
Date:   Tue Jun 28 00:15:40 2011 -0700

    Use NOSYNC flag

commit 0c2610ebdd8c064edd381ccaeaacb1d69bc6bcf2
Author: Howard Chu <hyc@symas.com>
Date:   Tue Jun 28 00:15:15 2011 -0700

    Use header when some fields are unspecified

commit d620d4368a7ee17d60f2b381d4c80b22c68ba8e2
Author: Howard Chu <hyc@symas.com>
Date:   Mon Jun 27 22:39:24 2011 -0700

    Checkpoint
